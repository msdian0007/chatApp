const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/react-input-emoji-BIUyQkSU.js","assets/react-DHBI0EtI.js","assets/classnames-C9FZUsQl.js","assets/react-dom-vAgahkSm.js","assets/scheduler-CzFDRTuY.js"])))=>i.map(i=>d[i]);
import{r as c,j as e,a as ge}from"./react-DHBI0EtI.js";import{c as fe}from"./react-dom-vAgahkSm.js";import{a as je}from"./axios-B4uVmeYG.js";import{l as Ne}from"./socket.io-client-DFi9RC7o.js";import{s as k,S as y,a as T,B as H,P as K,b as Z,A as G,T as $,D as ve}from"./antd-DGosEx24.js";import{h as q}from"./moment-C5S46NFB.js";import{o as be,j as ye,p as Ce,q as we,r as D,s as V,v as Ie,w as Re,x as Se,y as ke,z as J,A as Le}from"./@ant-design-lagzWgUo.js";import{d as B,a as Ue,b as _e,e as Ae,f as M}from"./react-router-mPJ5A8eT.js";import{L as Fe,B as Oe}from"./react-router-dom-CBWY55wr.js";import"./classnames-C9FZUsQl.js";import"./scheduler-CzFDRTuY.js";import"./engine.io-client-DBBxzneW.js";import"./engine.io-parser-BiEtp6m2.js";import"./@socket.io-Dkula2eQ.js";import"./socket.io-parser-BBkuslX-.js";import"./rc-util-DRk5y4Yu.js";import"./@babel-DDXZNtFh.js";import"./rc-resize-observer-DhIh4Bln.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./rc-motion-B7bZ38Ss.js";import"./rc-overflow-DZRiDIAM.js";import"./rc-tooltip-DduOv04A.js";import"./@rc-component-Db8YWiD8.js";import"./rc-menu-DFg7V8Qr.js";import"./rc-dropdown-1QSiw7eM.js";import"./rc-field-form-BLZ5SSc5.js";import"./@ctrl-DOFZgDuz.js";import"./throttle-debounce-CUWDS_la.js";import"./rc-notification-B-HVxHmI.js";import"./rc-pagination-TIHhowL0.js";import"./rc-picker-CcREweDU.js";import"./@emotion-CW87jbl0.js";import"./stylis-DsJDcYJc.js";import"./@remix-run-BZ1VHzzA.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const m of l.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&i(m)}).observe(document,{childList:!0,subtree:!0});function a(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerPolicy&&(l.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?l.credentials="include":n.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(n){if(n.ep)return;n.ep=!0;const l=a(n);fetch(n.href,l)}})();let Q="",X="";Q="https://chatapp-5f1p.onrender.com/api",X="https://chatapp-socket-oi5c.onrender.com";const Ee=Object.freeze({server:Q,socket:X}),Y=Ee,b=je.create({baseURL:Y.server,timeout:4e4,headers:{"Content-Type":"application/json"}}),I=s=>{s.response&&s.response.data?k.error(s.response.data.message):s.message?k.error(s.message):k.error("An error occurred. Please try again.")},ee=c.createContext(null),Pe=({children:s,user:t})=>{const[a,i]=c.useState(!1),[n,l]=c.useState([]),[m,r]=c.useState([]),[p,d]=c.useState([]),[x,u]=c.useState([]),[o,h]=c.useState(null),[R,U]=c.useState(!1),[A,L]=c.useState(null),[f,E]=c.useState(null),[N,ce]=c.useState(null),[ie,le]=c.useState([]),[F,O]=c.useState([]),[oe,de]=c.useState(!1),me=c.useCallback(async(j,g)=>{try{i(!0);const v=await b.post("/chats",{firstId:j,secondId:g});v.data&&(l(C=>[v.data,...C]),i(!1))}catch(v){I(v)}},[]),ue=c.useCallback(async(j,g,v,C)=>{try{const w=await b.post("/messages",{chatId:v,senderId:g,text:j});w.data&&(E(w.data),L(P=>[...P,w.data]),C(""))}catch(w){I(w)}},[]),pe=c.useCallback((j,g)=>{h(j);const v=F.map(C=>C.senderId===g?{...C,isRead:!0}:C);O(v)},[F]),he=c.useCallback(async(j,g)=>{try{const v=await b.get(`/chats/${j}/${g}`);if(v.data){h(v.data);const C=F.map(w=>w.senderId===j?{...w,isRead:!0}:w);O(C)}}catch(v){I(v)}},[F]),xe=c.useCallback(j=>{const g=j.map(v=>({...v,isRead:!0}));O(g)},[]);return c.useEffect(()=>{if(!t)return;(async()=>{try{i(!0);const g=await b.get(`/chats/${t==null?void 0:t._id}`);g.data&&(l(g.data),i(!1))}catch(g){I(g)}})()},[t]),c.useEffect(()=>{if(!t)return;(async()=>{try{r(!0);const g=await b.get(`/user/getAllFriends/${t._id}`);if(g.data){const v=g.data.filter(C=>{let w=!1;return t._id===C._id?!1:(n&&(w=n==null?void 0:n.some(P=>P.members[0]===C._id||P.members[1]===C._id)),!w)});u(g.data),d(v),r(!1)}}catch(g){r(!1),I(g)}})()},[n,oe]),c.useEffect(()=>{const j=async()=>{try{U(!0);const g=await b.get(`/messages/${o==null?void 0:o._id}`);g.data&&(L(g.data),U(!1))}catch(g){I(g)}};o&&j()},[o]),c.useEffect(()=>{const j=Ne(Y.socket);return ce(j),()=>{j.disconnect()}},[t]),c.useEffect(()=>{N===null&&!t||N.emit("addOnlineUser",t==null?void 0:t._id)},[N]),c.useEffect(()=>{if(!(N===null&&!t))return N.on("getOnlineUsers",j=>{le(j)}),()=>{N.off("getOnlineUsers")}},[N]),c.useEffect(()=>{N===null&&!t||N.emit("sendNewMessage",{recipientId:o==null?void 0:o.members.find(j=>j!==(t==null?void 0:t._id)),textMessage:f})},[f]),c.useEffect(()=>{if(!(N===null&&!t))return N.on("getNewMessage",j=>{(o==null?void 0:o._id)===j.chatId&&L(g=>[...g,j])}),N.on("sendNotification",j=>{o!=null&&o.members.find(g=>g===j.senderId)?O(g=>[{...j,isRead:!0},...g]):O(g=>[j,...g])}),()=>{N.off("getNewMessage"),N.off("sendNotification")}},[N,o]),e.jsx(e.Fragment,{children:e.jsx(ee.Provider,{value:{userChat:n,chatLoading:a,potentialChats:p,potentialChatsLoading:m,allUsers:x,createChat:me,currentChat:o,updateCurrentChat:pe,messages:A,messagesLoading:R,sendTextMessage:ue,onlineUsers:ie,notifications:F,openNewChat:he,markAllAsRead:xe,setIsNewFriendAdded:de},children:s})})},_=()=>c.useContext(ee),se=c.createContext(),$e=({children:s})=>{const[t,a]=c.useState(!0),[i,n]=c.useState(!1),[l,m]=c.useState(null),[r,p]=c.useState(!1),[d,x]=c.useState({firstName:"",lastName:"",phoneNumber:"",password:""}),[u,o]=c.useState({phoneNumber:"",password:""}),h=c.useCallback(async()=>{try{if(!d.phoneNumber&&!d.password&&!d.firstName&&!d.lastName)return k.warning("All fields required");p(!0);const f=await b.post("/user/register",d);f.data&&(localStorage.setItem("userData",JSON.stringify(f.data)),m(f.data),p(!1),k.success(f.data.message))}catch(f){p(!1),I(f)}},[d]),R=c.useCallback(f=>{x(f)},[]),U=c.useCallback(f=>{o(f)},[]),A=c.useCallback(()=>{localStorage.removeItem("userData"),m(null)},[]),L=c.useCallback(async()=>{try{if(!u.phoneNumber&&!u.password)return k.success("All fields required");n(!0);const f=await b.post("/user/login",u);f.data&&(localStorage.setItem("userData",JSON.stringify(f.data)),m(f.data),n(!1),k.success(f.data.message))}catch(f){n(!1),I(f)}},[u]);return c.useEffect(()=>{const f=localStorage.getItem("userData");m(JSON.parse(f)),a(!1)},[]),e.jsx(e.Fragment,{children:e.jsx(se.Provider,{value:{user:l,registerInfo:d,updateRegisterInfo:R,registerLoading:r,registerUser:h,loading:t,logOut:A,logIn:L,loginLoading:i,loginInfo:u,updateLoginInfo:U},children:s})})},S=()=>c.useContext(se),z=()=>{const[s,t]=c.useState(),[a,i]=c.useState(!1),[n,l]=c.useState([]),[m,r]=c.useState(!1),[p,d]=c.useState(),[x,u]=c.useState(!1);return{recipientLoading:a,recipient:s,searchedUsersLoading:m,searchedUsers:n,recipients:p,recipientsLoading:x,setSearchedUsers:l,getRecipient:async o=>{try{i(!0);const h=await b.get(`/user/find/${o}`);h.data&&(t(h.data),i(!1))}catch{i(!1)}},getRecipients:async o=>{try{u(!0);const h=await b.post("/user/getUsersById",{recipientId:o});h.data&&(d(h.data),u(!1))}catch{u(!1)}},searchUsersByPhoneNumber:async o=>{try{r(!0);const h=await b.get(`/user/findByNumber/${o}`);h.data&&(l(h.data),r(!1))}catch{r(!1)}}}},Me=()=>e.jsx("div",{className:"user-card flex justify-between items-center p-2 cursor-pointer",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:" ",children:e.jsx(y.Avatar,{size:"large",active:!0})}),e.jsxs("div",{className:"text-content",children:[e.jsx(y.Input,{size:"small",style:{height:"14px"},block:!0,active:!0}),e.jsx(y.Input,{size:"small",style:{height:"10px"},active:!0})]})]})}),qe=()=>e.jsxs("div",{className:"flex flex-col gap-1 items-center w-6 pl-8",children:[e.jsx(y.Avatar,{active:!0}),e.jsx(y.Button,{active:!0,size:"small",style:{height:"6px"}})]}),Be=()=>e.jsx("div",{className:"chat-box content-center !bg-neutral-700 min-h-[calc(100vh-8vh)]",children:e.jsxs("div",{className:"messages pb-4 px-1 lg:px-4",children:[e.jsx(y.Input,{className:"message self !p-0 !bg-transparent",active:!0}),e.jsx(y.Input,{className:"message !p-0 !bg-transparent",active:!0}),e.jsx(y.Input,{className:"message !p-0 !bg-transparent",active:!0}),e.jsx(y.Input,{className:"message !p-0 !bg-transparent",active:!0}),e.jsx(y.Input,{className:"message !p-0 !bg-transparent",active:!0}),e.jsx(y.Input,{className:"message self !p-0 !bg-transparent",active:!0}),e.jsx(y.Input,{className:"message self !p-0 !bg-transparent",active:!0}),e.jsx(y.Input,{className:"message self !p-0 !bg-transparent",active:!0}),e.jsx(y.Input,{className:"message self !p-0 !bg-transparent",active:!0}),e.jsx(y.Input,{className:"message !p-0 !bg-transparent",active:!0})]})}),te=s=>s.filter(t=>!t.isRead),ze=(s,t)=>te(s).filter(i=>i.senderId===t).length,ae=()=>{const[s,t]=c.useState(!0),[a,i]=c.useState();return{lastMessageLoading:s,lastMessage:a,getLatestMessage:async n=>{try{const l=await b.get(`/messages/latest/${n}`);l.data&&(i(l.data),t(!1))}catch(l){I(l)}},sendChatRequest:async(n,l)=>{try{const m=await b.post("/chats/sendChatRequest",{senderId:n,recipientId:l});if(m.data)return k.success("Request send successfully"),m.data}catch(m){I(m)}},respondChatRequest:async(n,l,m)=>{try{(await b.post("/chats/chatRequestResponse",{senderId:n,recipientId:l,respond:m})).data}catch(r){I(r)}}}},ne=()=>({getDpName:(s,t)=>s&&t?s.charAt(0)+t.charAt(0):s?s.charAt(0):""});function De({chat:s,user:t,index:a,setIsChatBoxOpen:i}){const{onlineUsers:n,notifications:l,updateCurrentChat:m,messages:r}=_(),{getRecipient:p,recipient:d,recipientLoading:x}=z(),{getLatestMessage:u,lastMessage:o}=ae(),{getDpName:h}=ne(),R=ze(l,d==null?void 0:d._id),U=f=>n.some(N=>N.userId===f)&&e.jsx("div",{className:"absolute bottom-0 right-0 w-3 h-3 bg-green-500 border-2 border-white rounded-full"}),A=f=>o&&(f==null?void 0:f.senderId)!==(d==null?void 0:d._id)?e.jsxs("div",{className:"flex text-[12px]",children:[e.jsx("div",{className:"pr-1 font-bold text-orange-400",children:"you:"}),e.jsx("div",{className:"truncate",children:o==null?void 0:o.text})]}):e.jsx("div",{className:"text",children:o==null?void 0:o.text}),L=()=>{m(s,d==null?void 0:d._id),i(!0)};return c.useEffect(()=>{const f=s==null?void 0:s.members.find(E=>E!==(t==null?void 0:t._id));f&&p(f)},[s]),c.useEffect(()=>{u(s==null?void 0:s._id)},[l,r]),e.jsx(e.Fragment,{children:x?e.jsx(Me,{}):e.jsxs("div",{className:"flex items-center justify-between p-2 cursor-pointer user-card",onClick:L,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative w-9 h-9",children:[e.jsx("div",{className:"content-center object-cover w-full h-full text-center rounded-full bg-slate-400",children:h((d==null?void 0:d.firstName)+" "+(d==null?void 0:d.lastName))}),U(d==null?void 0:d._id)]}),e.jsxs("div",{className:"text-content",children:[e.jsx("div",{className:"name",children:(d==null?void 0:d.firstName)+" "+(d==null?void 0:d.lastName)}),A(o)]})]}),e.jsxs("div",{className:"grid items-end text-right",children:[e.jsx("div",{className:"date !text-[12px]",children:q(o==null?void 0:o.updatedAt).calendar()}),R?e.jsx("div",{className:"flex justify-end",children:e.jsx("span",{className:"this-user-notifications",children:R})}):null]})]})})}const Te=({user:s})=>{const{potentialChats:t,createChat:a,onlineUsers:i,potentialChatsLoading:n}=_(),l=r=>i.some(d=>d.userId===r)&&e.jsx("div",{className:"absolute bottom-0 right-0 w-2 h-2 bg-green-500 border-[1px] border-white rounded-full"}),m=r=>r.split(" ").map(p=>p.charAt(0).toUpperCase()).join("");return e.jsx(e.Fragment,{children:e.jsx("div",{className:"flex gap-2 overflow-x-scroll overflow-y-hidden scrollbar",children:n?e.jsx(qe,{}):t&&t.map((r,p)=>e.jsxs("div",{className:"flex flex-col items-center p-2 mb-2 border-b-2 rounded-lg cursor-pointer w-14",onClick:()=>a(s==null?void 0:s._id,r==null?void 0:r._id),children:[e.jsxs("div",{className:"relative w-7 h-7",children:[e.jsx("div",{className:"w-full h-full rounded-full object-cover text-[12px] bg-violet-600 text-center content-center",children:m((r==null?void 0:r.firstName)+" "+(r==null?void 0:r.lastName))}),l(r._id)]}),e.jsx("div",{className:"mt-1 text-[9px] text-center",children:r==null?void 0:r.firstName})]},p))})})},He="modulepreload",Ve=function(s){return"/chatApp/"+s},W={},Je=function(t,a,i){let n=Promise.resolve();if(a&&a.length>0){document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),m=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));n=Promise.all(a.map(r=>{if(r=Ve(r),r in W)return;W[r]=!0;const p=r.endsWith(".css"),d=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${r}"]${d}`))return;const x=document.createElement("link");if(x.rel=p?"stylesheet":He,p||(x.as="script",x.crossOrigin=""),x.href=r,m&&x.setAttribute("nonce",m),document.head.appendChild(x),p)return new Promise((u,o)=>{x.addEventListener("load",u),x.addEventListener("error",()=>o(new Error(`Unable to preload CSS for ${r}`)))})}))}return n.then(()=>t()).catch(l=>{const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=l,window.dispatchEvent(m),!m.defaultPrevented)throw l})},We=c.lazy(()=>Je(()=>import("./react-input-emoji-BIUyQkSU.js"),__vite__mapDeps([0,1,2,3,4]))),Ke=c.memo(({text:s,handleChange:t})=>e.jsx(e.Fragment,{children:e.jsx(c.Suspense,{fallback:e.jsx(T,{}),children:e.jsx(We,{value:s,onChange:t,fontFamily:"nunito",borderColor:"rgba(72, 112, 223, 0.2)"})})})),Ze=({user:s,setIsChatBoxOpen:t})=>{const{messages:a,messagesLoading:i,currentChat:n,sendTextMessage:l}=_(),{loading:m,recipient:r,getRecipient:p}=z(),[d,x]=c.useState(""),u=c.useRef();c.useEffect(()=>{const h=n==null?void 0:n.members.find(R=>R!==(s==null?void 0:s._id));h&&p(h)},[n]),c.useEffect(()=>{var h;(h=u.current)==null||h.scrollIntoView({behavior:"smooth"})},[a]);const o=c.useCallback(h=>{x(h)},[]);return i?e.jsx(Be,{}):n?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"chat-box relative min-h-[calc(100vh-8vh)]",children:[e.jsxs("div",{className:"chat-header !flex !justify-between",children:[e.jsx("div",{className:"pl-2 text-xl cursor-pointer lg:text-lg",onClick:()=>t(!1),children:e.jsx(be,{})}),e.jsx("strong",{children:r==null?void 0:r.firstName}),e.jsx("span",{})]}),e.jsx("div",{className:"messages lg:pb-[46px] pt-2 pb-5 px-3 lg:px-4",children:a&&a.map((h,R)=>e.jsxs("div",{ref:u,className:`${h.senderId===(s==null?void 0:s._id)?"message self ":"message "} `,children:[e.jsx("div",{children:h.text}),e.jsx("div",{className:"message-footer",children:q(h.createdAt).calendar()})]},R))}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 flex items-center justify-between chat-input",children:[e.jsx(Ke,{text:d,handleChange:o}),e.jsx("button",{className:"items-end content-center w-8 h-8 rounded-full bg-sky-600",onClick:()=>l(d,s==null?void 0:s._id,n._id,x),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"28",height:"28",fill:"currentColor",className:"scale-75 bi bi-send",viewBox:"0 0 16 16",children:e.jsx("path",{d:"M15.854.146a.5.5 0 0 1 .11.54l-5.819 14.547a.75.75 0 0 1-1.329.124l-3.178-4.995L.643 7.184a.75.75 0 0 1 .124-1.33L15.314.037a.5.5 0 0 1 .54.11ZM6.636 10.07l2.761 4.338L14.13 2.576zm6.787-8.201L1.591 6.602l4.339 2.76z"})})})]})]})}):e.jsx("div",{className:"chat-box content-center min-h-[calc(100vh-8vh)]",children:e.jsx("div",{className:"flex justify-center ",children:"...No conversation selected"})})},Ge=({u:s,handleChatRequest:t})=>{const{getDpName:a}=ne();return e.jsxs("div",{className:"flex items-center justify-between p-2 cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"relative w-9 h-9",children:e.jsx("div",{className:"content-center object-cover w-full h-full text-center rounded-full bg-slate-400",children:a(s==null?void 0:s.firstName,s==null?void 0:s.lastName)})}),e.jsx("div",{className:"text-content",children:e.jsx("div",{className:"name",children:(s==null?void 0:s.firstName)+" "+(s==null?void 0:s.lastName)})})]}),e.jsx("div",{onClick:()=>t(s==null?void 0:s._id),className:"grid items-end content-center px-2 text-sm text-right bg-orange-600 rounded-md cursor-pointer hover:bg-orange-700 ",children:"Chat Request"})]})},Qe=()=>{const[s,t]=c.useState(""),{searchedUsersLoading:a,searchedUsers:i,setSearchedUsers:n,searchUsersByPhoneNumber:l}=z(),{sendChatRequest:m}=ae(),{user:r}=S(),p=()=>{s&&l(s)},d=async x=>{if((r==null?void 0:r._id)===x)return k.warning("Abey saale 🙂");await m(r==null?void 0:r._id,x),n([]),t("")};return e.jsx("div",{className:"max-w-[400px] text-center ",children:e.jsxs("div",{className:"relative w-3/4 mx-auto",children:[e.jsx("input",{type:"number",placeholder:"search friends...",className:"w-full px-3 py-1 text-sm rounded-md bg-black/45",value:s,onChange:x=>t(x.target.value)}),e.jsx("div",{className:"absolute content-center px-4 bg-orange-600 rounded-md hover:bg-orange-700 bottom-1 top-1 right-2",children:a?e.jsx(ye,{}):e.jsx(Ce,{className:"cursor-pointer",onClick:p})}),a?e.jsx(e.Fragment,{}):(i==null?void 0:i.length)>0&&e.jsx("div",{className:"absolute w-full py-2 mt-4 border rounded-md border-black/35 bg-black/55",children:i==null?void 0:i.map((x,u)=>e.jsx(Ge,{u:x,handleChatRequest:d},u))})]})})},Xe=()=>{const{userChat:s,chatLoading:t}=_(),{user:a}=S(),[i,n]=c.useState(!1);return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-8",children:[e.jsxs("div",{className:`${i?"hidden lg:block col-span-3":"lg:col-span-3 col-span-8"} "px-3 my-2 border-r-2"`,children:[e.jsx(Qe,{}),e.jsx(Te,{user:a}),e.jsx("div",{children:!t&&s.map((l,m)=>e.jsx("div",{children:e.jsx(De,{chat:l,user:a,index:m,setIsChatBoxOpen:n})},m))})]}),e.jsx("div",{className:`${i?"lg:col-span-5 col-span-8":"hidden lg:block"} col-span-5 lg:pl-2`,children:e.jsx(Ze,{user:a,setIsChatBoxOpen:n})})]})})},Ye=()=>{const{logIn:s,user:t,updateLoginInfo:a,loginInfo:i,loginLoading:n}=S(),[l,m]=c.useState(!1);return e.jsxs(e.Fragment,{children:[t?e.jsx(B,{to:"/"}):null,e.jsx("div",{className:"flex justify-center min-h-[calc(100vh-10vh)]",children:e.jsxs("div",{className:"grid grid-cols-4 my-auto ",children:[e.jsxs("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-2",children:[e.jsx("label",{htmlFor:"",children:"Mobile Number"}),e.jsx("input",{type:"number",className:"px-2 py-1 rounded-md bg-neutral-600",onChange:r=>a({...i,phoneNumber:r.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-7",children:[e.jsx("label",{htmlFor:"",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:`${l?"text":"password"}`,className:"px-2 py-1 rounded-md bg-neutral-600",onChange:r=>a({...i,password:r.target.value})}),e.jsx("span",{className:"absolute cursor-pointer right-2 top-1",onClick:()=>m(!l),children:"👁"})]})]}),e.jsx("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-2",children:e.jsx(H,{onClick:s,loading:n,type:"primary",children:"Log In"})})]})})]})},es=()=>{const{registerInfo:s,user:t,updateRegisterInfo:a,registerUser:i,registerLoading:n}=S(),[l,m]=c.useState(!1);return e.jsxs(e.Fragment,{children:[t?e.jsx(B,{to:"/"}):null,e.jsx("form",{action:"",children:e.jsx("div",{className:"flex justify-center min-h-[calc(100vh-10vh)]",children:e.jsxs("div",{className:"grid grid-cols-4 my-auto ",children:[e.jsxs("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-2",children:[e.jsx("label",{htmlFor:"",children:"First Name"}),e.jsx("input",{type:"text",className:"px-2 py-1 rounded-md bg-neutral-600",onChange:r=>a({...s,firstName:r.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-2",children:[e.jsx("label",{htmlFor:"",children:"Last Name"}),e.jsx("input",{type:"text",className:"px-2 py-1 rounded-md bg-neutral-600",onChange:r=>a({...s,lastName:r.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-2",children:[e.jsx("label",{htmlFor:"",children:"PhoneNumber"}),e.jsx("input",{type:"number",className:"px-2 py-1 rounded-md bg-neutral-600",onChange:r=>a({...s,phoneNumber:r.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-7",children:[e.jsx("label",{htmlFor:"",children:"Create Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:`${l?"text":"password"}`,className:"px-2 py-1 rounded-md bg-neutral-600",onChange:r=>a({...s,password:r.target.value})}),e.jsx("span",{className:"absolute cursor-pointer right-2 top-1",onClick:()=>m(!l),children:"👁"})]})]}),e.jsx("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-2",children:e.jsx(H,{onClick:i,type:"primary",loading:n,children:"Sign Up"})})]})})})]})},ss=()=>{const{user:s}=S(),{notifications:t,allUsers:a,openNewChat:i,markAllAsRead:n}=_(),[l,m]=c.useState(!1),r=te(t),p=t.map(u=>{let o=a.find(h=>h._id===u.senderId);return{...u,senderName:o==null?void 0:o.firstName}}),d=(u,o)=>{i(u,o),m(!1)};let x=()=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid",children:[p!=null&&p.length?p.map((u,o)=>e.jsxs("div",{className:`${u.isRead?" text-black/30":"text-black"} border-slate-300 cursor-pointer border-b-[1px] p-1`,onClick:()=>d(u==null?void 0:u.senderId,s==null?void 0:s._id),children:[e.jsx("span",{className:"font-bold ",children:u==null?void 0:u.senderName}),e.jsx("span",{children:" sent a message"}),e.jsx("span",{className:"text-[10px] pl-4 align-bottom italic",children:q(u==null?void 0:u.date).calendar()})]},o)):e.jsx("div",{className:"text-center text-rose-600",children:"Empty"}),(p==null?void 0:p.length)>1?e.jsx("div",{className:"flex justify-end pt-3",children:e.jsx(H,{className:"text-[12px]",size:"small",type:"default",onClick:()=>n(p),children:"Mark all as read"})}):null]})});return e.jsx(e.Fragment,{children:e.jsx(K,{placement:"bottomRight",title:"Unread Notifications",content:x,trigger:"click",open:l,onOpenChange:()=>m(!l),children:e.jsx(Z,{className:"content-center cursor-pointer",size:"small",count:r==null?void 0:r.length,children:e.jsx(G,{className:"scale-75 lg:scale-100",shape:"circle",size:"default",icon:e.jsx(we,{})})})})})},re=()=>{const[s,t]=c.useState();return{chatRequest:s,sendChatRequest:async(a,i)=>{try{if((await b.post("/chats/sendChatRequest",{senderId:a,recipientId:i})).data)return!0}catch(n){console.log(n),I(n)}},getChatRequestById:async a=>{try{const i=await b.get(`/chats/getChatRequest/${a}`);if(i.data)return t(i.data[0]),!0}catch(i){console.log(i)}},respondChatRequest:async(a,i,n)=>{try{(await b.post("/chats/chatRequestResponse",{chatReqId:a,recipientId:i,respond:n})).data}catch(l){console.log(l)}}}},ts=(s,t)=>{const{sender_details:a,receiver_details:i}=s;return s.sender===t?e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-orange-600",children:i.firstName+" "+i.lastName+" "}),s.status==="accepted"?e.jsx($,{color:"success",icon:e.jsx(D,{}),children:"accepted"}):e.jsx($,{color:"default",icon:e.jsx(V,{}),children:"pending"})]}),e.jsx("span",{children:i.phoneNumber})]}):e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-orange-600",children:a.firstName+" "+a.lastName+" "}),s.status==="accepted"?e.jsx($,{color:"success",icon:e.jsx(D,{}),children:"friendzz"}):e.jsx($,{color:"default",icon:e.jsx(V,{}),children:"pending"})]}),e.jsx("span",{children:a.phoneNumber})]})},as=({chatReqId:s,handleRespondChatRequest:t})=>{const{chatRequest:a,getChatRequestById:i}=re(),{user:n}=S();return c.useEffect(()=>{i(s)},[s]),e.jsx(e.Fragment,{children:a?e.jsx("div",{children:e.jsxs("div",{className:"border-slate-300 cursor-pointer border-b-[1px] p-1 flex justify-between",children:[ts(a,n==null?void 0:n._id),e.jsxs("div",{className:"flex flex-col text-lg text-right",children:[a.status!=="accepted"&&a.sender!==(n==null?void 0:n._id)?e.jsxs("span",{className:"flex justify-end gap-2",children:[e.jsx(D,{style:{color:"green"},onClick:()=>t(s,a==null?void 0:a.receiver,"accept")}),e.jsx(Ie,{style:{color:"red"},onClick:()=>t(s,a==null?void 0:a.receiver,"reject")})]}):e.jsx("span",{className:"text-right",children:e.jsx(Re,{})}),e.jsx("span",{className:"text-[10px] pl-4 align-bottom italic",children:q(a.status!=="accepted"?a==null?void 0:a.sentAt:a==null?void 0:a.respondedAt).calendar()})]})]})}):e.jsx(e.Fragment,{})})},ns=()=>{const{user:s}=S(),{setIsNewFriendAdded:t}=_(),{getRecipient:a,recipient:i,recipientLoading:n}=z(),{respondChatRequest:l}=re(),[m,r]=c.useState(!1);c.useEffect(()=>{s&&a(s._id)},[s]);const p=async(x,u,o)=>{await l(x,u,o),await a(s._id),t(!0),r(!1)};let d=()=>{var x,u;return e.jsx(e.Fragment,{children:e.jsx("div",{className:"grid",children:n?e.jsx(T,{}):e.jsx(e.Fragment,{children:(x=i==null?void 0:i.friendRequests)!=null&&x.length?(u=i==null?void 0:i.friendRequests)==null?void 0:u.map((o,h)=>e.jsx(as,{chatReqId:o,handleRespondChatRequest:p},h)):e.jsx("div",{className:"text-center text-rose-600",children:"No Chat Requests"})})})})};return e.jsx(K,{placement:"bottomRight",title:"Chat Requests",content:d,trigger:"click",open:m,onOpenChange:()=>r(!m),children:e.jsx(Z,{className:"content-center cursor-pointer",size:"small",children:e.jsx(G,{className:"scale-75 lg:scale-100",shape:"circle",size:"default",icon:e.jsx(Se,{})})})})},rs=()=>{const{user:s,logOut:t}=S(),a=Ue(),i=s?[{label:"Logout",key:"1",icon:e.jsx(Le,{}),onClick:()=>{t()}}]:[{label:"Login",key:"1",icon:e.jsx(J,{}),onClick:()=>{a("/login")}},{label:"Register",key:"2",icon:e.jsx(J,{}),onClick:()=>{a("/register")}}];return e.jsx(e.Fragment,{children:e.jsx("div",{className:" bg-slate-700",children:e.jsxs("div",{className:"flex justify-between min-h-[8vh] lg:px-[56px] px-3 ",children:[e.jsx("div",{className:"content-center hidden cursor-pointer lg:block",children:e.jsx(Fe,{to:"/",children:"ChatApp"})}),e.jsxs("div",{className:"flex gap-1 ",children:[e.jsx("div",{className:"content-center italic scale-125",children:"🍁"}),s&&e.jsxs("div",{className:"content-center",children:[e.jsx("span",{children:"Hi "}),e.jsx("span",{className:"italic text-amber-500",children:s==null?void 0:s.firstName})]})]}),e.jsxs("div",{className:"flex gap-2 my-auto lg:gap-6",children:[e.jsxs("div",{className:"lg:flex lg:gap-2",children:[e.jsx(ns,{}),e.jsx(ss,{})]}),e.jsx(ve,{menu:{items:i},trigger:["click"],children:e.jsx("a",{className:"content-center",onClick:n=>n.preventDefault(),children:e.jsx(ke,{})})})]})]})})})},cs=({children:s})=>{const{user:t,loading:a}=S(),i=_e();return a?e.jsx("div",{className:"h-[100vh] content-center",children:e.jsx("div",{className:"flex justify-center ",children:e.jsx(T,{size:"large"})})}):t?s:e.jsx(B,{to:"/login",state:{from:i}})};function is(){const{user:s}=S();return e.jsx(e.Fragment,{children:e.jsxs(Pe,{user:s,children:[e.jsx(rs,{}),e.jsx("div",{className:"lg:px-[46px]",children:e.jsxs(Ae,{children:[e.jsx(M,{path:"/",element:e.jsx(cs,{children:e.jsx(Xe,{})})}),e.jsx(M,{path:"/login",element:e.jsx(Ye,{})}),e.jsx(M,{path:"/register",element:e.jsx(es,{})}),e.jsx(M,{path:"*",element:e.jsx(B,{to:"/"})})]})})]})})}fe.createRoot(document.getElementById("root")).render(e.jsx(ge.StrictMode,{children:e.jsx($e,{children:e.jsx(Oe,{basename:"/chatApp",children:e.jsx(is,{})})})}));
