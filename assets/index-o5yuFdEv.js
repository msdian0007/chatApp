const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/react-input-emoji-BIUyQkSU.js","assets/react-DHBI0EtI.js","assets/classnames-C9FZUsQl.js","assets/react-dom-vAgahkSm.js","assets/scheduler-CzFDRTuY.js"])))=>i.map(i=>d[i]);
import{r as n,j as e,a as ae}from"./react-DHBI0EtI.js";import{c as ke}from"./react-dom-vAgahkSm.js";import{a as Ae}from"./axios-B4uVmeYG.js";import{l as _e}from"./socket.io-client-DFi9RC7o.js";import{s as k,S as v,T as D,a as q,B as E,P as ne,b as re,A as ce,D as Ue}from"./antd-9lfNMwOU.js";import{o as X,p as ee,q as Fe,r as Ee,s as oe,v as Oe,w as Pe,x as $e,y as Te,z as qe,A as Be,B as se}from"./@ant-design-B6Q0FTRt.js";import{h as M}from"./moment-C5S46NFB.js";import{d as H,a as De,b as ze,e as Me,f as z}from"./react-router-mPJ5A8eT.js";import{L as He,B as Je}from"./react-router-dom-CBWY55wr.js";import"./classnames-C9FZUsQl.js";import"./scheduler-CzFDRTuY.js";import"./engine.io-client-DBBxzneW.js";import"./engine.io-parser-BiEtp6m2.js";import"./@socket.io-Dkula2eQ.js";import"./socket.io-parser-BBkuslX-.js";import"./rc-util-DRk5y4Yu.js";import"./@babel-DDXZNtFh.js";import"./rc-resize-observer-DhIh4Bln.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./rc-motion-B7bZ38Ss.js";import"./rc-overflow-DZRiDIAM.js";import"./rc-tooltip-DduOv04A.js";import"./@rc-component-Db8YWiD8.js";import"./rc-menu-DFg7V8Qr.js";import"./rc-dropdown-1QSiw7eM.js";import"./rc-field-form-BLZ5SSc5.js";import"./@ctrl-DOFZgDuz.js";import"./throttle-debounce-CUWDS_la.js";import"./rc-notification-B-HVxHmI.js";import"./rc-pagination-TIHhowL0.js";import"./rc-picker-CcREweDU.js";import"./@emotion-CW87jbl0.js";import"./stylis-DsJDcYJc.js";import"./@remix-run-BZ1VHzzA.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const m of o.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&a(m)}).observe(document,{childList:!0,subtree:!0});function r(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(i){if(i.ep)return;i.ep=!0;const o=r(i);fetch(i.href,o)}})();let ie="",le="";ie="https://chatapp-5f1p.onrender.com/api",le="https://chatapp-socket-oi5c.onrender.com";const Ve=Object.freeze({server:ie,socket:le}),de=Ve,C=Ae.create({baseURL:de.server,timeout:4e4,headers:{"Content-Type":"application/json"}}),I=s=>{s.response&&s.response.data?k.error(s.response.data.message):s.message?k.error(s.message):k.error("An error occurred. Please try again.")},We="/chatApp/assets/sendChatText-BBkJDNT7.mp3",Ke="/chatApp/assets/receivedChatText-CUg_h8vX.mp3",Qe="/chatApp/assets/receivedUnreadText-FvxPMJ05.mp3",ue=s=>s.filter(t=>!t.isRead),Xe=(s,t)=>ue(s).filter(a=>a.senderId===t).length,Q=s=>{try{let t;return s==="SEND"?t=new Audio(We):s==="RECV"?t=new Audio(Ke):s==="UN"&&(t=new Audio(Qe)),t.play()}catch(t){console.log("Failed to play sound:",t)}},J=()=>({getDpName:(s,t)=>s&&t?s.charAt(0)+t.charAt(0):s?s.charAt(0):"",getLatestChatOnTop:s=>s.sort((r,a)=>{let i=new Date(r.updatedAt);return new Date(a.updatedAt)-i}),getLatestChatOnTopByChatId:(s,t)=>{var a;if(console.log(s),!s||((a=s[0])==null?void 0:a._id)===t)return 0;const r=s==null?void 0:s.filter(i=>i._id!==t);return r==null||r.unshift(s.find(i=>i._id===t)),r}}),me=n.createContext(null),Ge=({children:s,user:t})=>{const{getLatestChatOnTopByChatId:r,getLatestChatOnTop:a}=J(),[i,o]=n.useState(!1),[m,c]=n.useState(null),[l,p]=n.useState([]),[x,d]=n.useState([]),[g,h]=n.useState(!1),[S,A]=n.useState([]),[U,b]=n.useState([]),[u,O]=n.useState(null),[P,G]=n.useState(!1),[W,B]=n.useState(null),[Y,je]=n.useState(null),[y,Ne]=n.useState(null),[ve,be]=n.useState([]),[$,T]=n.useState([]),[Ce,ye]=n.useState(!1),we=n.useCallback(async(j,f)=>{try{c(f);const N=await C.post("/chats",{firstId:j,secondId:f});N.data&&(p(w=>[N.data,...w]),c(null))}catch(N){c(null),I(N)}},[]),Ie=n.useCallback(async(j,f,N,w,_)=>{try{if(!j)return;let L=W;L=[...L,{text:j,createdAt:new Date,senderId:f}],B(L),Q("SEND"),_("");const K=await C.post("/messages/sendMessage",{chatId:w,senderId:f,text:j});if(K.data){je(K.data),L.pop(),B(()=>[...L,K.data]);const Z=r(x,w);Z&&d(Z)}}catch(L){I(L)}},[W,x]),Se=n.useCallback((j,f)=>{O(j);const N=$.map(w=>w.senderId===f?{...w,isRead:!0}:w);T(N)},[$]),Re=n.useCallback(async(j,f)=>{try{const N=await C.get(`/chats/${j}/${f}`);if(N.data){O(N.data);const w=$.map(_=>_.senderId===j?{..._,isRead:!0}:_);T(w)}}catch(N){I(N)}},[$]),Le=n.useCallback(j=>{const f=j.map(N=>({...N,isRead:!0}));T(f)},[]);return n.useEffect(()=>{if(!t)return;(async()=>{try{o(!0);const f=await C.get(`/chats/${t==null?void 0:t._id}`);if(f.data){const N=a(f.data);p(N),o(!1)}}catch(f){I(f)}})()},[t]),n.useEffect(()=>{d(l)},[l]),n.useEffect(()=>{if(!t)return;(async()=>{try{h(!0);const f=await C.get(`/user/getAllFriends/${t._id}`);if(f.data){const N=f.data.filter(w=>{let _=!1;return t._id===w._id?!1:(l&&(_=l==null?void 0:l.some(L=>L.members[0]===w._id||L.members[1]===w._id)),!_)});b(f.data),A(N),h(!1)}}catch(f){h(!1),I(f)}})()},[l,Ce]),n.useEffect(()=>{const j=async()=>{try{G(!0);const N=await C.get(`/messages/${u==null?void 0:u._id}`);N.data&&(B(N.data),G(!1))}catch(N){I(N)}},f=async()=>{try{await C.post("/chats/markMessagesAsRead",{chatId:u==null?void 0:u._id,userId:t==null?void 0:t._id})}catch(N){I(N)}};u&&(j(),f())},[u]),n.useEffect(()=>{const j=_e(de.socket);return Ne(j),()=>{j.disconnect()}},[t]),n.useEffect(()=>{y===null&&!t||y.emit("addOnlineUser",t==null?void 0:t._id)},[y]),n.useEffect(()=>{if(!(y===null&&!t))return y.on("getOnlineUsers",j=>{be(j)}),()=>{y.off("getOnlineUsers")}},[y]),n.useEffect(()=>{y===null&&!t||y.emit("sendNewMessage",{recipientId:u==null?void 0:u.members.find(j=>j!==(t==null?void 0:t._id)),textMessage:Y})},[Y]),n.useEffect(()=>{if(!(y===null&&!t))return y.on("getNewMessage",j=>{(u==null?void 0:u._id)===j.chatId&&B(N=>[...N,j]);const f=r(x,j.chatId);f&&d(f)}),y.on("sendNotification",j=>{u!=null&&u.members.find(f=>f===j.senderId)?(T(f=>[{...j,isRead:!0},...f]),Q("RECV")):(T(f=>[j,...f]),Q("UN"))}),()=>{y.off("getNewMessage"),y.off("sendNotification")}},[y,u,x]),e.jsx(e.Fragment,{children:e.jsx(me.Provider,{value:{userChat:l,selectedChat:m,chatList:x,chatLoading:i,potentialChats:S,potentialChatsLoading:g,allUsers:U,createChat:we,currentChat:u,updateCurrentChat:Se,messages:W,messagesLoading:P,sendTextMessage:Ie,onlineUsers:ve,notifications:$,openNewChat:Re,markAllAsRead:Le,setIsNewFriendAdded:ye},children:s})})},F=()=>n.useContext(me),Ye=()=>e.jsx("div",{className:"flex items-center justify-between p-2 cursor-pointer user-card",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"",children:e.jsx(v.Avatar,{size:"large",active:!0})}),e.jsxs("div",{className:"text-content",children:[e.jsx(v.Input,{size:"small",style:{height:"14px"},block:!0,active:!0}),e.jsx(v.Input,{size:"small",style:{height:"10px"},active:!0})]})]})}),Ze=()=>e.jsx("div",{className:"chat-box content-center !bg-neutral-900 min-h-[calc(100vh-8vh)]",children:e.jsxs("div",{className:"px-1 pb-4 messages lg:px-4",children:[e.jsx(v.Input,{className:"message self !p-0 !bg-transparent",active:!0}),e.jsx(v.Input,{className:"message !p-0 !bg-transparent",active:!0}),e.jsx(v.Input,{className:"message !p-0 !bg-transparent",active:!0}),e.jsx(v.Input,{className:"message !p-0 !bg-transparent",active:!0}),e.jsx(v.Input,{className:"message self !p-0 !bg-transparent",active:!0}),e.jsx(v.Input,{className:"message self !p-0 !bg-transparent",active:!0}),e.jsx(v.Input,{className:"message self !p-0 !bg-transparent",active:!0}),e.jsx(v.Input,{className:"message self !p-0 !bg-transparent",active:!0}),e.jsx(v.Input,{className:"message !p-0 !bg-transparent",active:!0}),e.jsx(v.Input,{className:"message !p-0 !bg-transparent",active:!0}),e.jsx(v.Input,{className:"message !p-0 !bg-transparent",active:!0}),e.jsx(v.Input,{className:"message self !p-0 !bg-transparent",active:!0}),e.jsx(v.Input,{className:"message !p-0 !bg-transparent",active:!0}),e.jsx(v.Input,{className:"message !p-0 !bg-transparent",active:!0}),e.jsx(v.Input,{className:"message !p-0 !bg-transparent",active:!0}),e.jsx(v.Input,{className:"message self !p-0 !bg-transparent",active:!0}),e.jsx(v.Input,{className:"message self !p-0 !bg-transparent",active:!0}),e.jsx(v.Input,{className:"message self !p-0 !bg-transparent",active:!0}),e.jsx(v.Input,{className:"message self !p-0 !bg-transparent",active:!0}),e.jsx(v.Input,{className:"message !p-0 !bg-transparent",active:!0}),e.jsx(v.Input,{className:"message !p-0 !bg-transparent",active:!0}),e.jsx(v.Input,{className:"message self !p-0 !bg-transparent",active:!0})]})}),pe=n.createContext(),es=({children:s})=>{const[t,r]=n.useState(!0),[a,i]=n.useState(!1),[o,m]=n.useState(null),[c,l]=n.useState(!1),[p,x]=n.useState({firstName:"",lastName:"",phoneNumber:"",password:""}),[d,g]=n.useState({phoneNumber:"",password:""}),h=n.useCallback(async()=>{try{if(!p.phoneNumber&&!p.password&&!p.firstName&&!p.lastName)return k.warning("All fields required");l(!0);const u=await C.post("/user/register",p);u.data&&(localStorage.setItem("userData",JSON.stringify(u.data)),m(u.data),l(!1),k.success(u.data.message))}catch(u){l(!1),I(u)}},[p]),S=n.useCallback(u=>{x(u)},[]),A=n.useCallback(u=>{g(u)},[]),U=n.useCallback(()=>{localStorage.removeItem("userData"),m(null)},[]),b=n.useCallback(async()=>{try{if(!d.phoneNumber&&!d.password)return k.success("All fields required");i(!0);const u=await C.post("/user/login",d);u.data&&(localStorage.setItem("userData",JSON.stringify(u.data)),m(u.data),i(!1),k.success(u.data.message))}catch(u){i(!1),I(u)}},[d]);return n.useEffect(()=>{const u=localStorage.getItem("userData");m(JSON.parse(u)),r(!1)},[]),e.jsx(e.Fragment,{children:e.jsx(pe.Provider,{value:{user:o,registerInfo:p,updateRegisterInfo:S,registerLoading:c,registerUser:h,loading:t,logOut:U,logIn:b,loginLoading:a,loginInfo:d,updateLoginInfo:A},children:s})})},R=()=>n.useContext(pe),ss=(s,t)=>{const{sender_details:r,receiver_details:a}=s;return s.sender===t?e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-orange-600",children:a.firstName+" "+a.lastName+" "}),s.status==="accepted"?e.jsx(D,{color:"success",icon:e.jsx(X,{}),children:"accepted"}):e.jsx(D,{color:"default",icon:e.jsx(ee,{}),children:"pending"})]}),e.jsx("span",{children:a.phoneNumber})]}):e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-orange-600",children:r.firstName+" "+r.lastName+" "}),s.status==="accepted"?e.jsx(D,{color:"success",icon:e.jsx(X,{}),children:"friendzz"}):e.jsx(D,{color:"default",icon:e.jsx(ee,{}),children:"pending"})]}),e.jsx("span",{children:r.phoneNumber})]})},ts=(s,t)=>{let r=0;return r=typeof s=="number"?s:0,r+=t,r?e.jsx("div",{className:"flex justify-end",children:e.jsx("span",{className:"this-user-notifications",children:r})}):e.jsx(e.Fragment,{})},as=(s,t)=>s&&(s==null?void 0:s.senderId)!==(t==null?void 0:t._id)?e.jsxs("div",{className:"flex text-[12px]",children:[e.jsx("div",{className:"pr-1 font-bold text-orange-400",children:"you:"}),e.jsx("div",{className:"truncate",children:s==null?void 0:s.text})]}):e.jsx("div",{className:"truncate text",children:s==null?void 0:s.text}),xe=(s,t)=>t.some(a=>a.userId===s)&&e.jsx("div",{className:"absolute bottom-0 right-0 w-3 h-3 bg-green-500 border-2 border-white rounded-full"}),ns=({chat:s})=>{const{user:t}=R(),{getDpName:r}=J(),{createChat:a,onlineUsers:i,selectedChat:o}=F();return e.jsx(e.Fragment,{children:o===(s==null?void 0:s._id)?e.jsx("div",{className:"flex flex-col items-center p-2 rounded-lg cursor-pointer w-14",children:e.jsx("div",{className:"relative w-9 h-9",children:e.jsx(q,{})})}):e.jsxs("div",{className:"flex flex-col items-center rounded-lg cursor-pointer w-14",onClick:()=>a(t==null?void 0:t._id,s==null?void 0:s._id),children:[e.jsxs("div",{className:"relative w-9 h-9",children:[e.jsx("div",{className:"w-full h-full rounded-full object-cover text-[12px] bg-violet-600 text-center content-center",children:r(s==null?void 0:s.firstName,s==null?void 0:s.lastName)}),xe(s==null?void 0:s._id,i)]}),e.jsx("div",{className:"mt-1 text-[10px] text-center",children:s==null?void 0:s.firstName})]})})},ge=ae.memo(()=>{const{potentialChats:s,createChat:t,onlineUsers:r}=F();return e.jsx(e.Fragment,{children:e.jsx("div",{className:"flex justify-around gap-4 overflow-x-scroll  md:gap-14 scrollbar",children:(s==null?void 0:s.length)>0&&s.map((a,i)=>e.jsx(ns,{chat:a},a==null?void 0:a._id))})})});ge.displayName="PotentialChats";const V=()=>{const[s,t]=n.useState(),[r,a]=n.useState(!1),[i,o]=n.useState([]),[m,c]=n.useState(!1),[l,p]=n.useState(),[x,d]=n.useState(!1);return{recipientLoading:r,recipient:s,searchedUsersLoading:m,searchedUsers:i,recipients:l,recipientsLoading:x,setSearchedUsers:o,getRecipient:async g=>{try{a(!0);const h=await C.get(`/user/find/${g}`);h.data&&(t(h.data),a(!1))}catch{a(!1)}},getRecipients:async g=>{try{d(!0);const h=await C.post("/user/getUsersById",{recipientId:g});h.data&&(p(h.data),d(!1))}catch{d(!1)}},searchUsersByPhoneNumber:async g=>{try{c(!0);const h=await C.get(`/user/findByNumber/${g}`);h.data&&(o(h.data),c(!1))}catch{c(!1)}}}},rs="modulepreload",cs=function(s){return"/chatApp/"+s},te={},os=function(t,r,a){let i=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),m=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));i=Promise.all(r.map(c=>{if(c=cs(c),c in te)return;te[c]=!0;const l=c.endsWith(".css"),p=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${p}`))return;const x=document.createElement("link");if(x.rel=l?"stylesheet":rs,l||(x.as="script",x.crossOrigin=""),x.href=c,m&&x.setAttribute("nonce",m),document.head.appendChild(x),l)return new Promise((d,g)=>{x.addEventListener("load",d),x.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${c}`)))})}))}return i.then(()=>t()).catch(o=>{const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=o,window.dispatchEvent(m),!m.defaultPrevented)throw o})},is=n.lazy(()=>os(()=>import("./react-input-emoji-BIUyQkSU.js"),__vite__mapDeps([0,1,2,3,4]))),ls=({text:s,handleChange:t})=>e.jsx(e.Fragment,{children:e.jsx(n.Suspense,{fallback:e.jsx(q,{}),children:e.jsx(is,{value:s,keepOpened:!0,height:"5px",onChange:t,fontFamily:"nunito",borderColor:"rgba(72, 112, 223, 0.2)"})})}),ds="/chatApp/assets/Chat-amico-BTnA9QnS.png",us=()=>({sendAndReceivedMessages:(s,t)=>e.jsx(e.Fragment,{children:s&&s.map((r,a)=>e.jsxs("div",{className:`${r.senderId===(t==null?void 0:t._id)?"message self ":"message "} `,children:[e.jsx("div",{children:r.text}),e.jsx("div",{className:`${r.senderId===(t==null?void 0:t._id)?"message-footer self":"message-footer "} `,children:M(r.createdAt).calendar()})]},a))})}),ms=({setIsChatBoxOpen:s})=>{const{messages:t,messagesLoading:r,currentChat:a,sendTextMessage:i,updateCurrentChat:o}=F(),{loading:m,recipient:c,getRecipient:l}=V(),[p,x]=n.useState(""),d=n.useRef(),{user:g}=R(),{sendAndReceivedMessages:h}=us(),S=a==null?void 0:a.members.find(b=>b!==(g==null?void 0:g._id));n.useEffect(()=>{S&&l(S)},[a]),n.useEffect(()=>{const b=d.current;b!=null&&b.scrollHeight&&(b.scrollTop=b==null?void 0:b.scrollHeight)},[t]);const A=n.useCallback(b=>{x(b)},[]),U=()=>{o(null,null),s(!1)};return r?e.jsx(Ze,{}):a?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"relative chat-box min-h-[calc(100vh-9vh)] rounded-md",children:[e.jsxs("div",{className:"chat-header min-h-[6vh] !flex !justify-between",children:[e.jsx("div",{className:"ml-3 text-xl cursor-pointer lg:text-lg",onClick:U,children:e.jsx(Fe,{})}),e.jsx("strong",{children:c==null?void 0:c.firstName}),e.jsx("span",{})]}),e.jsx("div",{className:" px-2 pt-2 messages pb-[10vh]",ref:d,children:h(t,g)}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 flex py-2 bg-black/80",children:[e.jsx("div",{className:"flex-1 w-[85%]",children:e.jsx(ls,{text:p,handleChange:A})}),e.jsx("div",{className:"content-center flex-none mr-3 text-center",children:e.jsx(Ee,{className:"px-3 py-3 text-xl bg-blue-600 rounded-full ",onClick:()=>i(p,g==null?void 0:g._id,S,a._id,x)})})]})]})}):e.jsx("div",{className:"chat-box content-center min-h-[calc(100vh-12vh)]",children:e.jsx("div",{className:"flex justify-center ",children:e.jsx("img",{className:"max-w-md",src:ds})})})},ps=({u:s,handleChatRequest:t,chatReqLoading:r})=>{const{getDpName:a}=J();return e.jsxs("div",{className:"flex items-center justify-between p-2 cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"relative w-9 h-9",children:e.jsx("div",{className:"content-center object-cover w-full h-full text-center rounded-full bg-slate-400",children:a(s==null?void 0:s.firstName,s==null?void 0:s.lastName)})}),e.jsx("div",{className:"text-content",children:e.jsx("div",{className:"name",children:(s==null?void 0:s.firstName)+" "+(s==null?void 0:s.lastName)})})]}),e.jsx(E,{loading:r,onClick:()=>t(s==null?void 0:s._id),className:"content-center px-2 py-1 text-right ",children:"Chat Request"})]})},he=()=>{const[s,t]=n.useState(!1),[r,a]=n.useState(!0),[i,o]=n.useState(),[m,c]=n.useState(null);return{lastMessageLoading:r,lastMessage:i,chatReqLoading:s,chatInfo:m,getChatInfo:async l=>{try{const p=await C.get(`/chats/getChatInfo/${l}`);p.data&&c(p.data)}catch(p){I(p)}},getLatestMessage:async l=>{try{const p=await C.get(`/messages/latest/${l}`);p.data&&(o(p.data),a(!1))}catch(p){I(p)}},sendChatRequest:async(l,p)=>{try{t(!0);const x=await C.post("/chats/sendChatRequest",{senderId:l,recipientId:p});if(x.data)return k.success("Request send successfully"),t(!1),x.data}catch(x){t(!1),I(x)}},respondChatRequest:async(l,p,x)=>{try{(await C.post("/chats/chatRequestResponse",{senderId:l,recipientId:p,respond:x})).data}catch(d){I(d)}}}},xs=({setIsSearching:s,isSearching:t})=>{const{searchedUsersLoading:r,searchedUsers:a,setSearchedUsers:i,searchUsersByPhoneNumber:o}=V(),{sendChatRequest:m,chatReqLoading:c}=he(),{user:l}=R(),[p,x]=n.useState(""),d=()=>{p&&o(p)},g=async h=>{if((l==null?void 0:l._id)===h)return k.warning("Abey saale ðŸ™‚");await m(l==null?void 0:l._id,h),i([]),x(""),s(0)};return n.useEffect(()=>{i([]),x("")},[t]),e.jsx("div",{className:"py-3 text-center ",children:e.jsxs("div",{className:"relative mx-2 ",children:[e.jsx("input",{type:"number",placeholder:`${t?"Enter phone number...":"search friends..."}`,className:`${t?"placeholder-orange-400":""} z-30 w-full h-12 px-3 py-1 text-sm rounded-full lg:h-10 bg-black/45`,value:p,onChange:h=>x(h.target.value),onClick:()=>s(1)}),r?e.jsx(E,{className:"absolute  border-0 !content-center rounded-full !px-7  !right-1 top-1 h-auto bottom-1",icon:e.jsx(oe,{}),loading:!0}):e.jsx(E,{className:"absolute bg-orange-500 text-white border-0 !content-center rounded-full !px-7  !right-1 top-1 h-auto bottom-1",icon:e.jsx(Oe,{}),onClick:d}),r?e.jsx(e.Fragment,{}):(a==null?void 0:a.length)>0&&e.jsx("div",{className:"absolute z-20 w-full py-2 mt-4 bg-gray-700 border rounded-md border-black/35",children:a==null?void 0:a.map((h,S)=>e.jsx(ps,{u:h,handleChatRequest:g,chatReqLoading:c},S))})]})})};function gs({chat:s,setIsChatBoxOpen:t}){const{onlineUsers:r,notifications:a,updateCurrentChat:i,messages:o}=F(),{getRecipient:m,recipient:c,recipientLoading:l}=V(),{getLatestMessage:p,lastMessage:x}=he(),{getDpName:d}=J(),{user:g}=R(),h=Xe(a,c==null?void 0:c._id),[S,A]=n.useState(0),U=()=>{i(s,c==null?void 0:c._id),t(!0),A(0)};return n.useEffect(()=>{var O;const b=s==null?void 0:s.members.find(P=>P!==(g==null?void 0:g._id)),u=(O=s==null?void 0:s.unreadCounts)==null?void 0:O.find(P=>P.userId!==b);b&&m(b),A(u==null?void 0:u.count)},[s]),n.useEffect(()=>{p(s==null?void 0:s._id)},[a,o]),e.jsx(e.Fragment,{children:!c||l?e.jsx(Ye,{}):e.jsxs("div",{className:"flex items-center justify-between p-2 cursor-pointer user-card",onClick:U,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative w-9 h-9",children:[e.jsx("div",{className:"content-center object-cover w-full h-full text-center rounded-full bg-slate-400",children:d((c==null?void 0:c.firstName)+" "+(c==null?void 0:c.lastName))}),xe(c==null?void 0:c._id,r)]}),e.jsxs("div",{className:"text-content",children:[e.jsx("div",{className:"name",children:(c==null?void 0:c.firstName)+" "+(c==null?void 0:c.lastName)}),as(x,c)]})]}),e.jsxs("div",{className:"grid items-end gap-1 text-right",children:[e.jsx("div",{className:"date !text-[10px]",children:M(x==null?void 0:x.updatedAt).calendar()}),ts(S,h)]})]})})}function hs({setIsChatBoxOpen:s}){const{chatList:t,chatLoading:r}=F();return e.jsx(e.Fragment,{children:e.jsx("div",{className:"",children:t.map((a,i)=>e.jsx(gs,{chat:a,setIsChatBoxOpen:s},a==null?void 0:a._id))})})}const fs=()=>{const[s,t]=n.useState(0),[r,a]=n.useState(!1),i=n.useCallback(()=>{t(0)},[]);return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-8",children:[e.jsxs("div",{className:`${r?"hidden md:block col-span-3":"md:col-span-3 col-span-8 relative"} px-2 w-full`,children:[e.jsx(xs,{setIsSearching:t,isSearching:s}),e.jsx("div",{hidden:!s,onClick:i,className:"absolute rounded-md z-10 w-full min-h-[calc(100vh-15vh)] bg-black bg-opacity-85"}),e.jsxs("div",{className:"relative max-h-[calc(100vh-18vh)] overflow-scroll",children:[e.jsx(ge,{}),e.jsx(hs,{setIsChatBoxOpen:a})]})]}),e.jsx("div",{className:`${r?"md:col-span-5 col-span-8":"hidden md:block"} col-span-5 content-center`,children:e.jsx(ms,{setIsChatBoxOpen:a})})]})})},js=()=>{const{logIn:s,user:t,updateLoginInfo:r,loginInfo:a,loginLoading:i}=R(),[o,m]=n.useState(!1);return e.jsxs(e.Fragment,{children:[t?e.jsx(H,{to:"/"}):null,e.jsx("div",{className:"flex justify-center min-h-[calc(100vh-10vh)]",children:e.jsxs("div",{className:"grid grid-cols-4 my-auto ",children:[e.jsxs("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-2",children:[e.jsx("label",{htmlFor:"",children:"Phone Number"}),e.jsx("input",{type:"number",className:"px-2 py-1 rounded-md bg-neutral-600",onChange:c=>r({...a,phoneNumber:c.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-7",children:[e.jsx("label",{htmlFor:"",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:`${o?"text":"password"}`,className:"px-2 py-1 rounded-md bg-neutral-600",onChange:c=>r({...a,password:c.target.value})}),e.jsx("span",{className:"absolute cursor-pointer right-2 top-1",onClick:()=>m(!o),children:"ðŸ‘"})]})]}),e.jsx("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-2",children:e.jsx(E,{onClick:s,loading:i,type:"primary",children:"Log In"})})]})})]})},Ns=()=>{const{registerInfo:s,user:t,updateRegisterInfo:r,registerUser:a,registerLoading:i}=R(),[o,m]=n.useState(!1);return e.jsxs(e.Fragment,{children:[t?e.jsx(H,{to:"/"}):null,e.jsx("form",{action:"",children:e.jsx("div",{className:"flex justify-center min-h-[calc(100vh-10vh)]",children:e.jsxs("div",{className:"grid grid-cols-4 my-auto ",children:[e.jsxs("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-2",children:[e.jsx("label",{htmlFor:"",children:"First Name"}),e.jsx("input",{type:"text",className:"px-2 py-1 rounded-md bg-neutral-600",onChange:c=>r({...s,firstName:c.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-2",children:[e.jsx("label",{htmlFor:"",children:"Last Name"}),e.jsx("input",{type:"text",className:"px-2 py-1 rounded-md bg-neutral-600",onChange:c=>r({...s,lastName:c.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-2",children:[e.jsx("label",{htmlFor:"",children:"Phone Number"}),e.jsx("input",{type:"number",className:"px-2 py-1 rounded-md bg-neutral-600",onChange:c=>r({...s,phoneNumber:c.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-7",children:[e.jsx("label",{htmlFor:"",children:"Create Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:`${o?"text":"password"}`,className:"px-2 py-1 rounded-md bg-neutral-600",onChange:c=>r({...s,password:c.target.value})}),e.jsx("span",{className:"absolute cursor-pointer right-2 top-1",onClick:()=>m(!o),children:"ðŸ‘"})]})]}),e.jsx("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-2",children:e.jsx(E,{onClick:a,type:"primary",loading:i,children:"Sign Up"})})]})})})]})},vs=()=>{const{user:s}=R(),{notifications:t,allUsers:r,openNewChat:a,markAllAsRead:i}=F(),[o,m]=n.useState(!1),c=ue(t),l=t.map(d=>{let g=r.find(h=>h._id===d.senderId);return{...d,senderName:g==null?void 0:g.firstName}}),p=(d,g)=>{a(d,g),m(!1)};let x=()=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid max-h-[26vh] overflow-y-auto",children:[l!=null&&l.length?l.map((d,g)=>e.jsxs("div",{className:`${d.isRead?" text-black/30":"text-black"} border-slate-300 cursor-pointer border-b-[1px] p-1`,onClick:()=>p(d==null?void 0:d.senderId,s==null?void 0:s._id),children:[e.jsx("span",{className:"font-bold ",children:d==null?void 0:d.senderName}),e.jsx("span",{children:" sent a message"}),e.jsx("span",{className:"text-[10px] pl-4 align-bottom italic",children:M(d==null?void 0:d.date).calendar()})]},g)):e.jsx("div",{className:"text-center text-rose-600",children:"Empty"}),(l==null?void 0:l.length)>1?e.jsx("div",{className:"flex justify-end pt-3",children:e.jsx(E,{className:"text-[12px]",size:"small",type:"default",onClick:()=>i(l),children:"Mark all as read"})}):null]})});return e.jsx(e.Fragment,{children:e.jsx(ne,{placement:"bottomRight",title:"Unread Notifications",content:x,trigger:"click",open:o,onOpenChange:()=>m(!o),children:e.jsx(re,{className:"content-center cursor-pointer",size:"small",count:c==null?void 0:c.length,children:e.jsx(ce,{className:"",shape:"circle",icon:e.jsx(Pe,{})})})})})},fe=()=>{const[s,t]=n.useState(),[r,a]=n.useState(null);return{chatRequest:s,loadingChatRespond:r,sendChatRequest:async(i,o)=>{try{if((await C.post("/chats/sendChatRequest",{senderId:i,recipientId:o})).data)return!0}catch(m){console.log(m),I(m)}},getChatRequestById:async i=>{try{const o=await C.get(`/chats/getChatRequest/${i}`);if(o.data)return t(o.data[0]),!0}catch(o){console.log(o)}},respondChatRequest:async(i,o,m)=>{try{a(i),(await C.post("/chats/chatRequestResponse",{chatReqId:i,recipientId:o,respond:m})).data&&a(null)}catch(c){a(null),console.log(c)}}}},bs=({chatReqId:s,handleRespondChatRequest:t,loadingChatRespond:r})=>{const{chatRequest:a,getChatRequestById:i}=fe(),{user:o}=R();return n.useEffect(()=>{i(s)},[s]),e.jsx(e.Fragment,{children:a?e.jsx("div",{children:e.jsxs("div",{className:"border-slate-300 cursor-pointer border-b-[1px] py-1 flex justify-between",children:[ss(a,o==null?void 0:o._id),e.jsxs("div",{className:"flex flex-col text-lg text-right",children:[a.status!=="accepted"&&a.sender!==(o==null?void 0:o._id)?e.jsx(e.Fragment,{children:r===s?e.jsx(q,{}):e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("div",{className:"px-4 py-0 text-gray-500 bg-green-500 rounded-md",onClick:()=>t(s,a==null?void 0:a.receiver,"accept"),children:e.jsx(X,{})}),e.jsx("div",{className:"px-4 py-0 text-gray-200 rounded-md bg-rose-600",onClick:()=>t(s,a==null?void 0:a.receiver,"reject"),children:e.jsx($e,{})})]})}):e.jsx("span",{className:"text-right",children:e.jsx(Te,{})}),e.jsx("span",{className:"text-[10px] pl-4 align-bottom italic",children:M(a.status!=="accepted"?a==null?void 0:a.sentAt:a==null?void 0:a.respondedAt).calendar()})]})]})}):e.jsx(e.Fragment,{})})},Cs=()=>{const{user:s}=R(),{setIsNewFriendAdded:t}=F(),{getRecipient:r,recipient:a,recipientLoading:i}=V(),{respondChatRequest:o,loadingChatRespond:m}=fe(),[c,l]=n.useState(!1);n.useEffect(()=>{s&&r(s._id)},[s]);const p=async(d,g,h)=>{await o(d,g,h),await r(s._id),t(!0),l(!1)};let x=()=>{var d,g;return e.jsx(e.Fragment,{children:e.jsx("div",{className:"grid max-h-[26vh] overflow-y-auto",children:i?e.jsx(q,{}):e.jsx(e.Fragment,{children:(d=a==null?void 0:a.friendRequests)!=null&&d.length?(g=a==null?void 0:a.friendRequests)==null?void 0:g.map((h,S)=>e.jsx(bs,{chatReqId:h,handleRespondChatRequest:p,loadingChatRespond:m},h)).reverse():e.jsx("div",{className:"text-center text-rose-600",children:"No Chat Requests"})})})})};return e.jsx(ne,{placement:"bottomRight",title:"Chat Requests",content:x,trigger:"click",open:c,onOpenChange:()=>l(!c),children:e.jsx(re,{className:"content-center cursor-pointer",size:"small",children:e.jsx(ce,{className:"",shape:"circle",icon:e.jsx(qe,{})})})})},ys=()=>{const{user:s,logOut:t}=R(),r=De(),a=s?[{label:"Logout",key:"1",icon:e.jsx(oe,{}),onClick:()=>{t()}}]:[{label:"Login",key:"1",icon:e.jsx(se,{}),onClick:()=>{r("/login")}},{label:"Register",key:"2",icon:e.jsx(se,{}),onClick:()=>{r("/register")}}];return e.jsx(e.Fragment,{children:e.jsx("div",{className:" bg-slate-700",children:e.jsxs("div",{className:"flex justify-between min-h-[8vh]  px-3 ",children:[e.jsx("div",{className:"content-center hidden cursor-pointer lg:block",children:e.jsx(He,{to:"/",children:"ChatApp"})}),e.jsxs("div",{className:"flex gap-1 ",children:[s&&e.jsxs("div",{className:"content-center",children:[e.jsx("span",{children:"Hi "}),e.jsx("span",{className:"italic text-amber-500",children:s==null?void 0:s.firstName}),e.jsx("span",{children:"..."})]}),e.jsx("div",{className:"content-center italic scale-125",children:"ðŸ"})]}),e.jsxs("div",{className:"flex gap-2 my-auto lg:gap-4",children:[s&&e.jsxs("div",{className:"flex gap-2 lg:gap-2",children:[e.jsx(vs,{}),e.jsx(Cs,{})]}),e.jsx(Ue,{menu:{items:a},trigger:["click"],children:e.jsx("a",{className:"flex content-center pl-3",onClick:i=>i.preventDefault(),children:e.jsx(Be,{className:"text-xl"})})})]})]})})})},ws=({children:s})=>{const{user:t,loading:r}=R(),a=ze();return r?e.jsx("div",{className:"h-[100vh] content-center",children:e.jsx("div",{className:"flex justify-center ",children:e.jsx(q,{size:"large"})})}):t?s:e.jsx(H,{to:"/login",state:{from:a}})};function Is(){const{user:s}=R();return e.jsx(e.Fragment,{children:e.jsxs(Ge,{user:s,children:[e.jsx(ys,{}),e.jsx("div",{className:"",children:e.jsxs(Me,{children:[e.jsx(z,{path:"/",element:e.jsx(ws,{children:e.jsx(fs,{})})}),e.jsx(z,{path:"/login",element:e.jsx(js,{})}),e.jsx(z,{path:"/register",element:e.jsx(Ns,{})}),e.jsx(z,{path:"*",element:e.jsx(H,{to:"/"})})]})})]})})}ke.createRoot(document.getElementById("root")).render(e.jsx(ae.StrictMode,{children:e.jsx(es,{children:e.jsx(Je,{basename:"/chatApp",children:e.jsx(Is,{})})})}));
