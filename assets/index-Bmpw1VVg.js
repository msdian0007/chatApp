const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/react-input-emoji-BIUyQkSU.js","assets/react-DHBI0EtI.js","assets/classnames-C9FZUsQl.js","assets/react-dom-vAgahkSm.js","assets/scheduler-CzFDRTuY.js"])))=>i.map(i=>d[i]);
import{r as n,j as e,a as je}from"./react-DHBI0EtI.js";import{c as Ne}from"./react-dom-vAgahkSm.js";import{a as ve}from"./axios-B4uVmeYG.js";import{l as be}from"./socket.io-client-DFi9RC7o.js";import{s as U,S as C,T as q,a as W,B as z,P as Q,b as Y,A as Z,D as ye}from"./antd-6Ubd68sw.js";import{h as D}from"./moment-C5S46NFB.js";import{o as H,p as K,q as Ce,r as we,j as Ie,s as Re,v as Se,w as ke,x as Le,y as Ue,z as Ae,A as X,B as _e}from"./@ant-design-BByiHhqh.js";import{d as T,a as Ee,b as Fe,e as Oe,f as B}from"./react-router-mPJ5A8eT.js";import{L as Pe,B as $e}from"./react-router-dom-CBWY55wr.js";import"./classnames-C9FZUsQl.js";import"./scheduler-CzFDRTuY.js";import"./engine.io-client-DBBxzneW.js";import"./engine.io-parser-BiEtp6m2.js";import"./@socket.io-Dkula2eQ.js";import"./socket.io-parser-BBkuslX-.js";import"./rc-util-DRk5y4Yu.js";import"./@babel-DDXZNtFh.js";import"./rc-resize-observer-DhIh4Bln.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./rc-motion-B7bZ38Ss.js";import"./rc-overflow-DZRiDIAM.js";import"./rc-tooltip-DduOv04A.js";import"./@rc-component-Db8YWiD8.js";import"./rc-menu-DFg7V8Qr.js";import"./rc-dropdown-1QSiw7eM.js";import"./rc-field-form-BLZ5SSc5.js";import"./@ctrl-DOFZgDuz.js";import"./throttle-debounce-CUWDS_la.js";import"./rc-notification-B-HVxHmI.js";import"./rc-pagination-TIHhowL0.js";import"./rc-picker-CcREweDU.js";import"./@emotion-CW87jbl0.js";import"./stylis-DsJDcYJc.js";import"./@remix-run-BZ1VHzzA.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))c(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const h of l.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&c(h)}).observe(document,{childList:!0,subtree:!0});function a(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function c(r){if(r.ep)return;r.ep=!0;const l=a(r);fetch(r.href,l)}})();let ee="",se="";ee="https://chatapp-5f1p.onrender.com/api",se="https://chatapp-socket-oi5c.onrender.com";const qe=Object.freeze({server:ee,socket:se}),te=qe,b=ve.create({baseURL:te.server,timeout:4e4,headers:{"Content-Type":"application/json"}}),w=s=>{s.response&&s.response.data?U.error(s.response.data.message):s.message?U.error(s.message):U.error("An error occurred. Please try again.")},Be="/chatApp/assets/sendChatText-BBkJDNT7.mp3",ze="/chatApp/assets/receivedChatText-CUg_h8vX.mp3",De="/chatApp/assets/receivedUnreadText-FvxPMJ05.mp3",ae=s=>s.filter(t=>!t.isRead),Te=(s,t)=>ae(s).filter(c=>c.senderId===t).length,J=s=>{try{let t;return s==="SEND"?t=new Audio(Be):s==="RECV"?t=new Audio(ze):s==="UN"&&(t=new Audio(De)),t.play()}catch(t){console.log("Failed to play sound:",t)}},ne=n.createContext(null),Me=({children:s,user:t})=>{const[a,c]=n.useState(!1),[r,l]=n.useState([]),[h,i]=n.useState([]),[d,o]=n.useState([]),[p,u]=n.useState([]),[m,x]=n.useState(null),[L,A]=n.useState(!1),[v,R]=n.useState(null),[j,F]=n.useState(null),[y,O]=n.useState(null),[le,de]=n.useState([]),[P,$]=n.useState([]),[me,ue]=n.useState(!1),he=n.useCallback(async(f,g)=>{try{c(!0);const N=await b.post("/chats",{firstId:f,secondId:g});N.data&&(l(I=>[N.data,...I]),c(!1))}catch(N){w(N)}},[]),pe=n.useCallback(async(f,g,N,I,_)=>{try{if(!f)return;let S=v;S=[...S,{text:f,createdAt:new Date,senderId:g}],R(S),J("SEND"),_("");const V=await b.post("/messages/sendMessage",{chatId:I,senderId:g,text:f});V.data&&(F(V.data),S.pop(),R(()=>[...S,V.data]))}catch(S){w(S)}},[v]),xe=n.useCallback((f,g)=>{x(f);const N=P.map(I=>I.senderId===g?{...I,isRead:!0}:I);$(N)},[P]),ge=n.useCallback(async(f,g)=>{try{const N=await b.get(`/chats/${f}/${g}`);if(N.data){x(N.data);const I=P.map(_=>_.senderId===f?{..._,isRead:!0}:_);$(I)}}catch(N){w(N)}},[P]),fe=n.useCallback(f=>{const g=f.map(N=>({...N,isRead:!0}));$(g)},[]);return n.useEffect(()=>{if(!t)return;(async()=>{try{c(!0);const g=await b.get(`/chats/${t==null?void 0:t._id}`);g.data&&(l(g.data),c(!1))}catch(g){w(g)}})()},[t]),n.useEffect(()=>{if(!t)return;(async()=>{try{i(!0);const g=await b.get(`/user/getAllFriends/${t._id}`);if(g.data){const N=g.data.filter(I=>{let _=!1;return t._id===I._id?!1:(r&&(_=r==null?void 0:r.some(S=>S.members[0]===I._id||S.members[1]===I._id)),!_)});u(g.data),o(N),i(!1)}}catch(g){i(!1),w(g)}})()},[r,me]),n.useEffect(()=>{const f=async()=>{try{A(!0);const N=await b.get(`/messages/${m==null?void 0:m._id}`);N.data&&(R(N.data),A(!1))}catch(N){w(N)}},g=async()=>{try{await b.post("/chats/markMessagesAsRead",{chatId:m==null?void 0:m._id,userId:t==null?void 0:t._id})}catch(N){w(N)}};m&&(f(),g())},[m]),n.useEffect(()=>{const f=be(te.socket);return O(f),()=>{f.disconnect()}},[t]),n.useEffect(()=>{y===null&&!t||y.emit("addOnlineUser",t==null?void 0:t._id)},[y]),n.useEffect(()=>{if(!(y===null&&!t))return y.on("getOnlineUsers",f=>{de(f)}),()=>{y.off("getOnlineUsers")}},[y]),n.useEffect(()=>{y===null&&!t||y.emit("sendNewMessage",{recipientId:m==null?void 0:m.members.find(f=>f!==(t==null?void 0:t._id)),textMessage:j})},[j]),n.useEffect(()=>{if(!(y===null&&!t))return y.on("getNewMessage",f=>{(m==null?void 0:m._id)===f.chatId&&R(g=>[...g,f])}),y.on("sendNotification",f=>{m!=null&&m.members.find(g=>g===f.senderId)?($(g=>[{...f,isRead:!0},...g]),J("RECV")):($(g=>[f,...g]),J("UN"))}),()=>{y.off("getNewMessage"),y.off("sendNotification")}},[y,m]),e.jsx(e.Fragment,{children:e.jsx(ne.Provider,{value:{userChat:r,chatLoading:a,potentialChats:d,potentialChatsLoading:h,allUsers:p,createChat:he,currentChat:m,updateCurrentChat:xe,messages:v,messagesLoading:L,sendTextMessage:pe,onlineUsers:le,notifications:P,openNewChat:ge,markAllAsRead:fe,setIsNewFriendAdded:ue},children:s})})},E=()=>n.useContext(ne),re=n.createContext(),Ve=({children:s})=>{const[t,a]=n.useState(!0),[c,r]=n.useState(!1),[l,h]=n.useState(null),[i,d]=n.useState(!1),[o,p]=n.useState({firstName:"",lastName:"",phoneNumber:"",password:""}),[u,m]=n.useState({phoneNumber:"",password:""}),x=n.useCallback(async()=>{try{if(!o.phoneNumber&&!o.password&&!o.firstName&&!o.lastName)return U.warning("All fields required");d(!0);const j=await b.post("/user/register",o);j.data&&(localStorage.setItem("userData",JSON.stringify(j.data)),h(j.data),d(!1),U.success(j.data.message))}catch(j){d(!1),w(j)}},[o]),L=n.useCallback(j=>{p(j)},[]),A=n.useCallback(j=>{m(j)},[]),v=n.useCallback(()=>{localStorage.removeItem("userData"),h(null)},[]),R=n.useCallback(async()=>{try{if(!u.phoneNumber&&!u.password)return U.success("All fields required");r(!0);const j=await b.post("/user/login",u);j.data&&(localStorage.setItem("userData",JSON.stringify(j.data)),h(j.data),r(!1),U.success(j.data.message))}catch(j){r(!1),w(j)}},[u]);return n.useEffect(()=>{const j=localStorage.getItem("userData");h(JSON.parse(j)),a(!1)},[]),e.jsx(e.Fragment,{children:e.jsx(re.Provider,{value:{user:l,registerInfo:o,updateRegisterInfo:L,registerLoading:i,registerUser:x,loading:t,logOut:v,logIn:R,loginLoading:c,loginInfo:u,updateLoginInfo:A},children:s})})},k=()=>n.useContext(re),M=()=>{const[s,t]=n.useState(),[a,c]=n.useState(!1),[r,l]=n.useState([]),[h,i]=n.useState(!1),[d,o]=n.useState(),[p,u]=n.useState(!1);return{recipientLoading:a,recipient:s,searchedUsersLoading:h,searchedUsers:r,recipients:d,recipientsLoading:p,setSearchedUsers:l,getRecipient:async m=>{try{c(!0);const x=await b.get(`/user/find/${m}`);x.data&&(t(x.data),c(!1))}catch{c(!1)}},getRecipients:async m=>{try{u(!0);const x=await b.post("/user/getUsersById",{recipientId:m});x.data&&(o(x.data),u(!1))}catch{u(!1)}},searchUsersByPhoneNumber:async m=>{try{i(!0);const x=await b.get(`/user/findByNumber/${m}`);x.data&&(l(x.data),i(!1))}catch{i(!1)}}}},Je=()=>e.jsx("div",{className:"user-card flex justify-between items-center p-2 cursor-pointer",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:" ",children:e.jsx(C.Avatar,{size:"large",active:!0})}),e.jsxs("div",{className:"text-content",children:[e.jsx(C.Input,{size:"small",style:{height:"14px"},block:!0,active:!0}),e.jsx(C.Input,{size:"small",style:{height:"10px"},active:!0})]})]})}),He=()=>e.jsxs("div",{className:"flex flex-col gap-1 items-center w-6 pl-8",children:[e.jsx(C.Avatar,{active:!0}),e.jsx(C.Button,{active:!0,size:"small",style:{height:"6px"}})]}),We=()=>e.jsx("div",{className:"chat-box content-center !bg-neutral-700 min-h-[calc(100vh-8vh)]",children:e.jsxs("div",{className:"messages pb-4 px-1 lg:px-4",children:[e.jsx(C.Input,{className:"message self !p-0 !bg-transparent",active:!0}),e.jsx(C.Input,{className:"message !p-0 !bg-transparent",active:!0}),e.jsx(C.Input,{className:"message !p-0 !bg-transparent",active:!0}),e.jsx(C.Input,{className:"message !p-0 !bg-transparent",active:!0}),e.jsx(C.Input,{className:"message !p-0 !bg-transparent",active:!0}),e.jsx(C.Input,{className:"message self !p-0 !bg-transparent",active:!0}),e.jsx(C.Input,{className:"message self !p-0 !bg-transparent",active:!0}),e.jsx(C.Input,{className:"message self !p-0 !bg-transparent",active:!0}),e.jsx(C.Input,{className:"message self !p-0 !bg-transparent",active:!0}),e.jsx(C.Input,{className:"message !p-0 !bg-transparent",active:!0})]})}),ce=()=>{const[s,t]=n.useState(!1),[a,c]=n.useState(!0),[r,l]=n.useState(),[h,i]=n.useState(null);return{lastMessageLoading:a,lastMessage:r,chatReqLoading:s,chatInfo:h,getChatInfo:async d=>{try{const o=await b.get(`/chats/getChatInfo/${d}`);o.data&&i(o.data)}catch(o){w(o)}},getLatestMessage:async d=>{try{const o=await b.get(`/messages/latest/${d}`);o.data&&(l(o.data),c(!1))}catch(o){w(o)}},sendChatRequest:async(d,o)=>{try{t(!0);const p=await b.post("/chats/sendChatRequest",{senderId:d,recipientId:o});if(p.data)return U.success("Request send successfully"),t(!1),p.data}catch(p){t(!1),w(p)}},respondChatRequest:async(d,o,p)=>{try{(await b.post("/chats/chatRequestResponse",{senderId:d,recipientId:o,respond:p})).data}catch(u){w(u)}}}},oe=()=>({getDpName:(s,t)=>s&&t?s.charAt(0)+t.charAt(0):s?s.charAt(0):""}),Ke=(s,t)=>{const{sender_details:a,receiver_details:c}=s;return s.sender===t?e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-orange-600",children:c.firstName+" "+c.lastName+" "}),s.status==="accepted"?e.jsx(q,{color:"success",icon:e.jsx(H,{}),children:"accepted"}):e.jsx(q,{color:"default",icon:e.jsx(K,{}),children:"pending"})]}),e.jsx("span",{children:c.phoneNumber})]}):e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-orange-600",children:a.firstName+" "+a.lastName+" "}),s.status==="accepted"?e.jsx(q,{color:"success",icon:e.jsx(H,{}),children:"friendzz"}):e.jsx(q,{color:"default",icon:e.jsx(K,{}),children:"pending"})]}),e.jsx("span",{children:a.phoneNumber})]})},Xe=(s,t)=>{let a=0;return a=typeof s=="number"?s:0,a+=t,a?e.jsx("div",{className:"flex justify-end",children:e.jsx("span",{className:"this-user-notifications",children:a})}):null},Ge=(s,t)=>s&&(s==null?void 0:s.senderId)!==(t==null?void 0:t._id)?e.jsxs("div",{className:"flex text-[12px]",children:[e.jsx("div",{className:"pr-1 font-bold text-orange-400",children:"you:"}),e.jsx("div",{className:"truncate",children:s==null?void 0:s.text})]}):e.jsx("div",{className:"text",children:s==null?void 0:s.text}),Qe=(s,t)=>t.some(c=>c.userId===s)&&e.jsx("div",{className:"absolute bottom-0 right-0 w-3 h-3 bg-green-500 border-2 border-white rounded-full"});function Ye({chat:s,user:t,index:a,setIsChatBoxOpen:c}){const{onlineUsers:r,notifications:l,updateCurrentChat:h,messages:i}=E(),{getRecipient:d,recipient:o,recipientLoading:p}=M(),{getLatestMessage:u,lastMessage:m}=ce(),{getDpName:x}=oe(),L=Te(l,o==null?void 0:o._id),[A,v]=n.useState(0),R=()=>{h(s,o==null?void 0:o._id),c(!0),v(0)};return n.useEffect(()=>{var y;const j=s==null?void 0:s.members.find(O=>O!==(t==null?void 0:t._id)),F=(y=s==null?void 0:s.unreadCounts)==null?void 0:y.find(O=>O.userId!==j);j&&d(j),v(F==null?void 0:F.count)},[s]),n.useEffect(()=>{u(s==null?void 0:s._id)},[l,i]),e.jsx(e.Fragment,{children:p?e.jsx(Je,{}):e.jsxs("div",{className:"flex items-center justify-between p-2 cursor-pointer user-card",onClick:R,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative w-9 h-9",children:[e.jsx("div",{className:"content-center object-cover w-full h-full text-center rounded-full bg-slate-400",children:x((o==null?void 0:o.firstName)+" "+(o==null?void 0:o.lastName))}),Qe(o==null?void 0:o._id,r)]}),e.jsxs("div",{className:"text-content",children:[e.jsx("div",{className:"name",children:(o==null?void 0:o.firstName)+" "+(o==null?void 0:o.lastName)}),Ge(m,o)]})]}),e.jsxs("div",{className:"grid items-end text-right",children:[e.jsx("div",{className:"date !text-[12px]",children:D(m==null?void 0:m.updatedAt).calendar()}),Xe(A,L)]})]})})}const Ze=({user:s})=>{const{potentialChats:t,createChat:a,onlineUsers:c,potentialChatsLoading:r}=E(),l=i=>c.some(o=>o.userId===i)&&e.jsx("div",{className:"absolute bottom-0 right-0 w-2 h-2 bg-green-500 border-[1px] border-white rounded-full"}),h=i=>i.split(" ").map(d=>d.charAt(0).toUpperCase()).join("");return e.jsx(e.Fragment,{children:e.jsx("div",{className:"flex justify-around gap-2 overflow-x-scroll overflow-y-hidden lg:justify-normal md:justify-normal scrollbar",children:r?e.jsx(He,{}):t&&t.map((i,d)=>e.jsxs("div",{className:"flex flex-col items-center p-2 mb-2 border-b-2 rounded-lg cursor-pointer w-14",onClick:()=>a(s==null?void 0:s._id,i==null?void 0:i._id),children:[e.jsxs("div",{className:"relative w-7 h-7",children:[e.jsx("div",{className:"w-full h-full rounded-full object-cover text-[12px] bg-violet-600 text-center content-center",children:h((i==null?void 0:i.firstName)+" "+(i==null?void 0:i.lastName))}),l(i._id)]}),e.jsx("div",{className:"mt-1 text-[9px] text-center",children:i==null?void 0:i.firstName})]},d))})})},es="modulepreload",ss=function(s){return"/chatApp/"+s},G={},ts=function(t,a,c){let r=Promise.resolve();if(a&&a.length>0){document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),h=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));r=Promise.all(a.map(i=>{if(i=ss(i),i in G)return;G[i]=!0;const d=i.endsWith(".css"),o=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${o}`))return;const p=document.createElement("link");if(p.rel=d?"stylesheet":es,d||(p.as="script",p.crossOrigin=""),p.href=i,h&&p.setAttribute("nonce",h),document.head.appendChild(p),d)return new Promise((u,m)=>{p.addEventListener("load",u),p.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${i}`)))})}))}return r.then(()=>t()).catch(l=>{const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=l,window.dispatchEvent(h),!h.defaultPrevented)throw l})},as=n.lazy(()=>ts(()=>import("./react-input-emoji-BIUyQkSU.js"),__vite__mapDeps([0,1,2,3,4]))),ns=n.memo(({text:s,handleChange:t})=>e.jsx(e.Fragment,{children:e.jsx(n.Suspense,{fallback:e.jsx(W,{}),children:e.jsx(as,{value:s,onChange:t,fontFamily:"nunito",borderColor:"rgba(72, 112, 223, 0.2)"})})})),rs=({user:s,setIsChatBoxOpen:t})=>{const{messages:a,messagesLoading:c,currentChat:r,sendTextMessage:l,updateCurrentChat:h}=E(),{loading:i,recipient:d,getRecipient:o}=M(),[p,u]=n.useState(""),m=n.useRef(),x=r==null?void 0:r.members.find(v=>v!==(s==null?void 0:s._id));n.useEffect(()=>{x&&o(x)},[r]),n.useEffect(()=>{var v;(v=m.current)==null||v.scrollIntoView({behavior:"smooth"})},[a]);const L=n.useCallback(v=>{u(v)},[]),A=()=>{h(null,null),t(!1)};return c?e.jsx(We,{}):r?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"chat-box relative min-h-[calc(100vh-8vh)]",children:[e.jsxs("div",{className:"chat-header min-h-[6vh] !flex !justify-between",children:[e.jsx("div",{className:"ml-6 text-xl cursor-pointer lg:text-lg",onClick:A,children:e.jsx(Ce,{})}),e.jsx("strong",{children:d==null?void 0:d.firstName}),e.jsx("span",{})]}),e.jsx("div",{className:"px-2 pt-2 messages pb-[10vh]",children:a&&a.map((v,R)=>e.jsxs("div",{ref:m,className:`${v.senderId===(s==null?void 0:s._id)?"message self ":"message "} `,children:[e.jsx("div",{children:v.text}),e.jsx("div",{className:"message-footer",children:D(v.createdAt).calendar()})]},R))}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 flex items-center max-h-[10vh] justify-between chat-input",children:[e.jsx(ns,{text:p,handleChange:L}),e.jsx(we,{className:"content-center px-4 py-3 text-xl bg-blue-600 rounded-full",onClick:()=>l(p,s==null?void 0:s._id,x,r._id,u)})]})]})}):e.jsx("div",{className:"chat-box content-center min-h-[calc(100vh-12vh)]",children:e.jsx("div",{className:"flex justify-center ",children:"...No conversation selected"})})},cs=({u:s,handleChatRequest:t,chatReqLoading:a})=>{const{getDpName:c}=oe();return e.jsxs("div",{className:"flex items-center justify-between p-2 cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"relative w-9 h-9",children:e.jsx("div",{className:"content-center object-cover w-full h-full text-center rounded-full bg-slate-400",children:c(s==null?void 0:s.firstName,s==null?void 0:s.lastName)})}),e.jsx("div",{className:"text-content",children:e.jsx("div",{className:"name",children:(s==null?void 0:s.firstName)+" "+(s==null?void 0:s.lastName)})})]}),e.jsx(z,{loading:a,onClick:()=>t(s==null?void 0:s._id),className:"content-center px-2 py-1 text-right ",children:"Chat Request"})]})},os=({setIsSearching:s,isSearching:t})=>{const{searchedUsersLoading:a,searchedUsers:c,setSearchedUsers:r,searchUsersByPhoneNumber:l}=M(),{sendChatRequest:h,chatReqLoading:i}=ce(),{user:d}=k(),[o,p]=n.useState(""),u=()=>{o&&l(o)},m=async x=>{if((d==null?void 0:d._id)===x)return U.warning("Abey saale ðŸ™‚");await h(d==null?void 0:d._id,x),r([]),p("")};return n.useEffect(()=>{r([]),p("")},[t]),e.jsx("div",{className:"my-2 text-center ",children:e.jsxs("div",{className:"relative mx-2 max-w-[480px]",children:[e.jsx("input",{type:"number",placeholder:"search friends...",className:"z-30 w-full h-10 px-3 py-1 text-sm rounded-md lg:h-8 bg-black/45",value:o,onChange:x=>p(x.target.value),onClick:()=>s(1)}),e.jsx("div",{className:"absolute content-center px-4 bg-orange-600 rounded-md hover:bg-orange-700 bottom-1 top-1 right-2",children:a?e.jsx(Ie,{}):e.jsx(Re,{className:"flex my-auto cursor-pointer",onClick:u})}),a?e.jsx(e.Fragment,{}):(c==null?void 0:c.length)>0&&e.jsx("div",{className:"absolute z-20 w-full py-2 mt-4 bg-gray-700 border rounded-md border-black/35",children:c==null?void 0:c.map((x,L)=>e.jsx(cs,{u:x,handleChatRequest:m,chatReqLoading:i},L))})]})})},is=()=>{const{userChat:s,chatLoading:t}=E(),{user:a}=k(),[c,r]=n.useState(0),[l,h]=n.useState(!1),i=()=>{r(0)};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-8",children:[e.jsxs("div",{className:`${l?"hidden lg:block col-span-3":"lg:col-span-3 col-span-8 relative"} "px-3 mb-2  "`,children:[e.jsx(os,{setIsSearching:r,isSearching:c}),e.jsx("div",{hidden:!c,onClick:i,className:"absolute rounded-md z-10 w-full min-h-[calc(100vh-15vh)] bg-black bg-opacity-85"}),e.jsx(Ze,{user:a}),e.jsx("div",{children:!t&&s.map((d,o)=>e.jsx("div",{children:e.jsx(Ye,{chat:d,user:a,index:o,setIsChatBoxOpen:h})},o))})]}),e.jsx("div",{className:`${l?"lg:col-span-5 col-span-8":"hidden lg:block"} col-span-5 lg:pl-2`,children:e.jsx(rs,{user:a,setIsChatBoxOpen:h})})]})})},ls=()=>{const{logIn:s,user:t,updateLoginInfo:a,loginInfo:c,loginLoading:r}=k(),[l,h]=n.useState(!1);return e.jsxs(e.Fragment,{children:[t?e.jsx(T,{to:"/"}):null,e.jsx("div",{className:"flex justify-center min-h-[calc(100vh-10vh)]",children:e.jsxs("div",{className:"grid grid-cols-4 my-auto ",children:[e.jsxs("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-2",children:[e.jsx("label",{htmlFor:"",children:"Phone Number"}),e.jsx("input",{type:"number",className:"px-2 py-1 rounded-md bg-neutral-600",onChange:i=>a({...c,phoneNumber:i.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-7",children:[e.jsx("label",{htmlFor:"",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:`${l?"text":"password"}`,className:"px-2 py-1 rounded-md bg-neutral-600",onChange:i=>a({...c,password:i.target.value})}),e.jsx("span",{className:"absolute cursor-pointer right-2 top-1",onClick:()=>h(!l),children:"ðŸ‘"})]})]}),e.jsx("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-2",children:e.jsx(z,{onClick:s,loading:r,type:"primary",children:"Log In"})})]})})]})},ds=()=>{const{registerInfo:s,user:t,updateRegisterInfo:a,registerUser:c,registerLoading:r}=k(),[l,h]=n.useState(!1);return e.jsxs(e.Fragment,{children:[t?e.jsx(T,{to:"/"}):null,e.jsx("form",{action:"",children:e.jsx("div",{className:"flex justify-center min-h-[calc(100vh-10vh)]",children:e.jsxs("div",{className:"grid grid-cols-4 my-auto ",children:[e.jsxs("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-2",children:[e.jsx("label",{htmlFor:"",children:"First Name"}),e.jsx("input",{type:"text",className:"px-2 py-1 rounded-md bg-neutral-600",onChange:i=>a({...s,firstName:i.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-2",children:[e.jsx("label",{htmlFor:"",children:"Last Name"}),e.jsx("input",{type:"text",className:"px-2 py-1 rounded-md bg-neutral-600",onChange:i=>a({...s,lastName:i.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-2",children:[e.jsx("label",{htmlFor:"",children:"Phone Number"}),e.jsx("input",{type:"number",className:"px-2 py-1 rounded-md bg-neutral-600",onChange:i=>a({...s,phoneNumber:i.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-7",children:[e.jsx("label",{htmlFor:"",children:"Create Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:`${l?"text":"password"}`,className:"px-2 py-1 rounded-md bg-neutral-600",onChange:i=>a({...s,password:i.target.value})}),e.jsx("span",{className:"absolute cursor-pointer right-2 top-1",onClick:()=>h(!l),children:"ðŸ‘"})]})]}),e.jsx("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-2",children:e.jsx(z,{onClick:c,type:"primary",loading:r,children:"Sign Up"})})]})})})]})},ms=()=>{const{user:s}=k(),{notifications:t,allUsers:a,openNewChat:c,markAllAsRead:r}=E(),[l,h]=n.useState(!1),i=ae(t),d=t.map(u=>{let m=a.find(x=>x._id===u.senderId);return{...u,senderName:m==null?void 0:m.firstName}}),o=(u,m)=>{c(u,m),h(!1)};let p=()=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid max-h-[26vh] overflow-y-auto",children:[d!=null&&d.length?d.map((u,m)=>e.jsxs("div",{className:`${u.isRead?" text-black/30":"text-black"} border-slate-300 cursor-pointer border-b-[1px] p-1`,onClick:()=>o(u==null?void 0:u.senderId,s==null?void 0:s._id),children:[e.jsx("span",{className:"font-bold ",children:u==null?void 0:u.senderName}),e.jsx("span",{children:" sent a message"}),e.jsx("span",{className:"text-[10px] pl-4 align-bottom italic",children:D(u==null?void 0:u.date).calendar()})]},m)):e.jsx("div",{className:"text-center text-rose-600",children:"Empty"}),(d==null?void 0:d.length)>1?e.jsx("div",{className:"flex justify-end pt-3",children:e.jsx(z,{className:"text-[12px]",size:"small",type:"default",onClick:()=>r(d),children:"Mark all as read"})}):null]})});return e.jsx(e.Fragment,{children:e.jsx(Q,{placement:"bottomRight",title:"Unread Notifications",content:p,trigger:"click",open:l,onOpenChange:()=>h(!l),children:e.jsx(Y,{className:"content-center cursor-pointer",size:"small",count:i==null?void 0:i.length,children:e.jsx(Z,{className:"scale-75 lg:scale-100",shape:"circle",size:"default",icon:e.jsx(Se,{})})})})})},ie=()=>{const[s,t]=n.useState();return{chatRequest:s,sendChatRequest:async(a,c)=>{try{if((await b.post("/chats/sendChatRequest",{senderId:a,recipientId:c})).data)return!0}catch(r){console.log(r),w(r)}},getChatRequestById:async a=>{try{const c=await b.get(`/chats/getChatRequest/${a}`);if(c.data)return t(c.data[0]),!0}catch(c){console.log(c)}},respondChatRequest:async(a,c,r)=>{try{(await b.post("/chats/chatRequestResponse",{chatReqId:a,recipientId:c,respond:r})).data}catch(l){console.log(l)}}}},us=({chatReqId:s,handleRespondChatRequest:t})=>{const{chatRequest:a,getChatRequestById:c}=ie(),{user:r}=k();return n.useEffect(()=>{c(s)},[s]),e.jsx(e.Fragment,{children:a?e.jsx("div",{children:e.jsxs("div",{className:"border-slate-300 cursor-pointer border-b-[1px] p-1 flex justify-between",children:[Ke(a,r==null?void 0:r._id),e.jsxs("div",{className:"flex flex-col text-lg text-right",children:[a.status!=="accepted"&&a.sender!==(r==null?void 0:r._id)?e.jsxs("span",{className:"flex justify-end gap-3",children:[e.jsx("div",{className:"px-4 py-0 text-gray-500 bg-green-500 rounded-md",children:e.jsx(H,{onClick:()=>t(s,a==null?void 0:a.receiver,"accept")})}),e.jsx("div",{className:"px-4 py-0 text-gray-200 rounded-md bg-rose-600",children:e.jsx(ke,{onClick:()=>t(s,a==null?void 0:a.receiver,"reject")})})]}):e.jsx("span",{className:"text-right",children:e.jsx(Le,{})}),e.jsx("span",{className:"text-[10px] pl-4 align-bottom italic",children:D(a.status!=="accepted"?a==null?void 0:a.sentAt:a==null?void 0:a.respondedAt).calendar()})]})]})}):e.jsx(e.Fragment,{})})},hs=()=>{const{user:s}=k(),{setIsNewFriendAdded:t}=E(),{getRecipient:a,recipient:c,recipientLoading:r}=M(),{respondChatRequest:l}=ie(),[h,i]=n.useState(!1);n.useEffect(()=>{s&&a(s._id)},[s]);const d=async(p,u,m)=>{await l(p,u,m),await a(s._id),t(!0),i(!1)};let o=()=>{var p,u;return e.jsx(e.Fragment,{children:e.jsx("div",{className:"grid max-h-[26vh] overflow-y-auto",children:r?e.jsx(W,{}):e.jsx(e.Fragment,{children:(p=c==null?void 0:c.friendRequests)!=null&&p.length?(u=c==null?void 0:c.friendRequests)==null?void 0:u.map((m,x)=>e.jsx(us,{chatReqId:m,handleRespondChatRequest:d},x)).reverse():e.jsx("div",{className:"text-center text-rose-600",children:"No Chat Requests"})})})})};return e.jsx(Q,{placement:"bottomRight",title:"Chat Requests",content:o,trigger:"click",open:h,onOpenChange:()=>i(!h),children:e.jsx(Y,{className:"content-center cursor-pointer",size:"small",children:e.jsx(Z,{className:"scale-75 lg:scale-100",shape:"circle",size:"default",icon:e.jsx(Ue,{})})})})},ps=()=>{const{user:s,logOut:t}=k(),a=Ee(),c=s?[{label:"Logout",key:"1",icon:e.jsx(_e,{}),onClick:()=>{t()}}]:[{label:"Login",key:"1",icon:e.jsx(X,{}),onClick:()=>{a("/login")}},{label:"Register",key:"2",icon:e.jsx(X,{}),onClick:()=>{a("/register")}}];return e.jsx(e.Fragment,{children:e.jsx("div",{className:" bg-slate-700",children:e.jsxs("div",{className:"flex justify-between min-h-[8vh] lg:px-[56px] px-3 ",children:[e.jsx("div",{className:"content-center hidden cursor-pointer lg:block",children:e.jsx(Pe,{to:"/",children:"ChatApp"})}),e.jsxs("div",{className:"flex gap-1 ",children:[s&&e.jsxs("div",{className:"content-center",children:[e.jsx("span",{children:"Hi "}),e.jsx("span",{className:"italic text-amber-500",children:s==null?void 0:s.firstName}),e.jsx("span",{children:"..."})]}),e.jsx("div",{className:"content-center italic scale-125",children:"ðŸ"})]}),e.jsxs("div",{className:"flex gap-2 my-auto lg:gap-6",children:[s&&e.jsxs("div",{className:"lg:flex lg:gap-2",children:[e.jsx(hs,{}),e.jsx(ms,{})]}),e.jsx(ye,{menu:{items:c},trigger:["click"],children:e.jsx("a",{className:"content-center",onClick:r=>r.preventDefault(),children:e.jsx(Ae,{})})})]})]})})})},xs=({children:s})=>{const{user:t,loading:a}=k(),c=Fe();return a?e.jsx("div",{className:"h-[100vh] content-center",children:e.jsx("div",{className:"flex justify-center ",children:e.jsx(W,{size:"large"})})}):t?s:e.jsx(T,{to:"/login",state:{from:c}})};function gs(){const{user:s}=k();return e.jsx(e.Fragment,{children:e.jsxs(Me,{user:s,children:[e.jsx(ps,{}),e.jsx("div",{className:"",children:e.jsxs(Oe,{children:[e.jsx(B,{path:"/",element:e.jsx(xs,{children:e.jsx(is,{})})}),e.jsx(B,{path:"/login",element:e.jsx(ls,{})}),e.jsx(B,{path:"/register",element:e.jsx(ds,{})}),e.jsx(B,{path:"*",element:e.jsx(T,{to:"/"})})]})})]})})}Ne.createRoot(document.getElementById("root")).render(e.jsx(je.StrictMode,{children:e.jsx(Ve,{children:e.jsx($e,{basename:"/chatApp",children:e.jsx(gs,{})})})}));
