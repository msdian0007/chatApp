const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/react-input-emoji-Cu9SFRxT.js","assets/react-CeYxiRmC.js","assets/classnames-BK5ccKcQ.js","assets/react-dom-L6ckZpNh.js","assets/scheduler-CzFDRTuY.js"])))=>i.map(i=>d[i]);
import{r as n,j as e,a as se}from"./react-CeYxiRmC.js";import{c as Re}from"./react-dom-L6ckZpNh.js";import{a as Le}from"./axios-B4uVmeYG.js";import{l as ke}from"./socket.io-client-DFi9RC7o.js";import{s as A,S as v,T,a as z,B as E,P as te,b as ae,A as ne,D as Ae}from"./antd-Bn141y8s.js";import"./lodash-HeGfwtQs.js";import{o as Q,p as Y,q as _e,r as Ue,s as re,v as Fe,w as Ee,x as Oe,y as Pe,z as $e,A as qe,B as Z}from"./@ant-design-iztwEPHt.js";import{h as M}from"./moment-C5S46NFB.js";import{d as H,a as Be,b as Te,e as De,f as D}from"./react-router-QIltWwfG.js";import{L as ze,B as Me}from"./react-router-dom-CUHzREDP.js";import"./classnames-BK5ccKcQ.js";import"./scheduler-CzFDRTuY.js";import"./engine.io-client-DBBxzneW.js";import"./engine.io-parser-BiEtp6m2.js";import"./@socket.io-Dkula2eQ.js";import"./socket.io-parser-BBkuslX-.js";import"./rc-util-CAVnL4d-.js";import"./@babel-DDXZNtFh.js";import"./rc-resize-observer-kpEHs-IX.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./rc-motion-5BJBPEuh.js";import"./rc-overflow-C8ABnMaX.js";import"./rc-tooltip-BHn6b4Tb.js";import"./@rc-component-Qn-Q4kZs.js";import"./rc-menu-CZr1075Q.js";import"./rc-dropdown-DgbUuC76.js";import"./rc-field-form-DA1K7XIi.js";import"./@ctrl-DOFZgDuz.js";import"./throttle-debounce-CUWDS_la.js";import"./rc-notification-BCmMwy-O.js";import"./rc-pagination-Cq_6YqMC.js";import"./rc-picker-DM5vM1RW.js";import"./@emotion-CW87jbl0.js";import"./stylis-DsJDcYJc.js";import"./@remix-run-BZ1VHzzA.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function c(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(i){if(i.ep)return;i.ep=!0;const o=c(i);fetch(i.href,o)}})();let ce="",oe="";ce="https://chatapp-5f1p.onrender.com/api",oe="https://chatapp-socket-oi5c.onrender.com";const He=Object.freeze({server:ce,socket:oe}),ie=He,y=Le.create({baseURL:ie.server,timeout:4e4,headers:{"Content-Type":"application/json"}}),I=s=>{s.response&&s.response.data?A.error(s.response.data.message):s.message?A.error(s.message):A.error("An error occurred. Please try again.")},Je="/chatApp/assets/sendChatText-BBkJDNT7.mp3",Ve="/chatApp/assets/receivedChatText-CUg_h8vX.mp3",We="/chatApp/assets/receivedUnreadText-FvxPMJ05.mp3",le=s=>s.filter(t=>!t.isRead),Ke=(s,t)=>le(s).filter(a=>a.senderId===t).length,K=s=>{try{let t;return s==="SEND"?t=new Audio(Je):s==="RECV"?t=new Audio(Ve):s==="UN"&&(t=new Audio(We)),t.play()}catch(t){console.log("Failed to play sound:",t)}},J=()=>({getDpName:(s,t)=>s&&t?s.charAt(0)+t.charAt(0):s?s.charAt(0):"",getLatestChatOnTop:s=>s.sort((c,a)=>{let i=new Date(c.updatedAt);return new Date(a.updatedAt)-i}),getLatestChatOnTopByChatId:(s,t)=>{var a;if(console.log(s),!s||((a=s[0])==null?void 0:a._id)===t)return 0;const c=s==null?void 0:s.filter(i=>i._id!==t);return c==null||c.unshift(s.find(i=>i._id===t)),c}}),de=n.createContext(null),Qe=({children:s,user:t})=>{const{getLatestChatOnTopByChatId:c,getLatestChatOnTop:a}=J(),[i,o]=n.useState(!1),[l,r]=n.useState([]),[d,p]=n.useState([]),[x,u]=n.useState(!1),[m,g]=n.useState([]),[R,_]=n.useState([]),[h,L]=n.useState(null),[b,P]=n.useState(!1),[F,B]=n.useState(null),[X,ge]=n.useState(null),[C,fe]=n.useState(null),[je,Ne]=n.useState([]),[$,q]=n.useState([]),[ve,be]=n.useState(!1),ye=n.useCallback(async(j,f)=>{try{o(!0);const N=await y.post("/chats",{firstId:j,secondId:f});N.data&&(r(w=>[N.data,...w]),o(!1))}catch(N){I(N)}},[]),Ce=n.useCallback(async(j,f,N,w,U)=>{try{if(!j)return;let k=F;k=[...k,{text:j,createdAt:new Date,senderId:f}],B(k),K("SEND"),U("");const W=await y.post("/messages/sendMessage",{chatId:w,senderId:f,text:j});if(W.data){ge(W.data),k.pop(),B(()=>[...k,W.data]);const G=c(d,w);G&&p(G)}}catch(k){I(k)}},[F,d]),we=n.useCallback((j,f)=>{L(j);const N=$.map(w=>w.senderId===f?{...w,isRead:!0}:w);q(N)},[$]),Ie=n.useCallback(async(j,f)=>{try{const N=await y.get(`/chats/${j}/${f}`);if(N.data){L(N.data);const w=$.map(U=>U.senderId===j?{...U,isRead:!0}:U);q(w)}}catch(N){I(N)}},[$]),Se=n.useCallback(j=>{const f=j.map(N=>({...N,isRead:!0}));q(f)},[]);return n.useEffect(()=>{if(!t)return;(async()=>{try{o(!0);const f=await y.get(`/chats/${t==null?void 0:t._id}`);if(f.data){const N=a(f.data);r(N),o(!1)}}catch(f){I(f)}})()},[t]),n.useEffect(()=>{p(l)},[l]),n.useEffect(()=>{if(!t)return;(async()=>{try{u(!0);const f=await y.get(`/user/getAllFriends/${t._id}`);if(f.data){const N=f.data.filter(w=>{let U=!1;return t._id===w._id?!1:(l&&(U=l==null?void 0:l.some(k=>k.members[0]===w._id||k.members[1]===w._id)),!U)});_(f.data),g(N),u(!1)}}catch(f){u(!1),I(f)}})()},[l,ve]),n.useEffect(()=>{const j=async()=>{try{P(!0);const N=await y.get(`/messages/${h==null?void 0:h._id}`);N.data&&(B(N.data),P(!1))}catch(N){I(N)}},f=async()=>{try{await y.post("/chats/markMessagesAsRead",{chatId:h==null?void 0:h._id,userId:t==null?void 0:t._id})}catch(N){I(N)}};h&&(j(),f())},[h]),n.useEffect(()=>{const j=ke(ie.socket);return fe(j),()=>{j.disconnect()}},[t]),n.useEffect(()=>{C===null&&!t||C.emit("addOnlineUser",t==null?void 0:t._id)},[C]),n.useEffect(()=>{if(!(C===null&&!t))return C.on("getOnlineUsers",j=>{Ne(j)}),()=>{C.off("getOnlineUsers")}},[C]),n.useEffect(()=>{C===null&&!t||C.emit("sendNewMessage",{recipientId:h==null?void 0:h.members.find(j=>j!==(t==null?void 0:t._id)),textMessage:X})},[X]),n.useEffect(()=>{if(!(C===null&&!t))return C.on("getNewMessage",j=>{(h==null?void 0:h._id)===j.chatId&&B(N=>[...N,j]);const f=c(d,j.chatId);f&&p(f)}),C.on("sendNotification",j=>{h!=null&&h.members.find(f=>f===j.senderId)?(q(f=>[{...j,isRead:!0},...f]),K("RECV")):(q(f=>[j,...f]),K("UN"))}),()=>{C.off("getNewMessage"),C.off("sendNotification")}},[C,h,d]),e.jsx(e.Fragment,{children:e.jsx(de.Provider,{value:{userChat:l,chatList:d,chatLoading:i,potentialChats:m,potentialChatsLoading:x,allUsers:R,createChat:ye,currentChat:h,updateCurrentChat:we,messages:F,messagesLoading:b,sendTextMessage:Ce,onlineUsers:je,notifications:$,openNewChat:Ie,markAllAsRead:Se,setIsNewFriendAdded:be},children:s})})},O=()=>n.useContext(de),Xe=()=>e.jsx("div",{className:"flex items-center justify-between p-2 cursor-pointer user-card",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"",children:e.jsx(v.Avatar,{size:"large",active:!0})}),e.jsxs("div",{className:"text-content",children:[e.jsx(v.Input,{size:"small",style:{height:"14px"},block:!0,active:!0}),e.jsx(v.Input,{size:"small",style:{height:"10px"},active:!0})]})]})}),Ge=()=>e.jsxs("div",{className:"flex flex-col items-center content-center w-6 gap-2 pl-6 ",children:[e.jsx(v.Avatar,{active:!0,size:"large"}),e.jsx(v.Button,{active:!0,size:"default",style:{height:"6px"}})]}),Ye=()=>e.jsx("div",{className:"chat-box content-center !bg-neutral-900 min-h-[calc(100vh-8vh)]",children:e.jsxs("div",{className:"px-1 pb-4 messages lg:px-4",children:[e.jsx(v.Input,{className:"message self !p-0 !bg-transparent",active:!0}),e.jsx(v.Input,{className:"message !p-0 !bg-transparent",active:!0}),e.jsx(v.Input,{className:"message !p-0 !bg-transparent",active:!0}),e.jsx(v.Input,{className:"message !p-0 !bg-transparent",active:!0}),e.jsx(v.Input,{className:"message self !p-0 !bg-transparent",active:!0}),e.jsx(v.Input,{className:"message self !p-0 !bg-transparent",active:!0}),e.jsx(v.Input,{className:"message self !p-0 !bg-transparent",active:!0}),e.jsx(v.Input,{className:"message self !p-0 !bg-transparent",active:!0}),e.jsx(v.Input,{className:"message !p-0 !bg-transparent",active:!0}),e.jsx(v.Input,{className:"message !p-0 !bg-transparent",active:!0}),e.jsx(v.Input,{className:"message !p-0 !bg-transparent",active:!0}),e.jsx(v.Input,{className:"message self !p-0 !bg-transparent",active:!0}),e.jsx(v.Input,{className:"message !p-0 !bg-transparent",active:!0}),e.jsx(v.Input,{className:"message !p-0 !bg-transparent",active:!0}),e.jsx(v.Input,{className:"message !p-0 !bg-transparent",active:!0}),e.jsx(v.Input,{className:"message self !p-0 !bg-transparent",active:!0}),e.jsx(v.Input,{className:"message self !p-0 !bg-transparent",active:!0}),e.jsx(v.Input,{className:"message self !p-0 !bg-transparent",active:!0}),e.jsx(v.Input,{className:"message self !p-0 !bg-transparent",active:!0}),e.jsx(v.Input,{className:"message !p-0 !bg-transparent",active:!0}),e.jsx(v.Input,{className:"message !p-0 !bg-transparent",active:!0}),e.jsx(v.Input,{className:"message self !p-0 !bg-transparent",active:!0})]})}),ue=n.createContext(),Ze=({children:s})=>{const[t,c]=n.useState(!0),[a,i]=n.useState(!1),[o,l]=n.useState(null),[r,d]=n.useState(!1),[p,x]=n.useState({firstName:"",lastName:"",phoneNumber:"",password:""}),[u,m]=n.useState({phoneNumber:"",password:""}),g=n.useCallback(async()=>{try{if(!p.phoneNumber&&!p.password&&!p.firstName&&!p.lastName)return A.warning("All fields required");d(!0);const b=await y.post("/user/register",p);b.data&&(localStorage.setItem("userData",JSON.stringify(b.data)),l(b.data),d(!1),A.success(b.data.message))}catch(b){d(!1),I(b)}},[p]),R=n.useCallback(b=>{x(b)},[]),_=n.useCallback(b=>{m(b)},[]),h=n.useCallback(()=>{localStorage.removeItem("userData"),l(null)},[]),L=n.useCallback(async()=>{try{if(!u.phoneNumber&&!u.password)return A.success("All fields required");i(!0);const b=await y.post("/user/login",u);b.data&&(localStorage.setItem("userData",JSON.stringify(b.data)),l(b.data),i(!1),A.success(b.data.message))}catch(b){i(!1),I(b)}},[u]);return n.useEffect(()=>{const b=localStorage.getItem("userData");l(JSON.parse(b)),c(!1)},[]),e.jsx(e.Fragment,{children:e.jsx(ue.Provider,{value:{user:o,registerInfo:p,updateRegisterInfo:R,registerLoading:r,registerUser:g,loading:t,logOut:h,logIn:L,loginLoading:a,loginInfo:u,updateLoginInfo:_},children:s})})},S=()=>n.useContext(ue),es=(s,t)=>{const{sender_details:c,receiver_details:a}=s;return s.sender===t?e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-orange-600",children:a.firstName+" "+a.lastName+" "}),s.status==="accepted"?e.jsx(T,{color:"success",icon:e.jsx(Q,{}),children:"accepted"}):e.jsx(T,{color:"default",icon:e.jsx(Y,{}),children:"pending"})]}),e.jsx("span",{children:a.phoneNumber})]}):e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-orange-600",children:c.firstName+" "+c.lastName+" "}),s.status==="accepted"?e.jsx(T,{color:"success",icon:e.jsx(Q,{}),children:"friendzz"}):e.jsx(T,{color:"default",icon:e.jsx(Y,{}),children:"pending"})]}),e.jsx("span",{children:c.phoneNumber})]})},ss=(s,t)=>{let c=0;return c=typeof s=="number"?s:0,c+=t,c?e.jsx("div",{className:"flex justify-end",children:e.jsx("span",{className:"this-user-notifications",children:c})}):e.jsx(e.Fragment,{})},ts=(s,t)=>s&&(s==null?void 0:s.senderId)!==(t==null?void 0:t._id)?e.jsxs("div",{className:"flex text-[12px]",children:[e.jsx("div",{className:"pr-1 font-bold text-orange-400",children:"you:"}),e.jsx("div",{className:"truncate",children:s==null?void 0:s.text})]}):e.jsx("div",{className:"text",children:s==null?void 0:s.text}),me=(s,t)=>t.some(a=>a.userId===s)&&e.jsx("div",{className:"absolute bottom-0 right-0 w-3 h-3 bg-green-500 border-2 border-white rounded-full"}),pe=se.memo(()=>{const{potentialChats:s,createChat:t,onlineUsers:c,potentialChatsLoading:a}=O(),{user:i}=S(),{getDpName:o}=J();return e.jsx(e.Fragment,{children:e.jsx("div",{className:"flex justify-around gap-4 overflow-x-scroll overflow-y-hidden shadow-lg md:gap-14 scrollbar ",children:a?[1,2,3,4,5].map((l,r)=>e.jsx(Ge,{},r)):s&&s.map((l,r)=>e.jsxs("div",{className:"flex flex-col items-center p-2 rounded-lg cursor-pointer w-14",onClick:()=>t(i==null?void 0:i._id,l==null?void 0:l._id),children:[e.jsxs("div",{className:"relative w-9 h-9",children:[e.jsx("div",{className:"w-full h-full rounded-full object-cover text-[12px] bg-violet-600 text-center content-center",children:o(l==null?void 0:l.firstName,l==null?void 0:l.lastName)}),me(l._id,c)]}),e.jsx("div",{className:"mt-1 text-[10px] text-center",children:l==null?void 0:l.firstName})]},r))})})});pe.displayName="PotentialChats";const V=()=>{const[s,t]=n.useState(),[c,a]=n.useState(!1),[i,o]=n.useState([]),[l,r]=n.useState(!1),[d,p]=n.useState(),[x,u]=n.useState(!1);return{recipientLoading:c,recipient:s,searchedUsersLoading:l,searchedUsers:i,recipients:d,recipientsLoading:x,setSearchedUsers:o,getRecipient:async m=>{try{a(!0);const g=await y.get(`/user/find/${m}`);g.data&&(t(g.data),a(!1))}catch{a(!1)}},getRecipients:async m=>{try{u(!0);const g=await y.post("/user/getUsersById",{recipientId:m});g.data&&(p(g.data),u(!1))}catch{u(!1)}},searchUsersByPhoneNumber:async m=>{try{r(!0);const g=await y.get(`/user/findByNumber/${m}`);g.data&&(o(g.data),r(!1))}catch{r(!1)}}}},as="modulepreload",ns=function(s){return"/chatApp/"+s},ee={},rs=function(t,c,a){let i=Promise.resolve();if(c&&c.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));i=Promise.all(c.map(r=>{if(r=ns(r),r in ee)return;ee[r]=!0;const d=r.endsWith(".css"),p=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${r}"]${p}`))return;const x=document.createElement("link");if(x.rel=d?"stylesheet":as,d||(x.as="script",x.crossOrigin=""),x.href=r,l&&x.setAttribute("nonce",l),document.head.appendChild(x),d)return new Promise((u,m)=>{x.addEventListener("load",u),x.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${r}`)))})}))}return i.then(()=>t()).catch(o=>{const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o})},cs=n.lazy(()=>rs(()=>import("./react-input-emoji-Cu9SFRxT.js"),__vite__mapDeps([0,1,2,3,4]))),os=n.memo(({text:s,handleChange:t})=>e.jsx(e.Fragment,{children:e.jsx(n.Suspense,{fallback:e.jsx(z,{}),children:e.jsx(cs,{value:s,onChange:t,fontFamily:"nunito",borderColor:"rgba(72, 112, 223, 0.2)"})})})),is="/chatApp/assets/Chat-amico-BTnA9QnS.png",ls=({setIsChatBoxOpen:s})=>{const{messages:t,messagesLoading:c,currentChat:a,sendTextMessage:i,updateCurrentChat:o}=O(),{loading:l,recipient:r,getRecipient:d}=V(),[p,x]=n.useState(""),u=n.useRef(),{user:m}=S(),g=a==null?void 0:a.members.find(h=>h!==(m==null?void 0:m._id));n.useEffect(()=>{g&&d(g)},[a]),n.useEffect(()=>{const h=u.current;if(h!=null&&h.scrollHeight)return h.scrollTop=h==null?void 0:h.scrollHeight},[t]);const R=n.useCallback(h=>{x(h)},[]),_=()=>{o(null,null),s(!1)};return c?e.jsx(Ye,{}):a?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"chat-box relative min-h-[calc(100vh-9vh)]",children:[e.jsxs("div",{className:"chat-header min-h-[6vh] !flex !justify-between",children:[e.jsx("div",{className:"ml-3 text-xl cursor-pointer lg:text-lg",onClick:_,children:e.jsx(_e,{})}),e.jsx("strong",{children:r==null?void 0:r.firstName}),e.jsx("span",{})]}),e.jsx("div",{className:"px-2 pt-2 messages pb-[10vh]",ref:u,children:t&&t.map((h,L)=>e.jsxs("div",{className:`${h.senderId===(m==null?void 0:m._id)?"message self ":"message "} `,children:[e.jsx("div",{children:h.text}),e.jsx("div",{className:`${h.senderId===(m==null?void 0:m._id)?"message-footer self":"message-footer "} `,children:M(h.createdAt).calendar()})]},L))}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 flex items-center max-h-[10vh] justify-between chat-input",children:[e.jsx(os,{text:p,handleChange:R}),e.jsx(Ue,{className:"content-center px-4 py-3 text-xl bg-blue-600 rounded-full",onClick:()=>i(p,m==null?void 0:m._id,g,a._id,x)})]})]})}):e.jsx("div",{className:"chat-box content-center min-h-[calc(100vh-12vh)]",children:e.jsx("div",{className:"flex justify-center ",children:e.jsx("img",{className:"max-w-md",src:is})})})},ds=({u:s,handleChatRequest:t,chatReqLoading:c})=>{const{getDpName:a}=J();return e.jsxs("div",{className:"flex items-center justify-between p-2 cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"relative w-9 h-9",children:e.jsx("div",{className:"content-center object-cover w-full h-full text-center rounded-full bg-slate-400",children:a(s==null?void 0:s.firstName,s==null?void 0:s.lastName)})}),e.jsx("div",{className:"text-content",children:e.jsx("div",{className:"name",children:(s==null?void 0:s.firstName)+" "+(s==null?void 0:s.lastName)})})]}),e.jsx(E,{loading:c,onClick:()=>t(s==null?void 0:s._id),className:"content-center px-2 py-1 text-right ",children:"Chat Request"})]})},he=()=>{const[s,t]=n.useState(!1),[c,a]=n.useState(!0),[i,o]=n.useState(),[l,r]=n.useState(null);return{lastMessageLoading:c,lastMessage:i,chatReqLoading:s,chatInfo:l,getChatInfo:async d=>{try{const p=await y.get(`/chats/getChatInfo/${d}`);p.data&&r(p.data)}catch(p){I(p)}},getLatestMessage:async d=>{try{const p=await y.get(`/messages/latest/${d}`);p.data&&(o(p.data),a(!1))}catch(p){I(p)}},sendChatRequest:async(d,p)=>{try{t(!0);const x=await y.post("/chats/sendChatRequest",{senderId:d,recipientId:p});if(x.data)return A.success("Request send successfully"),t(!1),x.data}catch(x){t(!1),I(x)}},respondChatRequest:async(d,p,x)=>{try{(await y.post("/chats/chatRequestResponse",{senderId:d,recipientId:p,respond:x})).data}catch(u){I(u)}}}},us=({setIsSearching:s,isSearching:t})=>{const{searchedUsersLoading:c,searchedUsers:a,setSearchedUsers:i,searchUsersByPhoneNumber:o}=V(),{sendChatRequest:l,chatReqLoading:r}=he(),{user:d}=S(),[p,x]=n.useState(""),u=()=>{p&&o(p)},m=async g=>{if((d==null?void 0:d._id)===g)return A.warning("Abey saale 🙂");await l(d==null?void 0:d._id,g),i([]),x(""),s(0)};return n.useEffect(()=>{i([]),x("")},[t]),e.jsx("div",{className:"py-2 text-center ",children:e.jsxs("div",{className:"relative mx-2 ",children:[e.jsx("input",{type:"number",placeholder:`${t?"Enter phone number...":"search friends..."}`,className:`${t?"placeholder-orange-400":""} z-30 w-full h-10 px-3 py-1 text-sm rounded-full lg:h-10 bg-black/45`,value:p,onChange:g=>x(g.target.value),onClick:()=>s(1)}),c?e.jsx(E,{className:"absolute  border-0 !content-center rounded-full !px-7  !right-1 top-1 h-auto bottom-1",icon:e.jsx(re,{}),loading:!0}):e.jsx(E,{className:"absolute bg-orange-500 text-white border-0 !content-center rounded-full !px-7  !right-1 top-1 h-auto bottom-1",icon:e.jsx(Fe,{}),onClick:u}),c?e.jsx(e.Fragment,{}):(a==null?void 0:a.length)>0&&e.jsx("div",{className:"absolute z-20 w-full py-2 mt-4 bg-gray-700 border rounded-md border-black/35",children:a==null?void 0:a.map((g,R)=>e.jsx(ds,{u:g,handleChatRequest:m,chatReqLoading:r},R))})]})})};function ms({chat:s,setIsChatBoxOpen:t}){const{onlineUsers:c,notifications:a,updateCurrentChat:i,messages:o}=O(),{getRecipient:l,recipient:r,recipientLoading:d}=V(),{getLatestMessage:p,lastMessage:x}=he(),{getDpName:u}=J(),{user:m}=S(),g=Ke(a,r==null?void 0:r._id),[R,_]=n.useState(0),h=()=>{i(s,r==null?void 0:r._id),t(!0),_(0)};return n.useEffect(()=>{var P;const L=s==null?void 0:s.members.find(F=>F!==(m==null?void 0:m._id)),b=(P=s==null?void 0:s.unreadCounts)==null?void 0:P.find(F=>F.userId!==L);L&&l(L),_(b==null?void 0:b.count)},[s]),n.useEffect(()=>{p(s==null?void 0:s._id)},[a,o]),e.jsx(e.Fragment,{children:!r||d?e.jsx(Xe,{}):e.jsxs("div",{className:"flex items-center justify-between p-2 cursor-pointer user-card",onClick:h,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative w-9 h-9",children:[e.jsx("div",{className:"content-center object-cover w-full h-full text-center rounded-full bg-slate-400",children:u((r==null?void 0:r.firstName)+" "+(r==null?void 0:r.lastName))}),me(r==null?void 0:r._id,c)]}),e.jsxs("div",{className:"text-content",children:[e.jsx("div",{className:"name",children:(r==null?void 0:r.firstName)+" "+(r==null?void 0:r.lastName)}),ts(x,r)]})]}),e.jsxs("div",{className:"grid items-end gap-1 text-right",children:[e.jsx("div",{className:"date !text-[10px]",children:M(x==null?void 0:x.updatedAt).calendar()}),ss(R,g)]})]})})}function ps({setIsChatBoxOpen:s}){const{chatList:t,chatLoading:c}=O();return e.jsx(e.Fragment,{children:e.jsx("div",{className:"max-h-[calc(100vh-29vh)] overflow-y-auto w-full pt-2",children:t.map((a,i)=>e.jsx(ms,{chat:a,setIsChatBoxOpen:s},a==null?void 0:a._id))})})}const hs=()=>{const[s,t]=n.useState(0),[c,a]=n.useState(!1),i=n.useCallback(()=>{t(0)},[]);return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-8",children:[e.jsxs("div",{className:`${c?"hidden md:block col-span-3":"md:col-span-3 col-span-8 relative"} "px-3 mb-2  w-full"`,children:[e.jsx(us,{setIsSearching:t,isSearching:s}),e.jsx("div",{hidden:!s,onClick:i,className:"absolute rounded-md z-10 w-full min-h-[calc(100vh-15vh)] bg-black bg-opacity-85"}),e.jsx(pe,{}),e.jsx(ps,{setIsChatBoxOpen:a})]}),e.jsx("div",{className:`${c?"md:col-span-5 col-span-8":"hidden md:block"} col-span-5 md:pl-2 content-center`,children:e.jsx(ls,{setIsChatBoxOpen:a})})]})})},xs=()=>{const{logIn:s,user:t,updateLoginInfo:c,loginInfo:a,loginLoading:i}=S(),[o,l]=n.useState(!1);return e.jsxs(e.Fragment,{children:[t?e.jsx(H,{to:"/"}):null,e.jsx("div",{className:"flex justify-center min-h-[calc(100vh-10vh)]",children:e.jsxs("div",{className:"grid grid-cols-4 my-auto ",children:[e.jsxs("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-2",children:[e.jsx("label",{htmlFor:"",children:"Phone Number"}),e.jsx("input",{type:"number",className:"px-2 py-1 rounded-md bg-neutral-600",onChange:r=>c({...a,phoneNumber:r.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-7",children:[e.jsx("label",{htmlFor:"",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:`${o?"text":"password"}`,className:"px-2 py-1 rounded-md bg-neutral-600",onChange:r=>c({...a,password:r.target.value})}),e.jsx("span",{className:"absolute cursor-pointer right-2 top-1",onClick:()=>l(!o),children:"👁"})]})]}),e.jsx("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-2",children:e.jsx(E,{onClick:s,loading:i,type:"primary",children:"Log In"})})]})})]})},gs=()=>{const{registerInfo:s,user:t,updateRegisterInfo:c,registerUser:a,registerLoading:i}=S(),[o,l]=n.useState(!1);return e.jsxs(e.Fragment,{children:[t?e.jsx(H,{to:"/"}):null,e.jsx("form",{action:"",children:e.jsx("div",{className:"flex justify-center min-h-[calc(100vh-10vh)]",children:e.jsxs("div",{className:"grid grid-cols-4 my-auto ",children:[e.jsxs("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-2",children:[e.jsx("label",{htmlFor:"",children:"First Name"}),e.jsx("input",{type:"text",className:"px-2 py-1 rounded-md bg-neutral-600",onChange:r=>c({...s,firstName:r.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-2",children:[e.jsx("label",{htmlFor:"",children:"Last Name"}),e.jsx("input",{type:"text",className:"px-2 py-1 rounded-md bg-neutral-600",onChange:r=>c({...s,lastName:r.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-2",children:[e.jsx("label",{htmlFor:"",children:"Phone Number"}),e.jsx("input",{type:"number",className:"px-2 py-1 rounded-md bg-neutral-600",onChange:r=>c({...s,phoneNumber:r.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-7",children:[e.jsx("label",{htmlFor:"",children:"Create Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:`${o?"text":"password"}`,className:"px-2 py-1 rounded-md bg-neutral-600",onChange:r=>c({...s,password:r.target.value})}),e.jsx("span",{className:"absolute cursor-pointer right-2 top-1",onClick:()=>l(!o),children:"👁"})]})]}),e.jsx("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-2",children:e.jsx(E,{onClick:a,type:"primary",loading:i,children:"Sign Up"})})]})})})]})},fs=()=>{const{user:s}=S(),{notifications:t,allUsers:c,openNewChat:a,markAllAsRead:i}=O(),[o,l]=n.useState(!1),r=le(t),d=t.map(u=>{let m=c.find(g=>g._id===u.senderId);return{...u,senderName:m==null?void 0:m.firstName}}),p=(u,m)=>{a(u,m),l(!1)};let x=()=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid max-h-[26vh] overflow-y-auto",children:[d!=null&&d.length?d.map((u,m)=>e.jsxs("div",{className:`${u.isRead?" text-black/30":"text-black"} border-slate-300 cursor-pointer border-b-[1px] p-1`,onClick:()=>p(u==null?void 0:u.senderId,s==null?void 0:s._id),children:[e.jsx("span",{className:"font-bold ",children:u==null?void 0:u.senderName}),e.jsx("span",{children:" sent a message"}),e.jsx("span",{className:"text-[10px] pl-4 align-bottom italic",children:M(u==null?void 0:u.date).calendar()})]},m)):e.jsx("div",{className:"text-center text-rose-600",children:"Empty"}),(d==null?void 0:d.length)>1?e.jsx("div",{className:"flex justify-end pt-3",children:e.jsx(E,{className:"text-[12px]",size:"small",type:"default",onClick:()=>i(d),children:"Mark all as read"})}):null]})});return e.jsx(e.Fragment,{children:e.jsx(te,{placement:"bottomRight",title:"Unread Notifications",content:x,trigger:"click",open:o,onOpenChange:()=>l(!o),children:e.jsx(ae,{className:"content-center cursor-pointer",size:"small",count:r==null?void 0:r.length,children:e.jsx(ne,{className:"",shape:"circle",icon:e.jsx(Ee,{})})})})})},xe=()=>{const[s,t]=n.useState(),[c,a]=n.useState(!1);return{chatRequest:s,loadingChatRespond:c,sendChatRequest:async(i,o)=>{try{if((await y.post("/chats/sendChatRequest",{senderId:i,recipientId:o})).data)return!0}catch(l){console.log(l),I(l)}},getChatRequestById:async i=>{try{const o=await y.get(`/chats/getChatRequest/${i}`);if(o.data)return t(o.data[0]),!0}catch(o){console.log(o)}},respondChatRequest:async(i,o,l)=>{try{a(!0),(await y.post("/chats/chatRequestResponse",{chatReqId:i,recipientId:o,respond:l})).data&&a(!1)}catch(r){a(!1),console.log(r)}}}},js=({chatReqId:s,handleRespondChatRequest:t,loadingChatRespond:c})=>{const{chatRequest:a,getChatRequestById:i}=xe(),{user:o}=S();return n.useEffect(()=>{i(s)},[s]),e.jsx(e.Fragment,{children:a?e.jsx("div",{children:e.jsxs("div",{className:"border-slate-300 cursor-pointer border-b-[1px] p-1 flex justify-between",children:[es(a,o==null?void 0:o._id),e.jsxs("div",{className:"flex flex-col text-lg text-right",children:[a.status!=="accepted"&&a.sender!==(o==null?void 0:o._id)?e.jsx(e.Fragment,{children:c?e.jsx(z,{}):e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("div",{className:"px-4 py-0 text-gray-500 bg-green-500 rounded-md",onClick:()=>t(s,a==null?void 0:a.receiver,"accept"),children:e.jsx(Q,{})}),e.jsx("div",{className:"px-4 py-0 text-gray-200 rounded-md bg-rose-600",onClick:()=>t(s,a==null?void 0:a.receiver,"reject"),children:e.jsx(Oe,{})})]})}):e.jsx("span",{className:"text-right",children:e.jsx(Pe,{})}),e.jsx("span",{className:"text-[10px] pl-4 align-bottom italic",children:M(a.status!=="accepted"?a==null?void 0:a.sentAt:a==null?void 0:a.respondedAt).calendar()})]})]})}):e.jsx(e.Fragment,{})})},Ns=()=>{const{user:s}=S(),{setIsNewFriendAdded:t}=O(),{getRecipient:c,recipient:a,recipientLoading:i}=V(),{respondChatRequest:o,loadingChatRespond:l}=xe(),[r,d]=n.useState(!1);n.useEffect(()=>{s&&c(s._id)},[s]);const p=async(u,m,g)=>{await o(u,m,g),await c(s._id),t(!0),d(!1)};let x=()=>{var u,m;return e.jsx(e.Fragment,{children:e.jsx("div",{className:"grid max-h-[26vh] overflow-y-auto",children:i?e.jsx(z,{}):e.jsx(e.Fragment,{children:(u=a==null?void 0:a.friendRequests)!=null&&u.length?(m=a==null?void 0:a.friendRequests)==null?void 0:m.map((g,R)=>e.jsx(js,{chatReqId:g,handleRespondChatRequest:p,loadingChatRespond:l},R)).reverse():e.jsx("div",{className:"text-center text-rose-600",children:"No Chat Requests"})})})})};return e.jsx(te,{placement:"bottomRight",title:"Chat Requests",content:x,trigger:"click",open:r,onOpenChange:()=>d(!r),children:e.jsx(ae,{className:"content-center cursor-pointer",size:"small",children:e.jsx(ne,{className:"",shape:"circle",icon:e.jsx($e,{})})})})},vs=()=>{const{user:s,logOut:t}=S(),c=Be(),a=s?[{label:"Logout",key:"1",icon:e.jsx(re,{}),onClick:()=>{t()}}]:[{label:"Login",key:"1",icon:e.jsx(Z,{}),onClick:()=>{c("/login")}},{label:"Register",key:"2",icon:e.jsx(Z,{}),onClick:()=>{c("/register")}}];return e.jsx(e.Fragment,{children:e.jsx("div",{className:" bg-slate-700",children:e.jsxs("div",{className:"flex justify-between min-h-[8vh]  px-3 ",children:[e.jsx("div",{className:"content-center hidden cursor-pointer lg:block",children:e.jsx(ze,{to:"/",children:"ChatApp"})}),e.jsxs("div",{className:"flex gap-1 ",children:[s&&e.jsxs("div",{className:"content-center",children:[e.jsx("span",{children:"Hi "}),e.jsx("span",{className:"italic text-amber-500",children:s==null?void 0:s.firstName}),e.jsx("span",{children:"..."})]}),e.jsx("div",{className:"content-center italic scale-125",children:"🍁"})]}),e.jsxs("div",{className:"flex gap-2 my-auto lg:gap-4",children:[s&&e.jsxs("div",{className:"flex gap-2 lg:gap-2",children:[e.jsx(fs,{}),e.jsx(Ns,{})]}),e.jsx(Ae,{menu:{items:a},trigger:["click"],children:e.jsx("a",{className:"flex content-center pl-3",onClick:i=>i.preventDefault(),children:e.jsx(qe,{className:"text-xl"})})})]})]})})})},bs=({children:s})=>{const{user:t,loading:c}=S(),a=Te();return c?e.jsx("div",{className:"h-[100vh] content-center",children:e.jsx("div",{className:"flex justify-center ",children:e.jsx(z,{size:"large"})})}):t?s:e.jsx(H,{to:"/login",state:{from:a}})};function ys(){const{user:s}=S();return e.jsx(e.Fragment,{children:e.jsxs(Qe,{user:s,children:[e.jsx(vs,{}),e.jsx("div",{className:"",children:e.jsxs(De,{children:[e.jsx(D,{path:"/",element:e.jsx(bs,{children:e.jsx(hs,{})})}),e.jsx(D,{path:"/login",element:e.jsx(xs,{})}),e.jsx(D,{path:"/register",element:e.jsx(gs,{})}),e.jsx(D,{path:"*",element:e.jsx(H,{to:"/"})})]})})]})})}Re.createRoot(document.getElementById("root")).render(e.jsx(se.StrictMode,{children:e.jsx(Ze,{children:e.jsx(Me,{basename:"/chatApp",children:e.jsx(ys,{})})})}));
