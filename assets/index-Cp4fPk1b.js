const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/react-input-emoji-BIUyQkSU.js","assets/react-DHBI0EtI.js","assets/classnames-C9FZUsQl.js","assets/react-dom-vAgahkSm.js","assets/scheduler-CzFDRTuY.js"])))=>i.map(i=>d[i]);
import{r as c,j as e,a as fe}from"./react-DHBI0EtI.js";import{c as je}from"./react-dom-vAgahkSm.js";import{a as Ne}from"./axios-B4uVmeYG.js";import{l as ve}from"./socket.io-client-DFi9RC7o.js";import{s as k,S as y,a as J,B,P as X,b as G,A as Q,T as $,D as be}from"./antd-BgnzA8Iu.js";import{h as M}from"./moment-C5S46NFB.js";import{o as ye,p as Ce,j as we,q as Re,r as Se,s as V,v as H,w as Ie,x as ke,y as Le,z as Ue,A as W,B as Ae}from"./@ant-design-B6LxVAox.js";import{d as z,a as _e,b as Ee,e as Fe,f as q}from"./react-router-mPJ5A8eT.js";import{L as Oe,B as Pe}from"./react-router-dom-CBWY55wr.js";import"./classnames-C9FZUsQl.js";import"./scheduler-CzFDRTuY.js";import"./engine.io-client-DBBxzneW.js";import"./engine.io-parser-BiEtp6m2.js";import"./@socket.io-Dkula2eQ.js";import"./socket.io-parser-BBkuslX-.js";import"./rc-util-DRk5y4Yu.js";import"./@babel-DDXZNtFh.js";import"./rc-resize-observer-DhIh4Bln.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./rc-motion-B7bZ38Ss.js";import"./rc-overflow-DZRiDIAM.js";import"./rc-tooltip-DduOv04A.js";import"./@rc-component-Db8YWiD8.js";import"./rc-menu-DFg7V8Qr.js";import"./rc-dropdown-1QSiw7eM.js";import"./rc-field-form-BLZ5SSc5.js";import"./@ctrl-DOFZgDuz.js";import"./throttle-debounce-CUWDS_la.js";import"./rc-notification-B-HVxHmI.js";import"./rc-pagination-TIHhowL0.js";import"./rc-picker-CcREweDU.js";import"./@emotion-CW87jbl0.js";import"./stylis-DsJDcYJc.js";import"./@remix-run-BZ1VHzzA.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&i(u)}).observe(document,{childList:!0,subtree:!0});function a(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(r){if(r.ep)return;r.ep=!0;const o=a(r);fetch(r.href,o)}})();let Y="",Z="";Y="https://chatapp-5f1p.onrender.com/api",Z="https://chatapp-socket-oi5c.onrender.com";const $e=Object.freeze({server:Y,socket:Z}),ee=$e,b=Ne.create({baseURL:ee.server,timeout:4e4,headers:{"Content-Type":"application/json"}}),S=s=>{s.response&&s.response.data?k.error(s.response.data.message):s.message?k.error(s.message):k.error("An error occurred. Please try again.")},qe="/chatApp/assets/sendChatText-BBkJDNT7.mp3",Be="/chatApp/assets/receivedChatText-CUg_h8vX.mp3",Me="/chatApp/assets/receivedUnreadText-FvxPMJ05.mp3",se=s=>s.filter(t=>!t.isRead),ze=(s,t)=>se(s).filter(i=>i.senderId===t).length,T=s=>{try{let t;return s==="SEND"?t=new Audio(qe):s==="RECV"?t=new Audio(Be):s==="UN"&&(t=new Audio(Me)),t.play()}catch(t){console.log("Failed to play sound:",t)}},te=c.createContext(null),De=({children:s,user:t})=>{const[a,i]=c.useState(!1),[r,o]=c.useState([]),[u,n]=c.useState([]),[m,l]=c.useState([]),[f,h]=c.useState([]),[d,p]=c.useState(null),[R,A]=c.useState(!1),[U,L]=c.useState(null),[g,P]=c.useState(null),[N,ie]=c.useState(null),[oe,le]=c.useState([]),[F,O]=c.useState([]),[de,me]=c.useState(!1),ue=c.useCallback(async(j,x)=>{try{i(!0);const v=await b.post("/chats",{firstId:j,secondId:x});v.data&&(o(w=>[v.data,...w]),i(!1))}catch(v){S(v)}},[]),he=c.useCallback(async(j,x,v,w)=>{try{if(!j)return;let C=U;C=[...C,{text:j,createdAt:new Date,senderId:x}],L(C),T("SEND"),w("");const _=await b.post("/messages",{chatId:v,senderId:x,text:j});_.data&&(P(_.data),C.pop(),L(()=>[...C,_.data]))}catch(C){S(C)}},[U]),pe=c.useCallback((j,x)=>{p(j);const v=F.map(w=>w.senderId===x?{...w,isRead:!0}:w);O(v)},[F]),xe=c.useCallback(async(j,x)=>{try{const v=await b.get(`/chats/${j}/${x}`);if(v.data){p(v.data);const w=F.map(C=>C.senderId===j?{...C,isRead:!0}:C);O(w)}}catch(v){S(v)}},[F]),ge=c.useCallback(j=>{const x=j.map(v=>({...v,isRead:!0}));O(x)},[]);return c.useEffect(()=>{if(!t)return;(async()=>{try{i(!0);const x=await b.get(`/chats/${t==null?void 0:t._id}`);x.data&&(o(x.data),i(!1))}catch(x){S(x)}})()},[t]),c.useEffect(()=>{if(!t)return;(async()=>{try{n(!0);const x=await b.get(`/user/getAllFriends/${t._id}`);if(x.data){const v=x.data.filter(w=>{let C=!1;return t._id===w._id?!1:(r&&(C=r==null?void 0:r.some(_=>_.members[0]===w._id||_.members[1]===w._id)),!C)});h(x.data),l(v),n(!1)}}catch(x){n(!1),S(x)}})()},[r,de]),c.useEffect(()=>{const j=async()=>{try{A(!0);const x=await b.get(`/messages/${d==null?void 0:d._id}`);x.data&&(L(x.data),A(!1))}catch(x){S(x)}};d&&j()},[d]),c.useEffect(()=>{const j=ve(ee.socket);return ie(j),()=>{j.disconnect()}},[t]),c.useEffect(()=>{N===null&&!t||N.emit("addOnlineUser",t==null?void 0:t._id)},[N]),c.useEffect(()=>{if(!(N===null&&!t))return N.on("getOnlineUsers",j=>{le(j)}),()=>{N.off("getOnlineUsers")}},[N]),c.useEffect(()=>{N===null&&!t||N.emit("sendNewMessage",{recipientId:d==null?void 0:d.members.find(j=>j!==(t==null?void 0:t._id)),textMessage:g})},[g]),c.useEffect(()=>{if(!(N===null&&!t))return N.on("getNewMessage",j=>{(d==null?void 0:d._id)===j.chatId&&L(x=>[...x,j])}),N.on("sendNotification",j=>{d!=null&&d.members.find(x=>x===j.senderId)?(O(x=>[{...j,isRead:!0},...x]),T("RECV")):(O(x=>[j,...x]),T("UN"))}),()=>{N.off("getNewMessage"),N.off("sendNotification")}},[N,d]),e.jsx(e.Fragment,{children:e.jsx(te.Provider,{value:{userChat:r,chatLoading:a,potentialChats:m,potentialChatsLoading:u,allUsers:f,createChat:ue,currentChat:d,updateCurrentChat:pe,messages:U,messagesLoading:R,sendTextMessage:he,onlineUsers:oe,notifications:F,openNewChat:xe,markAllAsRead:ge,setIsNewFriendAdded:me},children:s})})},E=()=>c.useContext(te),ae=c.createContext(),Te=({children:s})=>{const[t,a]=c.useState(!0),[i,r]=c.useState(!1),[o,u]=c.useState(null),[n,m]=c.useState(!1),[l,f]=c.useState({firstName:"",lastName:"",phoneNumber:"",password:""}),[h,d]=c.useState({phoneNumber:"",password:""}),p=c.useCallback(async()=>{try{if(!l.phoneNumber&&!l.password&&!l.firstName&&!l.lastName)return k.warning("All fields required");m(!0);const g=await b.post("/user/register",l);g.data&&(localStorage.setItem("userData",JSON.stringify(g.data)),u(g.data),m(!1),k.success(g.data.message))}catch(g){m(!1),S(g)}},[l]),R=c.useCallback(g=>{f(g)},[]),A=c.useCallback(g=>{d(g)},[]),U=c.useCallback(()=>{localStorage.removeItem("userData"),u(null)},[]),L=c.useCallback(async()=>{try{if(!h.phoneNumber&&!h.password)return k.success("All fields required");r(!0);const g=await b.post("/user/login",h);g.data&&(localStorage.setItem("userData",JSON.stringify(g.data)),u(g.data),r(!1),k.success(g.data.message))}catch(g){r(!1),S(g)}},[h]);return c.useEffect(()=>{const g=localStorage.getItem("userData");u(JSON.parse(g)),a(!1)},[]),e.jsx(e.Fragment,{children:e.jsx(ae.Provider,{value:{user:o,registerInfo:l,updateRegisterInfo:R,registerLoading:n,registerUser:p,loading:t,logOut:U,logIn:L,loginLoading:i,loginInfo:h,updateLoginInfo:A},children:s})})},I=()=>c.useContext(ae),D=()=>{const[s,t]=c.useState(),[a,i]=c.useState(!1),[r,o]=c.useState([]),[u,n]=c.useState(!1),[m,l]=c.useState(),[f,h]=c.useState(!1);return{recipientLoading:a,recipient:s,searchedUsersLoading:u,searchedUsers:r,recipients:m,recipientsLoading:f,setSearchedUsers:o,getRecipient:async d=>{try{i(!0);const p=await b.get(`/user/find/${d}`);p.data&&(t(p.data),i(!1))}catch{i(!1)}},getRecipients:async d=>{try{h(!0);const p=await b.post("/user/getUsersById",{recipientId:d});p.data&&(l(p.data),h(!1))}catch{h(!1)}},searchUsersByPhoneNumber:async d=>{try{n(!0);const p=await b.get(`/user/findByNumber/${d}`);p.data&&(o(p.data),n(!1))}catch{n(!1)}}}},Ve=()=>e.jsx("div",{className:"user-card flex justify-between items-center p-2 cursor-pointer",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:" ",children:e.jsx(y.Avatar,{size:"large",active:!0})}),e.jsxs("div",{className:"text-content",children:[e.jsx(y.Input,{size:"small",style:{height:"14px"},block:!0,active:!0}),e.jsx(y.Input,{size:"small",style:{height:"10px"},active:!0})]})]})}),Je=()=>e.jsxs("div",{className:"flex flex-col gap-1 items-center w-6 pl-8",children:[e.jsx(y.Avatar,{active:!0}),e.jsx(y.Button,{active:!0,size:"small",style:{height:"6px"}})]}),He=()=>e.jsx("div",{className:"chat-box content-center !bg-neutral-700 min-h-[calc(100vh-8vh)]",children:e.jsxs("div",{className:"messages pb-4 px-1 lg:px-4",children:[e.jsx(y.Input,{className:"message self !p-0 !bg-transparent",active:!0}),e.jsx(y.Input,{className:"message !p-0 !bg-transparent",active:!0}),e.jsx(y.Input,{className:"message !p-0 !bg-transparent",active:!0}),e.jsx(y.Input,{className:"message !p-0 !bg-transparent",active:!0}),e.jsx(y.Input,{className:"message !p-0 !bg-transparent",active:!0}),e.jsx(y.Input,{className:"message self !p-0 !bg-transparent",active:!0}),e.jsx(y.Input,{className:"message self !p-0 !bg-transparent",active:!0}),e.jsx(y.Input,{className:"message self !p-0 !bg-transparent",active:!0}),e.jsx(y.Input,{className:"message self !p-0 !bg-transparent",active:!0}),e.jsx(y.Input,{className:"message !p-0 !bg-transparent",active:!0})]})}),ne=()=>{const[s,t]=c.useState(!1),[a,i]=c.useState(!0),[r,o]=c.useState();return{lastMessageLoading:a,lastMessage:r,chatReqLoading:s,getLatestMessage:async u=>{try{const n=await b.get(`/messages/latest/${u}`);n.data&&(o(n.data),i(!1))}catch(n){S(n)}},sendChatRequest:async(u,n)=>{try{t(!0);const m=await b.post("/chats/sendChatRequest",{senderId:u,recipientId:n});if(m.data)return k.success("Request send successfully"),t(!1),m.data}catch(m){t(!1),S(m)}},respondChatRequest:async(u,n,m)=>{try{(await b.post("/chats/chatRequestResponse",{senderId:u,recipientId:n,respond:m})).data}catch(l){S(l)}}}},re=()=>({getDpName:(s,t)=>s&&t?s.charAt(0)+t.charAt(0):s?s.charAt(0):""});function We({chat:s,user:t,index:a,setIsChatBoxOpen:i}){const{onlineUsers:r,notifications:o,updateCurrentChat:u,messages:n}=E(),{getRecipient:m,recipient:l,recipientLoading:f}=D(),{getLatestMessage:h,lastMessage:d}=ne(),{getDpName:p}=re(),R=ze(o,l==null?void 0:l._id),A=g=>r.some(N=>N.userId===g)&&e.jsx("div",{className:"absolute bottom-0 right-0 w-3 h-3 bg-green-500 border-2 border-white rounded-full"}),U=g=>d&&(g==null?void 0:g.senderId)!==(l==null?void 0:l._id)?e.jsxs("div",{className:"flex text-[12px]",children:[e.jsx("div",{className:"pr-1 font-bold text-orange-400",children:"you:"}),e.jsx("div",{className:"truncate",children:d==null?void 0:d.text})]}):e.jsx("div",{className:"text",children:d==null?void 0:d.text}),L=()=>{u(s,l==null?void 0:l._id),i(!0)};return c.useEffect(()=>{const g=s==null?void 0:s.members.find(P=>P!==(t==null?void 0:t._id));g&&m(g)},[s]),c.useEffect(()=>{h(s==null?void 0:s._id)},[o,n]),e.jsx(e.Fragment,{children:f?e.jsx(Ve,{}):e.jsxs("div",{className:"flex items-center justify-between p-2 cursor-pointer user-card",onClick:L,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative w-9 h-9",children:[e.jsx("div",{className:"content-center object-cover w-full h-full text-center rounded-full bg-slate-400",children:p((l==null?void 0:l.firstName)+" "+(l==null?void 0:l.lastName))}),A(l==null?void 0:l._id)]}),e.jsxs("div",{className:"text-content",children:[e.jsx("div",{className:"name",children:(l==null?void 0:l.firstName)+" "+(l==null?void 0:l.lastName)}),U(d)]})]}),e.jsxs("div",{className:"grid items-end text-right",children:[e.jsx("div",{className:"date !text-[12px]",children:M(d==null?void 0:d.updatedAt).calendar()}),R?e.jsx("div",{className:"flex justify-end",children:e.jsx("span",{className:"this-user-notifications",children:R})}):null]})]})})}const Ke=({user:s})=>{const{potentialChats:t,createChat:a,onlineUsers:i,potentialChatsLoading:r}=E(),o=n=>i.some(l=>l.userId===n)&&e.jsx("div",{className:"absolute bottom-0 right-0 w-2 h-2 bg-green-500 border-[1px] border-white rounded-full"}),u=n=>n.split(" ").map(m=>m.charAt(0).toUpperCase()).join("");return e.jsx(e.Fragment,{children:e.jsx("div",{className:"flex justify-around gap-2 overflow-x-scroll overflow-y-hidden lg:justify-normal md:justify-normal scrollbar",children:r?e.jsx(Je,{}):t&&t.map((n,m)=>e.jsxs("div",{className:"flex flex-col items-center p-2 mb-2 border-b-2 rounded-lg cursor-pointer w-14",onClick:()=>a(s==null?void 0:s._id,n==null?void 0:n._id),children:[e.jsxs("div",{className:"relative w-7 h-7",children:[e.jsx("div",{className:"w-full h-full rounded-full object-cover text-[12px] bg-violet-600 text-center content-center",children:u((n==null?void 0:n.firstName)+" "+(n==null?void 0:n.lastName))}),o(n._id)]}),e.jsx("div",{className:"mt-1 text-[9px] text-center",children:n==null?void 0:n.firstName})]},m))})})},Xe="modulepreload",Ge=function(s){return"/chatApp/"+s},K={},Qe=function(t,a,i){let r=Promise.resolve();if(a&&a.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),u=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));r=Promise.all(a.map(n=>{if(n=Ge(n),n in K)return;K[n]=!0;const m=n.endsWith(".css"),l=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${n}"]${l}`))return;const f=document.createElement("link");if(f.rel=m?"stylesheet":Xe,m||(f.as="script",f.crossOrigin=""),f.href=n,u&&f.setAttribute("nonce",u),document.head.appendChild(f),m)return new Promise((h,d)=>{f.addEventListener("load",h),f.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${n}`)))})}))}return r.then(()=>t()).catch(o=>{const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=o,window.dispatchEvent(u),!u.defaultPrevented)throw o})},Ye=c.lazy(()=>Qe(()=>import("./react-input-emoji-BIUyQkSU.js"),__vite__mapDeps([0,1,2,3,4]))),Ze=c.memo(({text:s,handleChange:t})=>e.jsx(e.Fragment,{children:e.jsx(c.Suspense,{fallback:e.jsx(J,{}),children:e.jsx(Ye,{value:s,onChange:t,fontFamily:"nunito",borderColor:"rgba(72, 112, 223, 0.2)"})})})),es=({user:s,setIsChatBoxOpen:t})=>{const{messages:a,messagesLoading:i,currentChat:r,sendTextMessage:o}=E(),{loading:u,recipient:n,getRecipient:m}=D(),[l,f]=c.useState(""),h=c.useRef();c.useEffect(()=>{const p=r==null?void 0:r.members.find(R=>R!==(s==null?void 0:s._id));p&&m(p)},[r]),c.useEffect(()=>{var p;(p=h.current)==null||p.scrollIntoView({behavior:"smooth"})},[a]);const d=c.useCallback(p=>{f(p)},[]);return i?e.jsx(He,{}):r?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"chat-box relative min-h-[calc(100vh-8vh)]",children:[e.jsxs("div",{className:"chat-header min-h-[6vh] !flex !justify-between",children:[e.jsx("div",{className:"ml-6 text-xl cursor-pointer lg:text-lg",onClick:()=>t(!1),children:e.jsx(ye,{})}),e.jsx("strong",{children:n==null?void 0:n.firstName}),e.jsx("span",{})]}),e.jsx("div",{className:"px-2 pt-2 messages pb-[10vh]",children:a&&a.map((p,R)=>e.jsxs("div",{ref:h,className:`${p.senderId===(s==null?void 0:s._id)?"message self ":"message "} `,children:[e.jsx("div",{children:p.text}),e.jsx("div",{className:"message-footer",children:M(p.createdAt).calendar()})]},R))}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 flex items-center max-h-[10vh] justify-between chat-input",children:[e.jsx(Ze,{text:l,handleChange:d}),e.jsx(Ce,{className:"content-center px-4 py-3 text-xl bg-blue-600 rounded-full",onClick:()=>o(l,s==null?void 0:s._id,r._id,f)})]})]})}):e.jsx("div",{className:"chat-box content-center min-h-[calc(100vh-12vh)]",children:e.jsx("div",{className:"flex justify-center ",children:"...No conversation selected"})})},ss=({u:s,handleChatRequest:t,chatReqLoading:a})=>{const{getDpName:i}=re();return e.jsxs("div",{className:"flex items-center justify-between p-2 cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"relative w-9 h-9",children:e.jsx("div",{className:"content-center object-cover w-full h-full text-center rounded-full bg-slate-400",children:i(s==null?void 0:s.firstName,s==null?void 0:s.lastName)})}),e.jsx("div",{className:"text-content",children:e.jsx("div",{className:"name",children:(s==null?void 0:s.firstName)+" "+(s==null?void 0:s.lastName)})})]}),e.jsx(B,{loading:a,onClick:()=>t(s==null?void 0:s._id),className:"content-center px-2 py-1 text-right ",children:"Chat Request"})]})},ts=({setIsSearching:s,isSearching:t})=>{const{searchedUsersLoading:a,searchedUsers:i,setSearchedUsers:r,searchUsersByPhoneNumber:o}=D(),{sendChatRequest:u,chatReqLoading:n}=ne(),{user:m}=I(),[l,f]=c.useState(""),h=()=>{l&&o(l)},d=async p=>{if((m==null?void 0:m._id)===p)return k.warning("Abey saale 🙂");await u(m==null?void 0:m._id,p),r([]),f("")};return c.useEffect(()=>{r([]),f("")},[t]),e.jsx("div",{className:"max-w-[400px] text-center my-2",children:e.jsxs("div",{className:"relative mx-2 md:w-4/5 ",children:[e.jsx("input",{type:"number",placeholder:"search friends...",className:"z-30 w-full h-10 px-3 py-1 text-sm rounded-md lg:h-8 bg-black/45",value:l,onChange:p=>f(p.target.value),onClick:()=>s(1)}),e.jsx("div",{className:"absolute content-center px-4 bg-orange-600 rounded-md hover:bg-orange-700 bottom-1 top-1 right-2",children:a?e.jsx(we,{}):e.jsx(Re,{className:"flex my-auto cursor-pointer",onClick:h})}),a?e.jsx(e.Fragment,{}):(i==null?void 0:i.length)>0&&e.jsx("div",{className:"absolute z-20 w-full py-2 mt-4 bg-gray-700 border rounded-md border-black/35",children:i==null?void 0:i.map((p,R)=>e.jsx(ss,{u:p,handleChatRequest:d,chatReqLoading:n},R))})]})})},as=()=>{const{userChat:s,chatLoading:t}=E(),{user:a}=I(),[i,r]=c.useState(0),[o,u]=c.useState(!1),n=()=>{r(0)};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-8",children:[e.jsxs("div",{className:`${o?"hidden lg:block col-span-3":"lg:col-span-3 col-span-8 relative"} "px-3 mb-2  "`,children:[e.jsx(ts,{setIsSearching:r,isSearching:i}),e.jsx("div",{hidden:!i,onClick:n,className:"absolute rounded-md z-10 w-full min-h-[calc(100vh-15vh)] bg-black bg-opacity-85"}),e.jsx(Ke,{user:a}),e.jsx("div",{children:!t&&s.map((m,l)=>e.jsx("div",{children:e.jsx(We,{chat:m,user:a,index:l,setIsChatBoxOpen:u})},l))})]}),e.jsx("div",{className:`${o?"lg:col-span-5 col-span-8":"hidden lg:block"} col-span-5 lg:pl-2`,children:e.jsx(es,{user:a,setIsChatBoxOpen:u})})]})})},ns=()=>{const{logIn:s,user:t,updateLoginInfo:a,loginInfo:i,loginLoading:r}=I(),[o,u]=c.useState(!1);return e.jsxs(e.Fragment,{children:[t?e.jsx(z,{to:"/"}):null,e.jsx("div",{className:"flex justify-center min-h-[calc(100vh-10vh)]",children:e.jsxs("div",{className:"grid grid-cols-4 my-auto ",children:[e.jsxs("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-2",children:[e.jsx("label",{htmlFor:"",children:"Phone Number"}),e.jsx("input",{type:"number",className:"px-2 py-1 rounded-md bg-neutral-600",onChange:n=>a({...i,phoneNumber:n.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-7",children:[e.jsx("label",{htmlFor:"",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:`${o?"text":"password"}`,className:"px-2 py-1 rounded-md bg-neutral-600",onChange:n=>a({...i,password:n.target.value})}),e.jsx("span",{className:"absolute cursor-pointer right-2 top-1",onClick:()=>u(!o),children:"👁"})]})]}),e.jsx("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-2",children:e.jsx(B,{onClick:s,loading:r,type:"primary",children:"Log In"})})]})})]})},rs=()=>{const{registerInfo:s,user:t,updateRegisterInfo:a,registerUser:i,registerLoading:r}=I(),[o,u]=c.useState(!1);return e.jsxs(e.Fragment,{children:[t?e.jsx(z,{to:"/"}):null,e.jsx("form",{action:"",children:e.jsx("div",{className:"flex justify-center min-h-[calc(100vh-10vh)]",children:e.jsxs("div",{className:"grid grid-cols-4 my-auto ",children:[e.jsxs("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-2",children:[e.jsx("label",{htmlFor:"",children:"First Name"}),e.jsx("input",{type:"text",className:"px-2 py-1 rounded-md bg-neutral-600",onChange:n=>a({...s,firstName:n.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-2",children:[e.jsx("label",{htmlFor:"",children:"Last Name"}),e.jsx("input",{type:"text",className:"px-2 py-1 rounded-md bg-neutral-600",onChange:n=>a({...s,lastName:n.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-2",children:[e.jsx("label",{htmlFor:"",children:"Phone Number"}),e.jsx("input",{type:"number",className:"px-2 py-1 rounded-md bg-neutral-600",onChange:n=>a({...s,phoneNumber:n.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-7",children:[e.jsx("label",{htmlFor:"",children:"Create Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:`${o?"text":"password"}`,className:"px-2 py-1 rounded-md bg-neutral-600",onChange:n=>a({...s,password:n.target.value})}),e.jsx("span",{className:"absolute cursor-pointer right-2 top-1",onClick:()=>u(!o),children:"👁"})]})]}),e.jsx("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-2",children:e.jsx(B,{onClick:i,type:"primary",loading:r,children:"Sign Up"})})]})})})]})},cs=()=>{const{user:s}=I(),{notifications:t,allUsers:a,openNewChat:i,markAllAsRead:r}=E(),[o,u]=c.useState(!1),n=se(t),m=t.map(h=>{let d=a.find(p=>p._id===h.senderId);return{...h,senderName:d==null?void 0:d.firstName}}),l=(h,d)=>{i(h,d),u(!1)};let f=()=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid max-h-[26vh] overflow-y-auto",children:[m!=null&&m.length?m.map((h,d)=>e.jsxs("div",{className:`${h.isRead?" text-black/30":"text-black"} border-slate-300 cursor-pointer border-b-[1px] p-1`,onClick:()=>l(h==null?void 0:h.senderId,s==null?void 0:s._id),children:[e.jsx("span",{className:"font-bold ",children:h==null?void 0:h.senderName}),e.jsx("span",{children:" sent a message"}),e.jsx("span",{className:"text-[10px] pl-4 align-bottom italic",children:M(h==null?void 0:h.date).calendar()})]},d)):e.jsx("div",{className:"text-center text-rose-600",children:"Empty"}),(m==null?void 0:m.length)>1?e.jsx("div",{className:"flex justify-end pt-3",children:e.jsx(B,{className:"text-[12px]",size:"small",type:"default",onClick:()=>r(m),children:"Mark all as read"})}):null]})});return e.jsx(e.Fragment,{children:e.jsx(X,{placement:"bottomRight",title:"Unread Notifications",content:f,trigger:"click",open:o,onOpenChange:()=>u(!o),children:e.jsx(G,{className:"content-center cursor-pointer",size:"small",count:n==null?void 0:n.length,children:e.jsx(Q,{className:"scale-75 lg:scale-100",shape:"circle",size:"default",icon:e.jsx(Se,{})})})})})},ce=()=>{const[s,t]=c.useState();return{chatRequest:s,sendChatRequest:async(a,i)=>{try{if((await b.post("/chats/sendChatRequest",{senderId:a,recipientId:i})).data)return!0}catch(r){console.log(r),S(r)}},getChatRequestById:async a=>{try{const i=await b.get(`/chats/getChatRequest/${a}`);if(i.data)return t(i.data[0]),!0}catch(i){console.log(i)}},respondChatRequest:async(a,i,r)=>{try{(await b.post("/chats/chatRequestResponse",{chatReqId:a,recipientId:i,respond:r})).data}catch(o){console.log(o)}}}},is=(s,t)=>{const{sender_details:a,receiver_details:i}=s;return s.sender===t?e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-orange-600",children:i.firstName+" "+i.lastName+" "}),s.status==="accepted"?e.jsx($,{color:"success",icon:e.jsx(V,{}),children:"accepted"}):e.jsx($,{color:"default",icon:e.jsx(H,{}),children:"pending"})]}),e.jsx("span",{children:i.phoneNumber})]}):e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-orange-600",children:a.firstName+" "+a.lastName+" "}),s.status==="accepted"?e.jsx($,{color:"success",icon:e.jsx(V,{}),children:"friendzz"}):e.jsx($,{color:"default",icon:e.jsx(H,{}),children:"pending"})]}),e.jsx("span",{children:a.phoneNumber})]})},os=({chatReqId:s,handleRespondChatRequest:t})=>{const{chatRequest:a,getChatRequestById:i}=ce(),{user:r}=I();return c.useEffect(()=>{i(s)},[s]),e.jsx(e.Fragment,{children:a?e.jsx("div",{children:e.jsxs("div",{className:"border-slate-300 cursor-pointer border-b-[1px] p-1 flex justify-between",children:[is(a,r==null?void 0:r._id),e.jsxs("div",{className:"flex flex-col text-lg text-right",children:[a.status!=="accepted"&&a.sender!==(r==null?void 0:r._id)?e.jsxs("span",{className:"flex justify-end gap-3",children:[e.jsx("div",{className:"px-4 py-0 text-gray-500 bg-green-500 rounded-md",children:e.jsx(V,{onClick:()=>t(s,a==null?void 0:a.receiver,"accept")})}),e.jsx("div",{className:"px-4 py-0 text-gray-200 rounded-md bg-rose-600",children:e.jsx(Ie,{onClick:()=>t(s,a==null?void 0:a.receiver,"reject")})})]}):e.jsx("span",{className:"text-right",children:e.jsx(ke,{})}),e.jsx("span",{className:"text-[10px] pl-4 align-bottom italic",children:M(a.status!=="accepted"?a==null?void 0:a.sentAt:a==null?void 0:a.respondedAt).calendar()})]})]})}):e.jsx(e.Fragment,{})})},ls=()=>{const{user:s}=I(),{setIsNewFriendAdded:t}=E(),{getRecipient:a,recipient:i,recipientLoading:r}=D(),{respondChatRequest:o}=ce(),[u,n]=c.useState(!1);c.useEffect(()=>{s&&a(s._id)},[s]);const m=async(f,h,d)=>{await o(f,h,d),await a(s._id),t(!0),n(!1)};let l=()=>{var f,h;return e.jsx(e.Fragment,{children:e.jsx("div",{className:"grid max-h-[26vh] overflow-y-auto",children:r?e.jsx(J,{}):e.jsx(e.Fragment,{children:(f=i==null?void 0:i.friendRequests)!=null&&f.length?(h=i==null?void 0:i.friendRequests)==null?void 0:h.map((d,p)=>e.jsx(os,{chatReqId:d,handleRespondChatRequest:m},p)).reverse():e.jsx("div",{className:"text-center text-rose-600",children:"No Chat Requests"})})})})};return e.jsx(X,{placement:"bottomRight",title:"Chat Requests",content:l,trigger:"click",open:u,onOpenChange:()=>n(!u),children:e.jsx(G,{className:"content-center cursor-pointer",size:"small",children:e.jsx(Q,{className:"scale-75 lg:scale-100",shape:"circle",size:"default",icon:e.jsx(Le,{})})})})},ds=()=>{const{user:s,logOut:t}=I(),a=_e(),i=s?[{label:"Logout",key:"1",icon:e.jsx(Ae,{}),onClick:()=>{t()}}]:[{label:"Login",key:"1",icon:e.jsx(W,{}),onClick:()=>{a("/login")}},{label:"Register",key:"2",icon:e.jsx(W,{}),onClick:()=>{a("/register")}}];return e.jsx(e.Fragment,{children:e.jsx("div",{className:" bg-slate-700",children:e.jsxs("div",{className:"flex justify-between min-h-[8vh] lg:px-[56px] px-3 ",children:[e.jsx("div",{className:"content-center hidden cursor-pointer lg:block",children:e.jsx(Oe,{to:"/",children:"ChatApp"})}),e.jsxs("div",{className:"flex gap-1 ",children:[s&&e.jsxs("div",{className:"content-center",children:[e.jsx("span",{children:"Hi "}),e.jsx("span",{className:"italic text-amber-500",children:s==null?void 0:s.firstName}),e.jsx("span",{children:"..."})]}),e.jsx("div",{className:"content-center italic scale-125",children:"🍁"})]}),e.jsxs("div",{className:"flex gap-2 my-auto lg:gap-6",children:[s&&e.jsxs("div",{className:"lg:flex lg:gap-2",children:[e.jsx(ls,{}),e.jsx(cs,{})]}),e.jsx(be,{menu:{items:i},trigger:["click"],children:e.jsx("a",{className:"content-center",onClick:r=>r.preventDefault(),children:e.jsx(Ue,{})})})]})]})})})},ms=({children:s})=>{const{user:t,loading:a}=I(),i=Ee();return a?e.jsx("div",{className:"h-[100vh] content-center",children:e.jsx("div",{className:"flex justify-center ",children:e.jsx(J,{size:"large"})})}):t?s:e.jsx(z,{to:"/login",state:{from:i}})};function us(){const{user:s}=I();return e.jsx(e.Fragment,{children:e.jsxs(De,{user:s,children:[e.jsx(ds,{}),e.jsx("div",{className:"",children:e.jsxs(Fe,{children:[e.jsx(q,{path:"/",element:e.jsx(ms,{children:e.jsx(as,{})})}),e.jsx(q,{path:"/login",element:e.jsx(ns,{})}),e.jsx(q,{path:"/register",element:e.jsx(rs,{})}),e.jsx(q,{path:"*",element:e.jsx(z,{to:"/"})})]})})]})})}je.createRoot(document.getElementById("root")).render(e.jsx(fe.StrictMode,{children:e.jsx(Te,{children:e.jsx(Pe,{basename:"/chatApp",children:e.jsx(us,{})})})}));
