const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/react-input-emoji-BIUyQkSU.js","assets/react-DHBI0EtI.js","assets/classnames-C9FZUsQl.js","assets/react-dom-vAgahkSm.js","assets/scheduler-CzFDRTuY.js"])))=>i.map(i=>d[i]);
import{r as c,j as e,a as ge}from"./react-DHBI0EtI.js";import{c as fe}from"./react-dom-vAgahkSm.js";import{a as je}from"./axios-B4uVmeYG.js";import{l as Ne}from"./socket.io-client-DFi9RC7o.js";import{s as L,S as y,a as H,B as z,P as K,b as Z,A as G,T as $,D as ve}from"./antd-DGosEx24.js";import{h as M}from"./moment-C5S46NFB.js";import{o as be,j as ye,p as Ce,q as we,r as T,s as V,v as Se,w as Ie,x as Re,y as Le,z as J,A as ke}from"./@ant-design-lagzWgUo.js";import{d as B,a as Ue,b as _e,e as Ae,f as q}from"./react-router-mPJ5A8eT.js";import{L as Fe,B as Ee}from"./react-router-dom-CBWY55wr.js";import"./classnames-C9FZUsQl.js";import"./scheduler-CzFDRTuY.js";import"./engine.io-client-DBBxzneW.js";import"./engine.io-parser-BiEtp6m2.js";import"./@socket.io-Dkula2eQ.js";import"./socket.io-parser-BBkuslX-.js";import"./rc-util-DRk5y4Yu.js";import"./@babel-DDXZNtFh.js";import"./rc-resize-observer-DhIh4Bln.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./rc-motion-B7bZ38Ss.js";import"./rc-overflow-DZRiDIAM.js";import"./rc-tooltip-DduOv04A.js";import"./@rc-component-Db8YWiD8.js";import"./rc-menu-DFg7V8Qr.js";import"./rc-dropdown-1QSiw7eM.js";import"./rc-field-form-BLZ5SSc5.js";import"./@ctrl-DOFZgDuz.js";import"./throttle-debounce-CUWDS_la.js";import"./rc-notification-B-HVxHmI.js";import"./rc-pagination-TIHhowL0.js";import"./rc-picker-CcREweDU.js";import"./@emotion-CW87jbl0.js";import"./stylis-DsJDcYJc.js";import"./@remix-run-BZ1VHzzA.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&i(u)}).observe(document,{childList:!0,subtree:!0});function a(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(r){if(r.ep)return;r.ep=!0;const l=a(r);fetch(r.href,l)}})();let Q="",X="";Q="https://chatapp-5f1p.onrender.com/api",X="https://chatapp-socket-oi5c.onrender.com";const Oe=Object.freeze({server:Q,socket:X}),Y=Oe,b=je.create({baseURL:Y.server,timeout:4e4,headers:{"Content-Type":"application/json"}}),I=s=>{s.response&&s.response.data?L.error(s.response.data.message):s.message?L.error(s.message):L.error("An error occurred. Please try again.")},ee=c.createContext(null),Pe=({children:s,user:t})=>{const[a,i]=c.useState(!1),[r,l]=c.useState([]),[u,n]=c.useState([]),[m,o]=c.useState([]),[f,h]=c.useState([]),[d,p]=c.useState(null),[w,U]=c.useState(!1),[A,k]=c.useState(null),[g,O]=c.useState(null),[N,ce]=c.useState(null),[ie,le]=c.useState([]),[F,E]=c.useState([]),[oe,de]=c.useState(!1),me=c.useCallback(async(j,x)=>{try{i(!0);const v=await b.post("/chats",{firstId:j,secondId:x});v.data&&(l(C=>[v.data,...C]),i(!1))}catch(v){I(v)}},[]),ue=c.useCallback(async(j,x,v,C)=>{try{const S=await b.post("/messages",{chatId:v,senderId:x,text:j});S.data&&(O(S.data),k(P=>[...P,S.data]),C(""))}catch(S){I(S)}},[]),he=c.useCallback((j,x)=>{p(j);const v=F.map(C=>C.senderId===x?{...C,isRead:!0}:C);E(v)},[F]),pe=c.useCallback(async(j,x)=>{try{const v=await b.get(`/chats/${j}/${x}`);if(v.data){p(v.data);const C=F.map(S=>S.senderId===j?{...S,isRead:!0}:S);E(C)}}catch(v){I(v)}},[F]),xe=c.useCallback(j=>{const x=j.map(v=>({...v,isRead:!0}));E(x)},[]);return c.useEffect(()=>{if(!t)return;(async()=>{try{i(!0);const x=await b.get(`/chats/${t==null?void 0:t._id}`);x.data&&(l(x.data),i(!1))}catch(x){I(x)}})()},[t]),c.useEffect(()=>{if(!t)return;(async()=>{try{n(!0);const x=await b.get(`/user/getAllFriends/${t._id}`);if(x.data){const v=x.data.filter(C=>{let S=!1;return t._id===C._id?!1:(r&&(S=r==null?void 0:r.some(P=>P.members[0]===C._id||P.members[1]===C._id)),!S)});h(x.data),o(v),n(!1)}}catch(x){n(!1),I(x)}})()},[r,oe]),c.useEffect(()=>{const j=async()=>{try{U(!0);const x=await b.get(`/messages/${d==null?void 0:d._id}`);x.data&&(k(x.data),U(!1))}catch(x){I(x)}};d&&j()},[d]),c.useEffect(()=>{const j=Ne(Y.socket);return ce(j),()=>{j.disconnect()}},[t]),c.useEffect(()=>{N===null&&!t||N.emit("addOnlineUser",t==null?void 0:t._id)},[N]),c.useEffect(()=>{if(!(N===null&&!t))return N.on("getOnlineUsers",j=>{le(j)}),()=>{N.off("getOnlineUsers")}},[N]),c.useEffect(()=>{N===null&&!t||N.emit("sendNewMessage",{recipientId:d==null?void 0:d.members.find(j=>j!==(t==null?void 0:t._id)),textMessage:g})},[g]),c.useEffect(()=>{if(!(N===null&&!t))return N.on("getNewMessage",j=>{(d==null?void 0:d._id)===j.chatId&&k(x=>[...x,j])}),N.on("sendNotification",j=>{d!=null&&d.members.find(x=>x===j.senderId)?E(x=>[{...j,isRead:!0},...x]):E(x=>[j,...x])}),()=>{N.off("getNewMessage"),N.off("sendNotification")}},[N,d]),e.jsx(e.Fragment,{children:e.jsx(ee.Provider,{value:{userChat:r,chatLoading:a,potentialChats:m,potentialChatsLoading:u,allUsers:f,createChat:me,currentChat:d,updateCurrentChat:he,messages:A,messagesLoading:w,sendTextMessage:ue,onlineUsers:ie,notifications:F,openNewChat:pe,markAllAsRead:xe,setIsNewFriendAdded:de},children:s})})},_=()=>c.useContext(ee),se=c.createContext(),$e=({children:s})=>{const[t,a]=c.useState(!0),[i,r]=c.useState(!1),[l,u]=c.useState(null),[n,m]=c.useState(!1),[o,f]=c.useState({firstName:"",lastName:"",phoneNumber:"",password:""}),[h,d]=c.useState({phoneNumber:"",password:""}),p=c.useCallback(async()=>{try{if(!o.phoneNumber&&!o.password&&!o.firstName&&!o.lastName)return L.warning("All fields required");m(!0);const g=await b.post("/user/register",o);g.data&&(localStorage.setItem("userData",JSON.stringify(g.data)),u(g.data),m(!1),L.success(g.data.message))}catch(g){m(!1),I(g)}},[o]),w=c.useCallback(g=>{f(g)},[]),U=c.useCallback(g=>{d(g)},[]),A=c.useCallback(()=>{localStorage.removeItem("userData"),u(null)},[]),k=c.useCallback(async()=>{try{if(!h.phoneNumber&&!h.password)return L.success("All fields required");r(!0);const g=await b.post("/user/login",h);g.data&&(localStorage.setItem("userData",JSON.stringify(g.data)),u(g.data),r(!1),L.success(g.data.message))}catch(g){r(!1),I(g)}},[h]);return c.useEffect(()=>{const g=localStorage.getItem("userData");u(JSON.parse(g)),a(!1)},[]),e.jsx(e.Fragment,{children:e.jsx(se.Provider,{value:{user:l,registerInfo:o,updateRegisterInfo:w,registerLoading:n,registerUser:p,loading:t,logOut:A,logIn:k,loginLoading:i,loginInfo:h,updateLoginInfo:U},children:s})})},R=()=>c.useContext(se),D=()=>{const[s,t]=c.useState(),[a,i]=c.useState(!1),[r,l]=c.useState([]),[u,n]=c.useState(!1),[m,o]=c.useState(),[f,h]=c.useState(!1);return{recipientLoading:a,recipient:s,searchedUsersLoading:u,searchedUsers:r,recipients:m,recipientsLoading:f,setSearchedUsers:l,getRecipient:async d=>{try{i(!0);const p=await b.get(`/user/find/${d}`);p.data&&(t(p.data),i(!1))}catch{i(!1)}},getRecipients:async d=>{try{h(!0);const p=await b.post("/user/getUsersById",{recipientId:d});p.data&&(o(p.data),h(!1))}catch{h(!1)}},searchUsersByPhoneNumber:async d=>{try{n(!0);const p=await b.get(`/user/findByNumber/${d}`);p.data&&(l(p.data),n(!1))}catch{n(!1)}}}},qe=()=>e.jsx("div",{className:"user-card flex justify-between items-center p-2 cursor-pointer",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:" ",children:e.jsx(y.Avatar,{size:"large",active:!0})}),e.jsxs("div",{className:"text-content",children:[e.jsx(y.Input,{size:"small",style:{height:"14px"},block:!0,active:!0}),e.jsx(y.Input,{size:"small",style:{height:"10px"},active:!0})]})]})}),ze=()=>e.jsxs("div",{className:"flex flex-col gap-1 items-center w-6 pl-8",children:[e.jsx(y.Avatar,{active:!0}),e.jsx(y.Button,{active:!0,size:"small",style:{height:"6px"}})]}),Me=()=>e.jsx("div",{className:"chat-box content-center !bg-neutral-700 min-h-[calc(100vh-8vh)]",children:e.jsxs("div",{className:"messages pb-4 px-1 lg:px-4",children:[e.jsx(y.Input,{className:"message self !p-0 !bg-transparent",active:!0}),e.jsx(y.Input,{className:"message !p-0 !bg-transparent",active:!0}),e.jsx(y.Input,{className:"message !p-0 !bg-transparent",active:!0}),e.jsx(y.Input,{className:"message !p-0 !bg-transparent",active:!0}),e.jsx(y.Input,{className:"message !p-0 !bg-transparent",active:!0}),e.jsx(y.Input,{className:"message self !p-0 !bg-transparent",active:!0}),e.jsx(y.Input,{className:"message self !p-0 !bg-transparent",active:!0}),e.jsx(y.Input,{className:"message self !p-0 !bg-transparent",active:!0}),e.jsx(y.Input,{className:"message self !p-0 !bg-transparent",active:!0}),e.jsx(y.Input,{className:"message !p-0 !bg-transparent",active:!0})]})}),te=s=>s.filter(t=>!t.isRead),Be=(s,t)=>te(s).filter(i=>i.senderId===t).length,ae=()=>{const[s,t]=c.useState(!1),[a,i]=c.useState(!0),[r,l]=c.useState();return{lastMessageLoading:a,lastMessage:r,chatReqLoading:s,getLatestMessage:async u=>{try{const n=await b.get(`/messages/latest/${u}`);n.data&&(l(n.data),i(!1))}catch(n){I(n)}},sendChatRequest:async(u,n)=>{try{t(!0);const m=await b.post("/chats/sendChatRequest",{senderId:u,recipientId:n});if(m.data)return L.success("Request send successfully"),t(!1),m.data}catch(m){t(!1),I(m)}},respondChatRequest:async(u,n,m)=>{try{(await b.post("/chats/chatRequestResponse",{senderId:u,recipientId:n,respond:m})).data}catch(o){I(o)}}}},ne=()=>({getDpName:(s,t)=>s&&t?s.charAt(0)+t.charAt(0):s?s.charAt(0):""});function De({chat:s,user:t,index:a,setIsChatBoxOpen:i}){const{onlineUsers:r,notifications:l,updateCurrentChat:u,messages:n}=_(),{getRecipient:m,recipient:o,recipientLoading:f}=D(),{getLatestMessage:h,lastMessage:d}=ae(),{getDpName:p}=ne(),w=Be(l,o==null?void 0:o._id),U=g=>r.some(N=>N.userId===g)&&e.jsx("div",{className:"absolute bottom-0 right-0 w-3 h-3 bg-green-500 border-2 border-white rounded-full"}),A=g=>d&&(g==null?void 0:g.senderId)!==(o==null?void 0:o._id)?e.jsxs("div",{className:"flex text-[12px]",children:[e.jsx("div",{className:"pr-1 font-bold text-orange-400",children:"you:"}),e.jsx("div",{className:"truncate",children:d==null?void 0:d.text})]}):e.jsx("div",{className:"text",children:d==null?void 0:d.text}),k=()=>{u(s,o==null?void 0:o._id),i(!0)};return c.useEffect(()=>{const g=s==null?void 0:s.members.find(O=>O!==(t==null?void 0:t._id));g&&m(g)},[s]),c.useEffect(()=>{h(s==null?void 0:s._id)},[l,n]),e.jsx(e.Fragment,{children:f?e.jsx(qe,{}):e.jsxs("div",{className:"flex items-center justify-between p-2 cursor-pointer user-card",onClick:k,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative w-9 h-9",children:[e.jsx("div",{className:"content-center object-cover w-full h-full text-center rounded-full bg-slate-400",children:p((o==null?void 0:o.firstName)+" "+(o==null?void 0:o.lastName))}),U(o==null?void 0:o._id)]}),e.jsxs("div",{className:"text-content",children:[e.jsx("div",{className:"name",children:(o==null?void 0:o.firstName)+" "+(o==null?void 0:o.lastName)}),A(d)]})]}),e.jsxs("div",{className:"grid items-end text-right",children:[e.jsx("div",{className:"date !text-[12px]",children:M(d==null?void 0:d.updatedAt).calendar()}),w?e.jsx("div",{className:"flex justify-end",children:e.jsx("span",{className:"this-user-notifications",children:w})}):null]})]})})}const Te=({user:s})=>{const{potentialChats:t,createChat:a,onlineUsers:i,potentialChatsLoading:r}=_(),l=n=>i.some(o=>o.userId===n)&&e.jsx("div",{className:"absolute bottom-0 right-0 w-2 h-2 bg-green-500 border-[1px] border-white rounded-full"}),u=n=>n.split(" ").map(m=>m.charAt(0).toUpperCase()).join("");return e.jsx(e.Fragment,{children:e.jsx("div",{className:"flex justify-center gap-2 overflow-x-scroll overflow-y-hidden lg:justify-normal md:justify-normal scrollbar",children:r?e.jsx(ze,{}):t&&t.map((n,m)=>e.jsxs("div",{className:"flex flex-col items-center p-2 mb-2 border-b-2 rounded-lg cursor-pointer w-14",onClick:()=>a(s==null?void 0:s._id,n==null?void 0:n._id),children:[e.jsxs("div",{className:"relative w-7 h-7",children:[e.jsx("div",{className:"w-full h-full rounded-full object-cover text-[12px] bg-violet-600 text-center content-center",children:u((n==null?void 0:n.firstName)+" "+(n==null?void 0:n.lastName))}),l(n._id)]}),e.jsx("div",{className:"mt-1 text-[9px] text-center",children:n==null?void 0:n.firstName})]},m))})})},He="modulepreload",Ve=function(s){return"/chatApp/"+s},W={},Je=function(t,a,i){let r=Promise.resolve();if(a&&a.length>0){document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),u=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));r=Promise.all(a.map(n=>{if(n=Ve(n),n in W)return;W[n]=!0;const m=n.endsWith(".css"),o=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${n}"]${o}`))return;const f=document.createElement("link");if(f.rel=m?"stylesheet":He,m||(f.as="script",f.crossOrigin=""),f.href=n,u&&f.setAttribute("nonce",u),document.head.appendChild(f),m)return new Promise((h,d)=>{f.addEventListener("load",h),f.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${n}`)))})}))}return r.then(()=>t()).catch(l=>{const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=l,window.dispatchEvent(u),!u.defaultPrevented)throw l})},We=c.lazy(()=>Je(()=>import("./react-input-emoji-BIUyQkSU.js"),__vite__mapDeps([0,1,2,3,4]))),Ke=c.memo(({text:s,handleChange:t})=>e.jsx(e.Fragment,{children:e.jsx(c.Suspense,{fallback:e.jsx(H,{}),children:e.jsx(We,{value:s,onChange:t,fontFamily:"nunito",borderColor:"rgba(72, 112, 223, 0.2)"})})})),Ze=({user:s,setIsChatBoxOpen:t})=>{const{messages:a,messagesLoading:i,currentChat:r,sendTextMessage:l}=_(),{loading:u,recipient:n,getRecipient:m}=D(),[o,f]=c.useState(""),h=c.useRef();c.useEffect(()=>{const p=r==null?void 0:r.members.find(w=>w!==(s==null?void 0:s._id));p&&m(p)},[r]),c.useEffect(()=>{var p;(p=h.current)==null||p.scrollIntoView({behavior:"smooth"})},[a]);const d=c.useCallback(p=>{f(p)},[]);return i?e.jsx(Me,{}):r?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"chat-box relative min-h-[calc(100vh-8vh)]",children:[e.jsxs("div",{className:"chat-header !flex !justify-between",children:[e.jsx("div",{className:"pl-2 text-xl cursor-pointer lg:text-lg",onClick:()=>t(!1),children:e.jsx(be,{})}),e.jsx("strong",{children:n==null?void 0:n.firstName}),e.jsx("span",{})]}),e.jsx("div",{className:"messages lg:pb-[46px] pt-2 pb-5 px-3 lg:px-4",children:a&&a.map((p,w)=>e.jsxs("div",{ref:h,className:`${p.senderId===(s==null?void 0:s._id)?"message self ":"message "} `,children:[e.jsx("div",{children:p.text}),e.jsx("div",{className:"message-footer",children:M(p.createdAt).calendar()})]},w))}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 flex items-center justify-between chat-input",children:[e.jsx(Ke,{text:o,handleChange:d}),e.jsx("button",{className:"items-end content-center w-8 h-8 rounded-full bg-sky-600",onClick:()=>l(o,s==null?void 0:s._id,r._id,f),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"28",height:"28",fill:"currentColor",className:"scale-75 bi bi-send",viewBox:"0 0 16 16",children:e.jsx("path",{d:"M15.854.146a.5.5 0 0 1 .11.54l-5.819 14.547a.75.75 0 0 1-1.329.124l-3.178-4.995L.643 7.184a.75.75 0 0 1 .124-1.33L15.314.037a.5.5 0 0 1 .54.11ZM6.636 10.07l2.761 4.338L14.13 2.576zm6.787-8.201L1.591 6.602l4.339 2.76z"})})})]})]})}):e.jsx("div",{className:"chat-box content-center min-h-[calc(100vh-8vh)]",children:e.jsx("div",{className:"flex justify-center ",children:"...No conversation selected"})})},Ge=({u:s,handleChatRequest:t,chatReqLoading:a})=>{const{getDpName:i}=ne();return e.jsxs("div",{className:"flex items-center justify-between p-2 cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"relative w-9 h-9",children:e.jsx("div",{className:"content-center object-cover w-full h-full text-center rounded-full bg-slate-400",children:i(s==null?void 0:s.firstName,s==null?void 0:s.lastName)})}),e.jsx("div",{className:"text-content",children:e.jsx("div",{className:"name",children:(s==null?void 0:s.firstName)+" "+(s==null?void 0:s.lastName)})})]}),e.jsx(z,{loading:a,onClick:()=>t(s==null?void 0:s._id),className:"content-center px-2 py-1 text-right ",children:"Chat Request"})]})},Qe=({setIsSearching:s,isSearching:t})=>{const{searchedUsersLoading:a,searchedUsers:i,setSearchedUsers:r,searchUsersByPhoneNumber:l}=D(),{sendChatRequest:u,chatReqLoading:n}=ae(),{user:m}=R(),[o,f]=c.useState(""),h=()=>{o&&l(o)},d=async p=>{if((m==null?void 0:m._id)===p)return L.warning("Abey saale ðŸ™‚");await u(m==null?void 0:m._id,p),r([]),f("")};return c.useEffect(()=>{r([]),f("")},[t]),e.jsx("div",{className:"max-w-[400px] text-center my-2",children:e.jsxs("div",{className:"relative mx-2 md:w-4/5 ",children:[e.jsx("input",{type:"number",placeholder:"search friends...",className:"z-30 w-full h-10 px-3 py-1 text-sm rounded-md lg:h-8 bg-black/45",value:o,onChange:p=>f(p.target.value),onClick:()=>s(1)}),e.jsx("div",{className:"absolute content-center px-4 bg-orange-600 rounded-md hover:bg-orange-700 bottom-1 top-1 right-2",children:a?e.jsx(ye,{}):e.jsx(Ce,{className:"flex my-auto cursor-pointer",onClick:h})}),a?e.jsx(e.Fragment,{}):(i==null?void 0:i.length)>0&&e.jsx("div",{className:"absolute z-20 w-full py-2 mt-4 bg-gray-700 border rounded-md border-black/35",children:i==null?void 0:i.map((p,w)=>e.jsx(Ge,{u:p,handleChatRequest:d,chatReqLoading:n},w))})]})})},Xe=()=>{const{userChat:s,chatLoading:t}=_(),{user:a}=R(),[i,r]=c.useState(0),[l,u]=c.useState(!1),n=()=>{r(0)};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-8 ",children:[e.jsxs("div",{className:`${l?"hidden lg:block col-span-3":"lg:col-span-3 col-span-8 relative"} "px-3 mb-2  "`,children:[e.jsx(Qe,{setIsSearching:r,isSearching:i}),e.jsx("div",{hidden:!i,onClick:n,className:"absolute rounded-md z-10 w-full min-h-[calc(100vh-15vh)] bg-black bg-opacity-85"}),e.jsx(Te,{user:a}),e.jsx("div",{children:!t&&s.map((m,o)=>e.jsx("div",{children:e.jsx(De,{chat:m,user:a,index:o,setIsChatBoxOpen:u})},o))})]}),e.jsx("div",{className:`${l?"lg:col-span-5 col-span-8":"hidden lg:block"} col-span-5 lg:pl-2`,children:e.jsx(Ze,{user:a,setIsChatBoxOpen:u})})]})})},Ye=()=>{const{logIn:s,user:t,updateLoginInfo:a,loginInfo:i,loginLoading:r}=R(),[l,u]=c.useState(!1);return e.jsxs(e.Fragment,{children:[t?e.jsx(B,{to:"/"}):null,e.jsx("div",{className:"flex justify-center min-h-[calc(100vh-10vh)]",children:e.jsxs("div",{className:"grid grid-cols-4 my-auto ",children:[e.jsxs("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-2",children:[e.jsx("label",{htmlFor:"",children:"Phone Number"}),e.jsx("input",{type:"number",className:"px-2 py-1 rounded-md bg-neutral-600",onChange:n=>a({...i,phoneNumber:n.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-7",children:[e.jsx("label",{htmlFor:"",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:`${l?"text":"password"}`,className:"px-2 py-1 rounded-md bg-neutral-600",onChange:n=>a({...i,password:n.target.value})}),e.jsx("span",{className:"absolute cursor-pointer right-2 top-1",onClick:()=>u(!l),children:"ðŸ‘"})]})]}),e.jsx("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-2",children:e.jsx(z,{onClick:s,loading:r,type:"primary",children:"Log In"})})]})})]})},es=()=>{const{registerInfo:s,user:t,updateRegisterInfo:a,registerUser:i,registerLoading:r}=R(),[l,u]=c.useState(!1);return e.jsxs(e.Fragment,{children:[t?e.jsx(B,{to:"/"}):null,e.jsx("form",{action:"",children:e.jsx("div",{className:"flex justify-center min-h-[calc(100vh-10vh)]",children:e.jsxs("div",{className:"grid grid-cols-4 my-auto ",children:[e.jsxs("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-2",children:[e.jsx("label",{htmlFor:"",children:"First Name"}),e.jsx("input",{type:"text",className:"px-2 py-1 rounded-md bg-neutral-600",onChange:n=>a({...s,firstName:n.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-2",children:[e.jsx("label",{htmlFor:"",children:"Last Name"}),e.jsx("input",{type:"text",className:"px-2 py-1 rounded-md bg-neutral-600",onChange:n=>a({...s,lastName:n.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-2",children:[e.jsx("label",{htmlFor:"",children:"Phone Number"}),e.jsx("input",{type:"number",className:"px-2 py-1 rounded-md bg-neutral-600",onChange:n=>a({...s,phoneNumber:n.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-7",children:[e.jsx("label",{htmlFor:"",children:"Create Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:`${l?"text":"password"}`,className:"px-2 py-1 rounded-md bg-neutral-600",onChange:n=>a({...s,password:n.target.value})}),e.jsx("span",{className:"absolute cursor-pointer right-2 top-1",onClick:()=>u(!l),children:"ðŸ‘"})]})]}),e.jsx("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-2",children:e.jsx(z,{onClick:i,type:"primary",loading:r,children:"Sign Up"})})]})})})]})},ss=()=>{const{user:s}=R(),{notifications:t,allUsers:a,openNewChat:i,markAllAsRead:r}=_(),[l,u]=c.useState(!1),n=te(t),m=t.map(h=>{let d=a.find(p=>p._id===h.senderId);return{...h,senderName:d==null?void 0:d.firstName}}),o=(h,d)=>{i(h,d),u(!1)};let f=()=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid",children:[m!=null&&m.length?m.map((h,d)=>e.jsxs("div",{className:`${h.isRead?" text-black/30":"text-black"} border-slate-300 cursor-pointer border-b-[1px] p-1`,onClick:()=>o(h==null?void 0:h.senderId,s==null?void 0:s._id),children:[e.jsx("span",{className:"font-bold ",children:h==null?void 0:h.senderName}),e.jsx("span",{children:" sent a message"}),e.jsx("span",{className:"text-[10px] pl-4 align-bottom italic",children:M(h==null?void 0:h.date).calendar()})]},d)):e.jsx("div",{className:"text-center text-rose-600",children:"Empty"}),(m==null?void 0:m.length)>1?e.jsx("div",{className:"flex justify-end pt-3",children:e.jsx(z,{className:"text-[12px]",size:"small",type:"default",onClick:()=>r(m),children:"Mark all as read"})}):null]})});return e.jsx(e.Fragment,{children:e.jsx(K,{placement:"bottomRight",title:"Unread Notifications",content:f,trigger:"click",open:l,onOpenChange:()=>u(!l),children:e.jsx(Z,{className:"content-center cursor-pointer",size:"small",count:n==null?void 0:n.length,children:e.jsx(G,{className:"scale-75 lg:scale-100",shape:"circle",size:"default",icon:e.jsx(we,{})})})})})},re=()=>{const[s,t]=c.useState();return{chatRequest:s,sendChatRequest:async(a,i)=>{try{if((await b.post("/chats/sendChatRequest",{senderId:a,recipientId:i})).data)return!0}catch(r){console.log(r),I(r)}},getChatRequestById:async a=>{try{const i=await b.get(`/chats/getChatRequest/${a}`);if(i.data)return t(i.data[0]),!0}catch(i){console.log(i)}},respondChatRequest:async(a,i,r)=>{try{(await b.post("/chats/chatRequestResponse",{chatReqId:a,recipientId:i,respond:r})).data}catch(l){console.log(l)}}}},ts=(s,t)=>{const{sender_details:a,receiver_details:i}=s;return s.sender===t?e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-orange-600",children:i.firstName+" "+i.lastName+" "}),s.status==="accepted"?e.jsx($,{color:"success",icon:e.jsx(T,{}),children:"accepted"}):e.jsx($,{color:"default",icon:e.jsx(V,{}),children:"pending"})]}),e.jsx("span",{children:i.phoneNumber})]}):e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-orange-600",children:a.firstName+" "+a.lastName+" "}),s.status==="accepted"?e.jsx($,{color:"success",icon:e.jsx(T,{}),children:"friendzz"}):e.jsx($,{color:"default",icon:e.jsx(V,{}),children:"pending"})]}),e.jsx("span",{children:a.phoneNumber})]})},as=({chatReqId:s,handleRespondChatRequest:t})=>{const{chatRequest:a,getChatRequestById:i}=re(),{user:r}=R();return c.useEffect(()=>{i(s)},[s]),e.jsx(e.Fragment,{children:a?e.jsx("div",{children:e.jsxs("div",{className:"border-slate-300 cursor-pointer border-b-[1px] p-1 flex justify-between",children:[ts(a,r==null?void 0:r._id),e.jsxs("div",{className:"flex flex-col text-lg text-right",children:[a.status!=="accepted"&&a.sender!==(r==null?void 0:r._id)?e.jsxs("span",{className:"flex justify-end gap-2",children:[e.jsx(T,{style:{color:"green"},onClick:()=>t(s,a==null?void 0:a.receiver,"accept")}),e.jsx(Se,{style:{color:"red"},onClick:()=>t(s,a==null?void 0:a.receiver,"reject")})]}):e.jsx("span",{className:"text-right",children:e.jsx(Ie,{})}),e.jsx("span",{className:"text-[10px] pl-4 align-bottom italic",children:M(a.status!=="accepted"?a==null?void 0:a.sentAt:a==null?void 0:a.respondedAt).calendar()})]})]})}):e.jsx(e.Fragment,{})})},ns=()=>{const{user:s}=R(),{setIsNewFriendAdded:t}=_(),{getRecipient:a,recipient:i,recipientLoading:r}=D(),{respondChatRequest:l}=re(),[u,n]=c.useState(!1);c.useEffect(()=>{s&&a(s._id)},[s]);const m=async(f,h,d)=>{await l(f,h,d),await a(s._id),t(!0),n(!1)};let o=()=>{var f,h;return e.jsx(e.Fragment,{children:e.jsx("div",{className:"grid",children:r?e.jsx(H,{}):e.jsx(e.Fragment,{children:(f=i==null?void 0:i.friendRequests)!=null&&f.length?(h=i==null?void 0:i.friendRequests)==null?void 0:h.map((d,p)=>e.jsx(as,{chatReqId:d,handleRespondChatRequest:m},p)):e.jsx("div",{className:"text-center text-rose-600",children:"No Chat Requests"})})})})};return e.jsx(K,{placement:"bottomRight",title:"Chat Requests",content:o,trigger:"click",open:u,onOpenChange:()=>n(!u),children:e.jsx(Z,{className:"content-center cursor-pointer",size:"small",children:e.jsx(G,{className:"scale-75 lg:scale-100",shape:"circle",size:"default",icon:e.jsx(Re,{})})})})},rs=()=>{const{user:s,logOut:t}=R(),a=Ue(),i=s?[{label:"Logout",key:"1",icon:e.jsx(ke,{}),onClick:()=>{t()}}]:[{label:"Login",key:"1",icon:e.jsx(J,{}),onClick:()=>{a("/login")}},{label:"Register",key:"2",icon:e.jsx(J,{}),onClick:()=>{a("/register")}}];return e.jsx(e.Fragment,{children:e.jsx("div",{className:" bg-slate-700",children:e.jsxs("div",{className:"flex justify-between min-h-[8vh] lg:px-[56px] px-3 ",children:[e.jsx("div",{className:"content-center hidden cursor-pointer lg:block",children:e.jsx(Fe,{to:"/",children:"ChatApp"})}),e.jsxs("div",{className:"flex gap-1 ",children:[s&&e.jsxs("div",{className:"content-center",children:[e.jsx("span",{children:"Hi "}),e.jsx("span",{className:"italic text-amber-500",children:s==null?void 0:s.firstName}),e.jsx("span",{children:"..."})]}),e.jsx("div",{className:"content-center italic scale-125",children:"ðŸ"})]}),e.jsxs("div",{className:"flex gap-2 my-auto lg:gap-6",children:[s&&e.jsxs("div",{className:"lg:flex lg:gap-2",children:[e.jsx(ns,{}),e.jsx(ss,{})]}),e.jsx(ve,{menu:{items:i},trigger:["click"],children:e.jsx("a",{className:"content-center",onClick:r=>r.preventDefault(),children:e.jsx(Le,{})})})]})]})})})},cs=({children:s})=>{const{user:t,loading:a}=R(),i=_e();return a?e.jsx("div",{className:"h-[100vh] content-center",children:e.jsx("div",{className:"flex justify-center ",children:e.jsx(H,{size:"large"})})}):t?s:e.jsx(B,{to:"/login",state:{from:i}})};function is(){const{user:s}=R();return e.jsx(e.Fragment,{children:e.jsxs(Pe,{user:s,children:[e.jsx(rs,{}),e.jsx("div",{className:"lg:mx-[8px] mx-2",children:e.jsxs(Ae,{children:[e.jsx(q,{path:"/",element:e.jsx(cs,{children:e.jsx(Xe,{})})}),e.jsx(q,{path:"/login",element:e.jsx(Ye,{})}),e.jsx(q,{path:"/register",element:e.jsx(es,{})}),e.jsx(q,{path:"*",element:e.jsx(B,{to:"/"})})]})})]})})}fe.createRoot(document.getElementById("root")).render(e.jsx(ge.StrictMode,{children:e.jsx($e,{children:e.jsx(Ee,{basename:"/chatApp",children:e.jsx(is,{})})})}));
