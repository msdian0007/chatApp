const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/react-input-emoji-BIUyQkSU.js","assets/react-DHBI0EtI.js","assets/classnames-C9FZUsQl.js","assets/react-dom-vAgahkSm.js","assets/scheduler-CzFDRTuY.js"])))=>i.map(i=>d[i]);
import{r as l,j as e,a as ge}from"./react-DHBI0EtI.js";import{c as fe}from"./react-dom-vAgahkSm.js";import{a as je}from"./axios-B4uVmeYG.js";import{l as Ne}from"./socket.io-client-DFi9RC7o.js";import{s as O,a as ve,S as y,b as T,B as W,P as K,c as Z,A as G,T as $,D as be}from"./antd-CnrBxhLY.js";import{h as q}from"./moment-C5S46NFB.js";import{o as ye,j as Ce,p as we,q as Ie,r as D,s as H,v as Re,w as Se,x as ke,y as Le,z as V,A as Ue}from"./@ant-design-lagzWgUo.js";import{d as B,a as _e,b as Ae,e as Fe,f as M}from"./react-router-mPJ5A8eT.js";import{L as Oe,B as Ee}from"./react-router-dom-CBWY55wr.js";import"./classnames-C9FZUsQl.js";import"./scheduler-CzFDRTuY.js";import"./engine.io-client-DBBxzneW.js";import"./engine.io-parser-BiEtp6m2.js";import"./@socket.io-Dkula2eQ.js";import"./socket.io-parser-BBkuslX-.js";import"./rc-util-DRk5y4Yu.js";import"./@babel-DDXZNtFh.js";import"./rc-resize-observer-DhIh4Bln.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./rc-motion-B7bZ38Ss.js";import"./rc-overflow-DZRiDIAM.js";import"./rc-tooltip-DduOv04A.js";import"./@rc-component-Db8YWiD8.js";import"./rc-menu-DFg7V8Qr.js";import"./rc-dropdown-1QSiw7eM.js";import"./rc-field-form-BLZ5SSc5.js";import"./@ctrl-DOFZgDuz.js";import"./throttle-debounce-CUWDS_la.js";import"./rc-notification-B-HVxHmI.js";import"./rc-pagination-TIHhowL0.js";import"./rc-picker-CcREweDU.js";import"./@emotion-CW87jbl0.js";import"./stylis-DsJDcYJc.js";import"./@remix-run-BZ1VHzzA.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(const c of t)if(c.type==="childList")for(const m of c.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&i(m)}).observe(document,{childList:!0,subtree:!0});function a(t){const c={};return t.integrity&&(c.integrity=t.integrity),t.referrerPolicy&&(c.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?c.credentials="include":t.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(t){if(t.ep)return;t.ep=!0;const c=a(t);fetch(t.href,c)}})();let Q="",X="";Q="https://chatapp-5f1p.onrender.com/api",X="https://chatapp-socket-oi5c.onrender.com";const Pe=Object.freeze({server:Q,socket:X}),Y=Pe,b=je.create({baseURL:Y.server,timeout:4e4,headers:{"Content-Type":"application/json"},withCredentials:!0}),I=s=>{s.response&&s.response.data?O.error(s.response.data.message):s.message?O.error(s.message):O.error("An error occurred. Please try again.")},ee=l.createContext(null),$e=({children:s,user:n})=>{const[a,i]=l.useState(!1),[t,c]=l.useState([]),[m,r]=l.useState([]),[g,d]=l.useState([]),[h,u]=l.useState([]),[o,p]=l.useState(null),[S,j]=l.useState(!1),[_,L]=l.useState(null),[R,E]=l.useState(null),[N,ce]=l.useState(null),[ie,le]=l.useState([]),[A,F]=l.useState([]),[oe,de]=l.useState(!1),me=l.useCallback(async(f,x)=>{try{i(!0);const v=await b.post("/chats",{firstId:f,secondId:x});v.data&&(c(C=>[v.data,...C]),i(!1))}catch(v){I(v)}},[]),ue=l.useCallback(async(f,x,v,C)=>{try{const w=await b.post("/messages",{chatId:v,senderId:x,text:f});w.data&&(E(w.data),L(P=>[...P,w.data]),C(""))}catch(w){I(w)}},[]),pe=l.useCallback((f,x)=>{p(f);const v=A.map(C=>C.senderId===x?{...C,isRead:!0}:C);F(v)},[A]),he=l.useCallback(async(f,x)=>{try{const v=await b.get(`/chats/${f}/${x}`);if(v.data){p(v.data);const C=A.map(w=>w.senderId===f?{...w,isRead:!0}:w);F(C)}}catch(v){I(v)}},[A]),xe=l.useCallback(f=>{const x=f.map(v=>({...v,isRead:!0}));F(x)},[]);return l.useEffect(()=>{if(!n)return;(async()=>{try{i(!0);const x=await b.get(`/chats/${n==null?void 0:n._id}`);x.data&&(c(x.data),i(!1))}catch(x){I(x)}})()},[n]),l.useEffect(()=>{if(!n)return;(async()=>{try{r(!0);const x=await b.get(`/user/getAllFriends/${n._id}`);if(x.data){const v=x.data.filter(C=>{let w=!1;return n._id===C._id?!1:(t&&(w=t==null?void 0:t.some(P=>P.members[0]===C._id||P.members[1]===C._id)),!w)});u(x.data),d(v),r(!1)}}catch(x){r(!1),I(x)}})()},[t,oe]),l.useEffect(()=>{const f=async()=>{try{j(!0);const x=await b.get(`/messages/${o==null?void 0:o._id}`);x.data&&(L(x.data),j(!1))}catch(x){I(x)}};o&&f()},[o]),l.useEffect(()=>{const f=Ne(Y.socket);return ce(f),()=>{f.disconnect()}},[n]),l.useEffect(()=>{N===null&&!n||N.emit("addOnlineUser",n==null?void 0:n._id)},[N]),l.useEffect(()=>{if(!(N===null&&!n))return N.on("getOnlineUsers",f=>{le(f)}),()=>{N.off("getOnlineUsers")}},[N]),l.useEffect(()=>{N===null&&!n||N.emit("sendNewMessage",{recipientId:o==null?void 0:o.members.find(f=>f!==(n==null?void 0:n._id)),textMessage:R})},[R]),l.useEffect(()=>{if(!(N===null&&!n))return N.on("getNewMessage",f=>{(o==null?void 0:o._id)===f.chatId&&L(x=>[...x,f])}),N.on("sendNotification",f=>{o!=null&&o.members.find(x=>x===f.senderId)?F(x=>[{...f,isRead:!0},...x]):F(x=>[f,...x])}),()=>{N.off("getNewMessage"),N.off("sendNotification")}},[N,o]),e.jsx(e.Fragment,{children:e.jsx(ee.Provider,{value:{userChat:t,chatLoading:a,potentialChats:g,potentialChatsLoading:m,allUsers:h,createChat:me,currentChat:o,updateCurrentChat:pe,messages:_,messagesLoading:S,sendTextMessage:ue,onlineUsers:ie,notifications:A,openNewChat:he,markAllAsRead:xe,setIsNewFriendAdded:de},children:s})})},U=()=>l.useContext(ee),se=l.createContext(),Me=({children:s})=>{const[n,a]=l.useState(!0),[i,t]=l.useState(null),[c,m]=l.useState({firstName:"",lastName:"",phoneNumber:"",password:""}),[r,g]=l.useState({phoneNumber:"",password:""}),d=(j,_,L)=>{ve[j]({message:_,desc:L})},h=l.useCallback(async()=>{try{if(!c.phoneNumber&&!c.password&&!c.firstName&&!c.lastName)return d("warning","All fields required");const j=await b.post("/user/register",c);j.data&&(localStorage.setItem("userData",JSON.stringify(j.data)),t(j.data),a(!1),d("success",j.data.message))}catch(j){I(j)}},[c]),u=l.useCallback(j=>{m(j)},[]),o=l.useCallback(j=>{g(j)},[]),p=l.useCallback(()=>{localStorage.removeItem("userData"),t(null)},[]),S=l.useCallback(async()=>{try{if(!r.phoneNumber&&!r.password)return d("warning","All fields required");const j=await b.post("/user/login",r);j.data&&(localStorage.setItem("userData",JSON.stringify(j.data)),t(j.data),a(!1),d("success",j.data.message))}catch(j){I(j)}},[r]);return l.useEffect(()=>{const j=localStorage.getItem("userData");t(JSON.parse(j)),a(!1)},[]),e.jsx(e.Fragment,{children:e.jsx(se.Provider,{value:{user:i,registerInfo:c,updateRegisterInfo:u,registerUser:h,loading:n,logOut:p,logIn:S,loginInfo:r,updateLoginInfo:o},children:s})})},k=()=>l.useContext(se),z=()=>{const[s,n]=l.useState(),[a,i]=l.useState(!1),[t,c]=l.useState([]),[m,r]=l.useState(!1),[g,d]=l.useState(),[h,u]=l.useState(!1);return{recipientLoading:a,recipient:s,searchedUsersLoading:m,searchedUsers:t,recipients:g,recipientsLoading:h,setSearchedUsers:c,getRecipient:async o=>{try{i(!0);const p=await b.get(`/user/find/${o}`);p.data&&(n(p.data),i(!1))}catch{i(!1)}},getRecipients:async o=>{try{u(!0);const p=await b.post("/user/getUsersById",{recipientId:o});p.data&&(d(p.data),u(!1))}catch{u(!1)}},searchUsersByPhoneNumber:async o=>{try{r(!0);const p=await b.get(`/user/findByNumber/${o}`);p.data&&(c(p.data),r(!1))}catch{r(!1)}}}},qe=()=>e.jsx("div",{className:"user-card flex justify-between items-center p-2 cursor-pointer",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:" ",children:e.jsx(y.Avatar,{size:"large",active:!0})}),e.jsxs("div",{className:"text-content",children:[e.jsx(y.Input,{size:"small",style:{height:"14px"},block:!0,active:!0}),e.jsx(y.Input,{size:"small",style:{height:"10px"},active:!0})]})]})}),Be=()=>e.jsxs("div",{className:"flex flex-col gap-1 items-center w-6 pl-8",children:[e.jsx(y.Avatar,{active:!0}),e.jsx(y.Button,{active:!0,size:"small",style:{height:"6px"}})]}),ze=()=>e.jsx("div",{className:"chat-box content-center !bg-neutral-700 min-h-[calc(100vh-8vh)]",children:e.jsxs("div",{className:"messages pb-4 px-1 lg:px-4",children:[e.jsx(y.Input,{className:"message self !p-0 !bg-transparent",active:!0}),e.jsx(y.Input,{className:"message !p-0 !bg-transparent",active:!0}),e.jsx(y.Input,{className:"message !p-0 !bg-transparent",active:!0}),e.jsx(y.Input,{className:"message !p-0 !bg-transparent",active:!0}),e.jsx(y.Input,{className:"message !p-0 !bg-transparent",active:!0}),e.jsx(y.Input,{className:"message self !p-0 !bg-transparent",active:!0}),e.jsx(y.Input,{className:"message self !p-0 !bg-transparent",active:!0}),e.jsx(y.Input,{className:"message self !p-0 !bg-transparent",active:!0}),e.jsx(y.Input,{className:"message self !p-0 !bg-transparent",active:!0}),e.jsx(y.Input,{className:"message !p-0 !bg-transparent",active:!0})]})}),te=s=>s.filter(n=>!n.isRead),De=(s,n)=>te(s).filter(i=>i.senderId===n).length,ae=()=>{const[s,n]=l.useState(!0),[a,i]=l.useState();return{lastMessageLoading:s,lastMessage:a,getLatestMessage:async t=>{try{const c=await b.get(`/messages/latest/${t}`);c.data&&(i(c.data),n(!1))}catch(c){I(c)}},sendChatRequest:async(t,c)=>{try{const m=await b.post("/chats/sendChatRequest",{senderId:t,recipientId:c});if(m.data)return O.success("Request send successfully"),m.data}catch(m){I(m)}},respondChatRequest:async(t,c,m)=>{try{(await b.post("/chats/chatRequestResponse",{senderId:t,recipientId:c,respond:m})).data&&console.log("first")}catch(r){I(r)}}}},ne=()=>({getDpName:(s,n)=>s&&n?s.charAt(0)+n.charAt(0):s?s.charAt(0):""});function Te({chat:s,user:n,index:a,setIsChatBoxOpen:i}){const{onlineUsers:t,notifications:c,updateCurrentChat:m,messages:r}=U(),{getRecipient:g,recipient:d,recipientLoading:h}=z(),{getLatestMessage:u,lastMessage:o}=ae(),{getDpName:p}=ne(),S=De(c,d==null?void 0:d._id),j=R=>t.some(N=>N.userId===R)&&e.jsx("div",{className:"absolute bottom-0 right-0 w-3 h-3 bg-green-500 border-2 border-white rounded-full"}),_=R=>o&&(R==null?void 0:R.senderId)!==(d==null?void 0:d._id)?e.jsxs("div",{className:"flex text-[12px]",children:[e.jsx("div",{className:"pr-1 font-bold text-orange-400",children:"you:"}),e.jsx("div",{className:"truncate",children:o==null?void 0:o.text})]}):e.jsx("div",{className:"text",children:o==null?void 0:o.text}),L=()=>{m(s,d==null?void 0:d._id),i(!0)};return l.useEffect(()=>{const R=s==null?void 0:s.members.find(E=>E!==(n==null?void 0:n._id));R&&g(R)},[s]),l.useEffect(()=>{u(s==null?void 0:s._id)},[c,r]),e.jsx(e.Fragment,{children:h?e.jsx(qe,{}):e.jsxs("div",{className:"flex items-center justify-between p-2 cursor-pointer user-card",onClick:L,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative w-9 h-9",children:[e.jsx("div",{className:"content-center object-cover w-full h-full text-center rounded-full bg-slate-400",children:p((d==null?void 0:d.firstName)+" "+(d==null?void 0:d.lastName))}),j(d==null?void 0:d._id)]}),e.jsxs("div",{className:"text-content",children:[e.jsx("div",{className:"name",children:(d==null?void 0:d.firstName)+" "+(d==null?void 0:d.lastName)}),_(o)]})]}),e.jsxs("div",{className:"grid items-end text-right",children:[e.jsx("div",{className:"date !text-[12px]",children:q(o==null?void 0:o.updatedAt).calendar()}),S?e.jsx("div",{className:"flex justify-end",children:e.jsx("span",{className:"this-user-notifications",children:S})}):null]})]})})}const He=({user:s})=>{const{potentialChats:n,createChat:a,onlineUsers:i,potentialChatsLoading:t}=U(),c=r=>i.some(d=>d.userId===r)&&e.jsx("div",{className:"absolute bottom-0 right-0 w-2 h-2 bg-green-500 border-[1px] border-white rounded-full"}),m=r=>r.split(" ").map(g=>g.charAt(0).toUpperCase()).join("");return e.jsx(e.Fragment,{children:e.jsx("div",{className:"flex gap-2 overflow-x-scroll overflow-y-hidden scrollbar",children:t?e.jsx(Be,{}):n&&n.map((r,g)=>e.jsxs("div",{className:"flex flex-col items-center p-2 mb-2 border-b-2 rounded-lg cursor-pointer w-14",onClick:()=>a(s==null?void 0:s._id,r==null?void 0:r._id),children:[e.jsxs("div",{className:"relative w-7 h-7",children:[e.jsx("div",{className:"w-full h-full rounded-full object-cover text-[12px] bg-violet-600 text-center content-center",children:m((r==null?void 0:r.firstName)+" "+(r==null?void 0:r.lastName))}),c(r._id)]}),e.jsx("div",{className:"mt-1 text-[9px] text-center",children:r==null?void 0:r.firstName})]},g))})})},Ve="modulepreload",Je=function(s){return"/chatApp/"+s},J={},We=function(n,a,i){let t=Promise.resolve();if(a&&a.length>0){document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),m=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));t=Promise.all(a.map(r=>{if(r=Je(r),r in J)return;J[r]=!0;const g=r.endsWith(".css"),d=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${r}"]${d}`))return;const h=document.createElement("link");if(h.rel=g?"stylesheet":Ve,g||(h.as="script",h.crossOrigin=""),h.href=r,m&&h.setAttribute("nonce",m),document.head.appendChild(h),g)return new Promise((u,o)=>{h.addEventListener("load",u),h.addEventListener("error",()=>o(new Error(`Unable to preload CSS for ${r}`)))})}))}return t.then(()=>n()).catch(c=>{const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=c,window.dispatchEvent(m),!m.defaultPrevented)throw c})},Ke=l.lazy(()=>We(()=>import("./react-input-emoji-BIUyQkSU.js"),__vite__mapDeps([0,1,2,3,4]))),Ze=l.memo(({text:s,handleChange:n})=>e.jsx(e.Fragment,{children:e.jsx(l.Suspense,{fallback:e.jsx(T,{}),children:e.jsx(Ke,{value:s,onChange:n,fontFamily:"nunito",borderColor:"rgba(72, 112, 223, 0.2)"})})})),Ge=({user:s,setIsChatBoxOpen:n})=>{const{messages:a,messagesLoading:i,currentChat:t,sendTextMessage:c}=U(),{loading:m,recipient:r,getRecipient:g}=z(),[d,h]=l.useState(""),u=l.useRef();l.useEffect(()=>{const p=t==null?void 0:t.members.find(S=>S!==(s==null?void 0:s._id));p&&g(p)},[t]),l.useEffect(()=>{var p;(p=u.current)==null||p.scrollIntoView({behavior:"smooth"})},[a]);const o=l.useCallback(p=>{h(p)},[]);return i?e.jsx(ze,{}):t?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"chat-box relative min-h-[calc(100vh-8vh)]",children:[e.jsxs("div",{className:"chat-header !flex !justify-between",children:[e.jsx("div",{className:"pl-2 text-xl cursor-pointer lg:text-lg",onClick:()=>n(!1),children:e.jsx(ye,{})}),e.jsx("strong",{children:r==null?void 0:r.firstName}),e.jsx("span",{})]}),e.jsx("div",{className:"messages lg:pb-[46px] pt-2 pb-5 px-3 lg:px-4",children:a&&a.map((p,S)=>e.jsxs("div",{ref:u,className:`${p.senderId===(s==null?void 0:s._id)?"message self ":"message "} `,children:[e.jsx("div",{children:p.text}),e.jsx("div",{className:"message-footer",children:q(p.createdAt).calendar()})]},S))}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 flex items-center justify-between chat-input",children:[e.jsx(Ze,{text:d,handleChange:o}),e.jsx("button",{className:"items-end content-center w-8 h-8 rounded-full bg-sky-600",onClick:()=>c(d,s==null?void 0:s._id,t._id,h),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"28",height:"28",fill:"currentColor",className:"scale-75 bi bi-send",viewBox:"0 0 16 16",children:e.jsx("path",{d:"M15.854.146a.5.5 0 0 1 .11.54l-5.819 14.547a.75.75 0 0 1-1.329.124l-3.178-4.995L.643 7.184a.75.75 0 0 1 .124-1.33L15.314.037a.5.5 0 0 1 .54.11ZM6.636 10.07l2.761 4.338L14.13 2.576zm6.787-8.201L1.591 6.602l4.339 2.76z"})})})]})]})}):e.jsx("div",{className:"chat-box content-center min-h-[calc(100vh-8vh)]",children:e.jsx("div",{className:"flex justify-center ",children:"...No conversation selected"})})},Qe=({u:s,handleChatRequest:n})=>{const{getDpName:a}=ne();return e.jsxs("div",{className:"flex items-center justify-between p-2 cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"relative w-9 h-9",children:e.jsx("div",{className:"content-center object-cover w-full h-full text-center rounded-full bg-slate-400",children:a(s==null?void 0:s.firstName,s==null?void 0:s.lastName)})}),e.jsx("div",{className:"text-content",children:e.jsx("div",{className:"name",children:(s==null?void 0:s.firstName)+" "+(s==null?void 0:s.lastName)})})]}),e.jsx("div",{onClick:()=>n(s==null?void 0:s._id),className:"grid items-end content-center px-2 text-sm text-right bg-orange-600 rounded-md cursor-pointer hover:bg-orange-700 ",children:"Chat Request"})]})},Xe=()=>{const[s,n]=l.useState(""),{searchedUsersLoading:a,searchedUsers:i,setSearchedUsers:t,searchUsersByPhoneNumber:c}=z(),{sendChatRequest:m}=ae(),{user:r}=k(),g=()=>{s&&c(s)},d=async h=>{if((r==null?void 0:r._id)===h)return O.warning("Abey saale ðŸ™‚");await m(r==null?void 0:r._id,h),t([]),n("")};return e.jsx("div",{className:"max-w-[400px] text-center ",children:e.jsxs("div",{className:"relative w-3/4 mx-auto",children:[e.jsx("input",{type:"number",placeholder:"search friends...",className:"w-full px-3 py-1 text-sm rounded-md bg-black/45",value:s,onChange:h=>n(h.target.value)}),e.jsx("div",{className:"absolute content-center px-4 bg-orange-600 rounded-md hover:bg-orange-700 bottom-1 top-1 right-2",children:a?e.jsx(Ce,{}):e.jsx(we,{className:"cursor-pointer",onClick:g})}),a?e.jsx(e.Fragment,{}):(i==null?void 0:i.length)>0&&e.jsx("div",{className:"absolute w-full py-2 mt-4 border rounded-md border-black/35 bg-black/55",children:i==null?void 0:i.map((h,u)=>e.jsx(Qe,{u:h,handleChatRequest:d},u))})]})})},Ye=()=>{const{userChat:s,chatLoading:n}=U(),{user:a}=k(),[i,t]=l.useState(!1);return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-8",children:[e.jsxs("div",{className:`${i?"hidden lg:block col-span-3":"lg:col-span-3 col-span-8"} "px-3 my-2 border-r-2"`,children:[e.jsx(Xe,{}),e.jsx(He,{user:a}),e.jsx("div",{children:!n&&s.map((c,m)=>e.jsx("div",{children:e.jsx(Te,{chat:c,user:a,index:m,setIsChatBoxOpen:t})},m))})]}),e.jsx("div",{className:`${i?"lg:col-span-5 col-span-8":"hidden lg:block"} col-span-5 lg:pl-2`,children:e.jsx(Ge,{user:a,setIsChatBoxOpen:t})})]})})},es=()=>{const{logIn:s,user:n,updateLoginInfo:a,loginInfo:i}=k(),[t,c]=l.useState(!1);return e.jsxs(e.Fragment,{children:[n?e.jsx(B,{to:"/"}):null,e.jsx("div",{className:"flex justify-center min-h-[calc(100vh-10vh)]",children:e.jsxs("div",{className:"grid grid-cols-4 my-auto ",children:[e.jsxs("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-2",children:[e.jsx("label",{htmlFor:"",children:"Mobile Number"}),e.jsx("input",{type:"number",className:"px-2 py-1 rounded-md bg-neutral-600",onChange:m=>a({...i,phoneNumber:m.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-4",children:[e.jsx("label",{htmlFor:"",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:`${t?"text":"password"}`,className:"px-2 py-1 rounded-md bg-neutral-600",onChange:m=>a({...i,password:m.target.value})}),e.jsx("span",{className:"absolute cursor-pointer right-2 top-1",onClick:()=>c(!t),children:"ðŸ‘"})]})]}),e.jsx("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-2",children:e.jsx("button",{onClick:s,className:"px-2 py-1 bg-blue-600 rounded-md",children:"Log In"})})]})})]})},ss=()=>{const{registerInfo:s,user:n,updateRegisterInfo:a,registerUser:i,loading:t}=k(),[c,m]=l.useState(!1);return e.jsxs(e.Fragment,{children:[n?e.jsx(B,{to:"/"}):null,e.jsx("form",{action:"",children:e.jsx("div",{className:"flex justify-center min-h-[calc(100vh-10vh)]",children:e.jsxs("div",{className:"grid grid-cols-4 my-auto ",children:[e.jsxs("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-2",children:[e.jsx("label",{htmlFor:"",children:"First Name"}),e.jsx("input",{type:"text",className:"px-2 py-1 rounded-md bg-neutral-600",onChange:r=>a({...s,firstName:r.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-2",children:[e.jsx("label",{htmlFor:"",children:"Last Name"}),e.jsx("input",{type:"text",className:"px-2 py-1 rounded-md bg-neutral-600",onChange:r=>a({...s,lastName:r.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-2",children:[e.jsx("label",{htmlFor:"",children:"PhoneNumber"}),e.jsx("input",{type:"number",className:"px-2 py-1 rounded-md bg-neutral-600",onChange:r=>a({...s,phoneNumber:r.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-4",children:[e.jsx("label",{htmlFor:"",children:"Create Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:`${c?"text":"password"}`,className:"px-2 py-1 rounded-md bg-neutral-600",onChange:r=>a({...s,password:r.target.value})}),e.jsx("span",{className:"absolute cursor-pointer right-2 top-1",onClick:()=>m(!c),children:"ðŸ‘"})]})]}),e.jsx("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-2",children:e.jsx(W,{onClick:i,type:"primary",loading:t,iconPosition:"end",children:"Sign Up"})})]})})})]})},ts=()=>{const{user:s}=k(),{notifications:n,allUsers:a,openNewChat:i,markAllAsRead:t}=U(),[c,m]=l.useState(!1),r=te(n),g=n.map(u=>{let o=a.find(p=>p._id===u.senderId);return{...u,senderName:o==null?void 0:o.firstName}}),d=(u,o)=>{i(u,o),m(!1)};let h=()=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid",children:[g!=null&&g.length?g.map((u,o)=>e.jsxs("div",{className:`${u.isRead?" text-black/30":"text-black"} border-slate-300 cursor-pointer border-b-[1px] p-1`,onClick:()=>d(u==null?void 0:u.senderId,s==null?void 0:s._id),children:[e.jsx("span",{className:"font-bold ",children:u==null?void 0:u.senderName}),e.jsx("span",{children:" sent a message"}),e.jsx("span",{className:"text-[10px] pl-4 align-bottom italic",children:q(u==null?void 0:u.date).calendar()})]},o)):e.jsx("div",{className:"text-center text-rose-600",children:"Empty"}),(g==null?void 0:g.length)>1?e.jsx("div",{className:"flex justify-end pt-3",children:e.jsx(W,{className:"text-[12px]",size:"small",type:"default",onClick:()=>t(g),children:"Mark all as read"})}):null]})});return e.jsx(e.Fragment,{children:e.jsx(K,{placement:"bottomRight",title:"Unread Notifications",content:h,trigger:"click",open:c,onOpenChange:()=>m(!c),children:e.jsx(Z,{className:"content-center cursor-pointer",size:"small",count:r==null?void 0:r.length,children:e.jsx(G,{className:"scale-75 lg:scale-100",shape:"circle",size:"default",icon:e.jsx(Ie,{})})})})})},re=()=>{const[s,n]=l.useState();return{chatRequest:s,sendChatRequest:async(a,i)=>{try{if((await b.post("/chats/sendChatRequest",{senderId:a,recipientId:i})).data)return!0}catch(t){console.log(t),I(t)}},getChatRequestById:async a=>{try{const i=await b.get(`/chats/getChatRequest/${a}`);if(i.data)return n(i.data[0]),!0}catch(i){console.log(i)}},respondChatRequest:async(a,i,t)=>{try{(await b.post("/chats/chatRequestResponse",{chatReqId:a,recipientId:i,respond:t})).data}catch(c){console.log(c)}}}},as=(s,n)=>{const{sender_details:a,receiver_details:i}=s;return s.sender===n?e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-orange-600",children:i.firstName+" "+i.lastName+" "}),s.status==="accepted"?e.jsx($,{color:"success",icon:e.jsx(D,{}),children:"accepted"}):e.jsx($,{color:"default",icon:e.jsx(H,{}),children:"pending"})]}),e.jsx("span",{children:i.phoneNumber})]}):e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-orange-600",children:a.firstName+" "+a.lastName+" "}),s.status==="accepted"?e.jsx($,{color:"success",icon:e.jsx(D,{}),children:"friendzz"}):e.jsx($,{color:"default",icon:e.jsx(H,{}),children:"pending"})]}),e.jsx("span",{children:a.phoneNumber})]})},ns=({chatReqId:s,handleRespondChatRequest:n})=>{const{chatRequest:a,getChatRequestById:i}=re(),{user:t}=k();return l.useEffect(()=>{i(s)},[s]),e.jsx(e.Fragment,{children:a?e.jsx("div",{children:e.jsxs("div",{className:"border-slate-300 cursor-pointer border-b-[1px] p-1 flex justify-between",children:[as(a,t==null?void 0:t._id),e.jsxs("div",{className:"flex flex-col text-lg text-right",children:[a.status!=="accepted"&&a.sender!==(t==null?void 0:t._id)?e.jsxs("span",{className:"flex justify-end gap-2",children:[e.jsx(D,{style:{color:"green"},onClick:()=>n(s,a==null?void 0:a.receiver,"accept")}),e.jsx(Re,{style:{color:"red"},onClick:()=>n(s,a==null?void 0:a.receiver,"reject")})]}):e.jsx("span",{className:"text-right",children:e.jsx(Se,{})}),e.jsx("span",{className:"text-[10px] pl-4 align-bottom italic",children:q(a.status!=="accepted"?a==null?void 0:a.sentAt:a==null?void 0:a.respondedAt).calendar()})]})]})}):e.jsx(e.Fragment,{})})},rs=()=>{const{user:s}=k(),{setIsNewFriendAdded:n}=U(),{getRecipient:a,recipient:i,recipientLoading:t}=z(),{respondChatRequest:c}=re(),[m,r]=l.useState(!1);l.useEffect(()=>{s&&a(s._id)},[s]);const g=async(h,u,o)=>{await c(h,u,o),await a(s._id),n(!0),r(!1)};console.log(t);let d=()=>{var h,u;return e.jsx(e.Fragment,{children:e.jsx("div",{className:"grid",children:t?e.jsx(T,{}):e.jsx(e.Fragment,{children:(h=i==null?void 0:i.friendRequests)!=null&&h.length?(u=i==null?void 0:i.friendRequests)==null?void 0:u.map((o,p)=>e.jsx(ns,{chatReqId:o,handleRespondChatRequest:g},p)):e.jsx("div",{className:"text-center text-rose-600",children:"No Chat Requests"})})})})};return e.jsx(K,{placement:"bottomRight",title:"Chat Requests",content:d,trigger:"click",open:m,onOpenChange:()=>r(!m),children:e.jsx(Z,{className:"content-center cursor-pointer",size:"small",children:e.jsx(G,{className:"scale-75 lg:scale-100",shape:"circle",size:"default",icon:e.jsx(ke,{})})})})},cs=()=>{const{user:s,logOut:n}=k(),a=_e(),i=s?[{label:"Logout",key:"1",icon:e.jsx(Ue,{}),onClick:()=>{n()}}]:[{label:"Login",key:"1",icon:e.jsx(V,{}),onClick:()=>{a("/login")}},{label:"Register",key:"2",icon:e.jsx(V,{}),onClick:()=>{a("/register")}}];return e.jsx(e.Fragment,{children:e.jsx("div",{className:" bg-slate-700",children:e.jsxs("div",{className:"flex justify-between min-h-[8vh] lg:px-[56px] px-3 ",children:[e.jsx("div",{className:"content-center hidden cursor-pointer lg:block",children:e.jsx(Oe,{to:"/",children:"ChatApp"})}),e.jsxs("div",{className:"flex gap-1 ",children:[e.jsx("div",{className:"content-center italic scale-125",children:"ðŸ"}),s&&e.jsxs("div",{className:"content-center",children:[e.jsx("span",{children:"Hi "}),e.jsx("span",{className:"italic text-amber-500",children:s==null?void 0:s.firstName})]})]}),e.jsxs("div",{className:"flex gap-2 my-auto lg:gap-6",children:[e.jsxs("div",{className:"lg:flex lg:gap-2",children:[e.jsx(rs,{}),e.jsx(ts,{})]}),e.jsx(be,{menu:{items:i},trigger:["click"],children:e.jsx("a",{className:"content-center",onClick:t=>t.preventDefault(),children:e.jsx(Le,{})})})]})]})})})},is=({children:s})=>{const{user:n,loading:a}=k(),i=Ae();return a?e.jsx("div",{className:"h-[100vh] content-center",children:e.jsx("div",{className:"flex justify-center ",children:e.jsx(T,{size:"large"})})}):n?s:e.jsx(B,{to:"/login",state:{from:i}})};function ls(){const{user:s}=k();return e.jsx(e.Fragment,{children:e.jsxs($e,{user:s,children:[e.jsx(cs,{}),e.jsx("div",{className:"lg:px-[46px]",children:e.jsxs(Fe,{children:[e.jsx(M,{path:"/",element:e.jsx(is,{children:e.jsx(Ye,{})})}),e.jsx(M,{path:"/login",element:e.jsx(es,{})}),e.jsx(M,{path:"/register",element:e.jsx(ss,{})}),e.jsx(M,{path:"*",element:e.jsx(B,{to:"/"})})]})})]})})}fe.createRoot(document.getElementById("root")).render(e.jsx(ge.StrictMode,{children:e.jsx(Me,{children:e.jsx(Ee,{basename:"/chatApp",children:e.jsx(ls,{})})})}));
