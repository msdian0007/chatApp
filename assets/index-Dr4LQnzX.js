const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/react-input-emoji-Cu9SFRxT.js","assets/react-CeYxiRmC.js","assets/classnames-BK5ccKcQ.js","assets/react-dom-L6ckZpNh.js","assets/scheduler-CzFDRTuY.js"])))=>i.map(i=>d[i]);
import{r as n,j as e,a as ee}from"./react-CeYxiRmC.js";import{c as Ie}from"./react-dom-L6ckZpNh.js";import{a as Re}from"./axios-B4uVmeYG.js";import{l as Se}from"./socket.io-client-DFi9RC7o.js";import{s as A,S as C,T as q,a as D,B as z,P as se,b as te,A as ae,D as Le}from"./antd-DX7iLIV5.js";import"./lodash-HeGfwtQs.js";import{o as Q,p as G,q as ke,r as Ae,j as _e,s as Ue,v as Fe,w as Ee,x as Oe,y as Pe,z as $e,A as Y,B as Be}from"./@ant-design-CUO8SR3S.js";import{h as M}from"./moment-C5S46NFB.js";import{d as V,a as qe,b as Te,e as De,f as T}from"./react-router-QIltWwfG.js";import{L as ze,B as Me}from"./react-router-dom-CUHzREDP.js";import"./classnames-BK5ccKcQ.js";import"./scheduler-CzFDRTuY.js";import"./engine.io-client-DBBxzneW.js";import"./engine.io-parser-BiEtp6m2.js";import"./@socket.io-Dkula2eQ.js";import"./socket.io-parser-BBkuslX-.js";import"./rc-util-CAVnL4d-.js";import"./@babel-DDXZNtFh.js";import"./rc-resize-observer-kpEHs-IX.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./rc-motion-5BJBPEuh.js";import"./rc-overflow-C8ABnMaX.js";import"./rc-tooltip-BHn6b4Tb.js";import"./@rc-component-Qn-Q4kZs.js";import"./rc-menu-CZr1075Q.js";import"./rc-dropdown-DgbUuC76.js";import"./rc-field-form-DA1K7XIi.js";import"./@ctrl-DOFZgDuz.js";import"./throttle-debounce-CUWDS_la.js";import"./rc-notification-BCmMwy-O.js";import"./rc-pagination-Cq_6YqMC.js";import"./rc-picker-DM5vM1RW.js";import"./@emotion-CW87jbl0.js";import"./stylis-DsJDcYJc.js";import"./@remix-run-BZ1VHzzA.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function c(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(i){if(i.ep)return;i.ep=!0;const o=c(i);fetch(i.href,o)}})();let ne="",re="";ne="https://chatapp-5f1p.onrender.com/api",re="https://chatapp-socket-oi5c.onrender.com";const Ve=Object.freeze({server:ne,socket:re}),oe=Ve,b=Re.create({baseURL:oe.server,timeout:4e4,headers:{"Content-Type":"application/json"}}),w=s=>{s.response&&s.response.data?A.error(s.response.data.message):s.message?A.error(s.message):A.error("An error occurred. Please try again.")},Je="/chatApp/assets/sendChatText-BBkJDNT7.mp3",He="/chatApp/assets/receivedChatText-CUg_h8vX.mp3",We="/chatApp/assets/receivedUnreadText-FvxPMJ05.mp3",ce=s=>s.filter(t=>!t.isRead),Ke=(s,t)=>ce(s).filter(a=>a.senderId===t).length,K=s=>{try{let t;return s==="SEND"?t=new Audio(Je):s==="RECV"?t=new Audio(He):s==="UN"&&(t=new Audio(We)),t.play()}catch(t){console.log("Failed to play sound:",t)}},J=()=>({getDpName:(s,t)=>s&&t?s.charAt(0)+t.charAt(0):s?s.charAt(0):"",getLatestChatOnTop:s=>s.sort((c,a)=>{let i=new Date(c.updatedAt);return new Date(a.updatedAt)-i}),getLatestChatOnTopByChatId:(s,t)=>{var a;if(console.log(s),!s||((a=s[0])==null?void 0:a._id)===t)return 0;const c=s==null?void 0:s.filter(i=>i._id!==t);return c==null||c.unshift(s.find(i=>i._id===t)),c}}),ie=n.createContext(null),Qe=({children:s,user:t})=>{const{getLatestChatOnTopByChatId:c,getLatestChatOnTop:a}=J(),[i,o]=n.useState(!1),[l,r]=n.useState([]),[m,u]=n.useState([]),[p,d]=n.useState(!1),[h,x]=n.useState([]),[S,_]=n.useState([]),[g,L]=n.useState(null),[v,O]=n.useState(!1),[F,B]=n.useState(null),[X,pe]=n.useState(null),[y,xe]=n.useState(null),[ge,fe]=n.useState([]),[P,$]=n.useState([]),[je,Ne]=n.useState(!1),ve=n.useCallback(async(j,f)=>{try{o(!0);const N=await b.post("/chats",{firstId:j,secondId:f});N.data&&(r(I=>[N.data,...I]),o(!1))}catch(N){w(N)}},[]),be=n.useCallback(async(j,f,N,I,U)=>{try{if(!j)return;let k=F;k=[...k,{text:j,createdAt:new Date,senderId:f}],B(k),K("SEND"),U("");const W=await b.post("/messages/sendMessage",{chatId:I,senderId:f,text:j});W.data&&(pe(W.data),k.pop(),B(()=>[...k,W.data]))}catch(k){w(k)}},[F]),ye=n.useCallback((j,f)=>{L(j);const N=P.map(I=>I.senderId===f?{...I,isRead:!0}:I);$(N)},[P]),Ce=n.useCallback(async(j,f)=>{try{const N=await b.get(`/chats/${j}/${f}`);if(N.data){L(N.data);const I=P.map(U=>U.senderId===j?{...U,isRead:!0}:U);$(I)}}catch(N){w(N)}},[P]),we=n.useCallback(j=>{const f=j.map(N=>({...N,isRead:!0}));$(f)},[]);return n.useEffect(()=>{if(!t)return;(async()=>{try{o(!0);const f=await b.get(`/chats/${t==null?void 0:t._id}`);if(f.data){const N=a(f.data);r(N),o(!1)}}catch(f){w(f)}})()},[t]),n.useEffect(()=>{u(l)},[l]),n.useEffect(()=>{if(!t)return;(async()=>{try{d(!0);const f=await b.get(`/user/getAllFriends/${t._id}`);if(f.data){const N=f.data.filter(I=>{let U=!1;return t._id===I._id?!1:(l&&(U=l==null?void 0:l.some(k=>k.members[0]===I._id||k.members[1]===I._id)),!U)});_(f.data),x(N),d(!1)}}catch(f){d(!1),w(f)}})()},[l,je]),n.useEffect(()=>{const j=async()=>{try{O(!0);const N=await b.get(`/messages/${g==null?void 0:g._id}`);N.data&&(B(N.data),O(!1))}catch(N){w(N)}},f=async()=>{try{await b.post("/chats/markMessagesAsRead",{chatId:g==null?void 0:g._id,userId:t==null?void 0:t._id})}catch(N){w(N)}};g&&(j(),f())},[g]),n.useEffect(()=>{const j=Se(oe.socket);return xe(j),()=>{j.disconnect()}},[t]),n.useEffect(()=>{y===null&&!t||y.emit("addOnlineUser",t==null?void 0:t._id)},[y]),n.useEffect(()=>{if(!(y===null&&!t))return y.on("getOnlineUsers",j=>{fe(j)}),()=>{y.off("getOnlineUsers")}},[y]),n.useEffect(()=>{y===null&&!t||y.emit("sendNewMessage",{recipientId:g==null?void 0:g.members.find(j=>j!==(t==null?void 0:t._id)),textMessage:X})},[X]),n.useEffect(()=>{if(!(y===null&&!t))return y.on("getNewMessage",j=>{(g==null?void 0:g._id)===j.chatId&&B(N=>[...N,j]);const f=c(m,j.chatId);f&&u(f)}),y.on("sendNotification",j=>{g!=null&&g.members.find(f=>f===j.senderId)?($(f=>[{...j,isRead:!0},...f]),K("RECV")):($(f=>[j,...f]),K("UN"))}),()=>{y.off("getNewMessage"),y.off("sendNotification")}},[y,g,m]),e.jsx(e.Fragment,{children:e.jsx(ie.Provider,{value:{userChat:l,chatList:m,chatLoading:i,potentialChats:h,potentialChatsLoading:p,allUsers:S,createChat:ve,currentChat:g,updateCurrentChat:ye,messages:F,messagesLoading:v,sendTextMessage:be,onlineUsers:ge,notifications:P,openNewChat:Ce,markAllAsRead:we,setIsNewFriendAdded:Ne},children:s})})},E=()=>n.useContext(ie),Xe=()=>e.jsx("div",{className:"flex items-center justify-between p-2 cursor-pointer user-card",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"",children:e.jsx(C.Avatar,{size:"large",active:!0})}),e.jsxs("div",{className:"text-content",children:[e.jsx(C.Input,{size:"small",style:{height:"14px"},block:!0,active:!0}),e.jsx(C.Input,{size:"small",style:{height:"10px"},active:!0})]})]})}),Ge=()=>e.jsxs("div",{className:"flex flex-col items-center content-center w-6 gap-2 pl-6 ",children:[e.jsx(C.Avatar,{active:!0,size:"large"}),e.jsx(C.Button,{active:!0,size:"default",style:{height:"6px"}})]}),Ye=()=>e.jsx("div",{className:"chat-box content-center !bg-neutral-700 min-h-[calc(100vh-8vh)]",children:e.jsxs("div",{className:"px-1 pb-4 messages lg:px-4",children:[e.jsx(C.Input,{className:"message self !p-0 !bg-transparent",active:!0}),e.jsx(C.Input,{className:"message !p-0 !bg-transparent",active:!0}),e.jsx(C.Input,{className:"message !p-0 !bg-transparent",active:!0}),e.jsx(C.Input,{className:"message !p-0 !bg-transparent",active:!0}),e.jsx(C.Input,{className:"message !p-0 !bg-transparent",active:!0}),e.jsx(C.Input,{className:"message self !p-0 !bg-transparent",active:!0}),e.jsx(C.Input,{className:"message self !p-0 !bg-transparent",active:!0}),e.jsx(C.Input,{className:"message self !p-0 !bg-transparent",active:!0}),e.jsx(C.Input,{className:"message self !p-0 !bg-transparent",active:!0}),e.jsx(C.Input,{className:"message !p-0 !bg-transparent",active:!0})]})}),le=n.createContext(),Ze=({children:s})=>{const[t,c]=n.useState(!0),[a,i]=n.useState(!1),[o,l]=n.useState(null),[r,m]=n.useState(!1),[u,p]=n.useState({firstName:"",lastName:"",phoneNumber:"",password:""}),[d,h]=n.useState({phoneNumber:"",password:""}),x=n.useCallback(async()=>{try{if(!u.phoneNumber&&!u.password&&!u.firstName&&!u.lastName)return A.warning("All fields required");m(!0);const v=await b.post("/user/register",u);v.data&&(localStorage.setItem("userData",JSON.stringify(v.data)),l(v.data),m(!1),A.success(v.data.message))}catch(v){m(!1),w(v)}},[u]),S=n.useCallback(v=>{p(v)},[]),_=n.useCallback(v=>{h(v)},[]),g=n.useCallback(()=>{localStorage.removeItem("userData"),l(null)},[]),L=n.useCallback(async()=>{try{if(!d.phoneNumber&&!d.password)return A.success("All fields required");i(!0);const v=await b.post("/user/login",d);v.data&&(localStorage.setItem("userData",JSON.stringify(v.data)),l(v.data),i(!1),A.success(v.data.message))}catch(v){i(!1),w(v)}},[d]);return n.useEffect(()=>{const v=localStorage.getItem("userData");l(JSON.parse(v)),c(!1)},[]),e.jsx(e.Fragment,{children:e.jsx(le.Provider,{value:{user:o,registerInfo:u,updateRegisterInfo:S,registerLoading:r,registerUser:x,loading:t,logOut:g,logIn:L,loginLoading:a,loginInfo:d,updateLoginInfo:_},children:s})})},R=()=>n.useContext(le),es=(s,t)=>{const{sender_details:c,receiver_details:a}=s;return s.sender===t?e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-orange-600",children:a.firstName+" "+a.lastName+" "}),s.status==="accepted"?e.jsx(q,{color:"success",icon:e.jsx(Q,{}),children:"accepted"}):e.jsx(q,{color:"default",icon:e.jsx(G,{}),children:"pending"})]}),e.jsx("span",{children:a.phoneNumber})]}):e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-orange-600",children:c.firstName+" "+c.lastName+" "}),s.status==="accepted"?e.jsx(q,{color:"success",icon:e.jsx(Q,{}),children:"friendzz"}):e.jsx(q,{color:"default",icon:e.jsx(G,{}),children:"pending"})]}),e.jsx("span",{children:c.phoneNumber})]})},ss=(s,t)=>{let c=0;return c=typeof s=="number"?s:0,c+=t,c?e.jsx("div",{className:"flex justify-end",children:e.jsx("span",{className:"this-user-notifications",children:c})}):null},ts=(s,t)=>s&&(s==null?void 0:s.senderId)!==(t==null?void 0:t._id)?e.jsxs("div",{className:"flex text-[12px]",children:[e.jsx("div",{className:"pr-1 font-bold text-orange-400",children:"you:"}),e.jsx("div",{className:"truncate",children:s==null?void 0:s.text})]}):e.jsx("div",{className:"text",children:s==null?void 0:s.text}),de=(s,t)=>t.some(a=>a.userId===s)&&e.jsx("div",{className:"absolute bottom-0 right-0 w-3 h-3 bg-green-500 border-2 border-white rounded-full"}),me=ee.memo(()=>{const{potentialChats:s,createChat:t,onlineUsers:c,potentialChatsLoading:a}=E(),{user:i}=R(),{getDpName:o}=J();return e.jsx(e.Fragment,{children:e.jsx("div",{className:"flex justify-around gap-4 overflow-x-scroll overflow-y-hidden shadow-lg md:gap-14 scrollbar ",children:a?[1,2,3,4,5].map((l,r)=>e.jsx(Ge,{},r)):s&&s.map((l,r)=>e.jsxs("div",{className:"flex flex-col items-center p-2 rounded-lg cursor-pointer w-14",onClick:()=>t(i==null?void 0:i._id,l==null?void 0:l._id),children:[e.jsxs("div",{className:"relative w-9 h-9",children:[e.jsx("div",{className:"w-full h-full rounded-full object-cover text-[12px] bg-violet-600 text-center content-center",children:o(l==null?void 0:l.firstName,l==null?void 0:l.lastName)}),de(l._id,c)]}),e.jsx("div",{className:"mt-1 text-[10px] text-center",children:l==null?void 0:l.firstName})]},r))})})});me.displayName="PotentialChats";const H=()=>{const[s,t]=n.useState(),[c,a]=n.useState(!1),[i,o]=n.useState([]),[l,r]=n.useState(!1),[m,u]=n.useState(),[p,d]=n.useState(!1);return{recipientLoading:c,recipient:s,searchedUsersLoading:l,searchedUsers:i,recipients:m,recipientsLoading:p,setSearchedUsers:o,getRecipient:async h=>{try{a(!0);const x=await b.get(`/user/find/${h}`);x.data&&(t(x.data),a(!1))}catch{a(!1)}},getRecipients:async h=>{try{d(!0);const x=await b.post("/user/getUsersById",{recipientId:h});x.data&&(u(x.data),d(!1))}catch{d(!1)}},searchUsersByPhoneNumber:async h=>{try{r(!0);const x=await b.get(`/user/findByNumber/${h}`);x.data&&(o(x.data),r(!1))}catch{r(!1)}}}},as="modulepreload",ns=function(s){return"/chatApp/"+s},Z={},rs=function(t,c,a){let i=Promise.resolve();if(c&&c.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));i=Promise.all(c.map(r=>{if(r=ns(r),r in Z)return;Z[r]=!0;const m=r.endsWith(".css"),u=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${r}"]${u}`))return;const p=document.createElement("link");if(p.rel=m?"stylesheet":as,m||(p.as="script",p.crossOrigin=""),p.href=r,l&&p.setAttribute("nonce",l),document.head.appendChild(p),m)return new Promise((d,h)=>{p.addEventListener("load",d),p.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${r}`)))})}))}return i.then(()=>t()).catch(o=>{const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o})},os=n.lazy(()=>rs(()=>import("./react-input-emoji-Cu9SFRxT.js"),__vite__mapDeps([0,1,2,3,4]))),cs=n.memo(({text:s,handleChange:t})=>e.jsx(e.Fragment,{children:e.jsx(n.Suspense,{fallback:e.jsx(D,{}),children:e.jsx(os,{value:s,onChange:t,fontFamily:"nunito",borderColor:"rgba(72, 112, 223, 0.2)"})})})),is="/chatApp/assets/Chat-amico-BTnA9QnS.png",ls=({setIsChatBoxOpen:s})=>{const{messages:t,messagesLoading:c,currentChat:a,sendTextMessage:i,updateCurrentChat:o}=E(),{loading:l,recipient:r,getRecipient:m}=H(),[u,p]=n.useState(""),d=n.useRef(),{user:h}=R(),x=a==null?void 0:a.members.find(g=>g!==(h==null?void 0:h._id));n.useEffect(()=>{x&&m(x)},[a]),n.useEffect(()=>{var g;(g=d.current)==null||g.scrollIntoView({behavior:"smooth"})},[t]);const S=n.useCallback(g=>{p(g)},[]),_=()=>{o(null,null),s(!1)};return c?e.jsx(Ye,{}):a?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"chat-box relative min-h-[calc(100vh-9vh)]",children:[e.jsxs("div",{className:"chat-header min-h-[6vh] !flex !justify-between",children:[e.jsx("div",{className:"ml-6 text-xl cursor-pointer lg:text-lg",onClick:_,children:e.jsx(ke,{})}),e.jsx("strong",{children:r==null?void 0:r.firstName}),e.jsx("span",{})]}),e.jsx("div",{className:"px-2 pt-2 messages pb-[10vh]",children:t&&t.map((g,L)=>e.jsxs("div",{ref:d,className:`${g.senderId===(h==null?void 0:h._id)?"message self ":"message "} `,children:[e.jsx("div",{children:g.text}),e.jsx("div",{className:"message-footer",children:M(g.createdAt).calendar()})]},L))}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 flex items-center max-h-[10vh] justify-between chat-input",children:[e.jsx(cs,{text:u,handleChange:S}),e.jsx(Ae,{className:"content-center px-4 py-3 text-xl bg-blue-600 rounded-full",onClick:()=>i(u,h==null?void 0:h._id,x,a._id,p)})]})]})}):e.jsx("div",{className:"chat-box content-center min-h-[calc(100vh-12vh)]",children:e.jsx("div",{className:"flex justify-center ",children:e.jsx("img",{className:"max-w-md",src:is})})})},ds=({u:s,handleChatRequest:t,chatReqLoading:c})=>{const{getDpName:a}=J();return e.jsxs("div",{className:"flex items-center justify-between p-2 cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"relative w-9 h-9",children:e.jsx("div",{className:"content-center object-cover w-full h-full text-center rounded-full bg-slate-400",children:a(s==null?void 0:s.firstName,s==null?void 0:s.lastName)})}),e.jsx("div",{className:"text-content",children:e.jsx("div",{className:"name",children:(s==null?void 0:s.firstName)+" "+(s==null?void 0:s.lastName)})})]}),e.jsx(z,{loading:c,onClick:()=>t(s==null?void 0:s._id),className:"content-center px-2 py-1 text-right ",children:"Chat Request"})]})},ue=()=>{const[s,t]=n.useState(!1),[c,a]=n.useState(!0),[i,o]=n.useState(),[l,r]=n.useState(null);return{lastMessageLoading:c,lastMessage:i,chatReqLoading:s,chatInfo:l,getChatInfo:async m=>{try{const u=await b.get(`/chats/getChatInfo/${m}`);u.data&&r(u.data)}catch(u){w(u)}},getLatestMessage:async m=>{try{const u=await b.get(`/messages/latest/${m}`);u.data&&(o(u.data),a(!1))}catch(u){w(u)}},sendChatRequest:async(m,u)=>{try{t(!0);const p=await b.post("/chats/sendChatRequest",{senderId:m,recipientId:u});if(p.data)return A.success("Request send successfully"),t(!1),p.data}catch(p){t(!1),w(p)}},respondChatRequest:async(m,u,p)=>{try{(await b.post("/chats/chatRequestResponse",{senderId:m,recipientId:u,respond:p})).data}catch(d){w(d)}}}},ms=({setIsSearching:s,isSearching:t})=>{const{searchedUsersLoading:c,searchedUsers:a,setSearchedUsers:i,searchUsersByPhoneNumber:o}=H(),{sendChatRequest:l,chatReqLoading:r}=ue(),{user:m}=R(),[u,p]=n.useState(""),d=()=>{u&&o(u)},h=async x=>{if((m==null?void 0:m._id)===x)return A.warning("Abey saale 🙂");await l(m==null?void 0:m._id,x),i([]),p("")};return n.useEffect(()=>{i([]),p("")},[t]),e.jsx("div",{className:"mt-2 text-center ",children:e.jsxs("div",{className:"relative mx-2 ",children:[e.jsx("input",{type:"number",placeholder:"search friends...",className:"z-30 w-full h-10 px-3 py-1 text-sm rounded-md lg:h-8 bg-black/45",value:u,onChange:x=>p(x.target.value),onClick:()=>s(1)}),e.jsx("div",{className:"absolute content-center px-4 bg-orange-600 rounded-md hover:bg-orange-700 bottom-1 top-1 right-2",children:c?e.jsx(_e,{}):e.jsx(Ue,{className:"flex my-auto cursor-pointer",onClick:d})}),c?e.jsx(e.Fragment,{}):(a==null?void 0:a.length)>0&&e.jsx("div",{className:"absolute z-20 w-full py-2 mt-4 bg-gray-700 border rounded-md border-black/35",children:a==null?void 0:a.map((x,S)=>e.jsx(ds,{u:x,handleChatRequest:h,chatReqLoading:r},S))})]})})};function us({chat:s,setIsChatBoxOpen:t}){const{onlineUsers:c,notifications:a,updateCurrentChat:i,messages:o}=E(),{getRecipient:l,recipient:r,recipientLoading:m}=H(),{getLatestMessage:u,lastMessage:p}=ue(),{getDpName:d}=J(),{user:h}=R(),x=Ke(a,r==null?void 0:r._id),[S,_]=n.useState(0),g=()=>{i(s,r==null?void 0:r._id),t(!0),_(0)};return n.useEffect(()=>{var O;const L=s==null?void 0:s.members.find(F=>F!==(h==null?void 0:h._id)),v=(O=s==null?void 0:s.unreadCounts)==null?void 0:O.find(F=>F.userId!==L);L&&l(L),_(v==null?void 0:v.count)},[s]),n.useEffect(()=>{u(s==null?void 0:s._id)},[a,o]),e.jsx(e.Fragment,{children:!r||m?e.jsx(Xe,{}):e.jsxs("div",{className:"flex items-center justify-between p-2 cursor-pointer user-card",onClick:g,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative w-9 h-9",children:[e.jsx("div",{className:"content-center object-cover w-full h-full text-center rounded-full bg-slate-400",children:d((r==null?void 0:r.firstName)+" "+(r==null?void 0:r.lastName))}),de(r==null?void 0:r._id,c)]}),e.jsxs("div",{className:"text-content",children:[e.jsx("div",{className:"name",children:(r==null?void 0:r.firstName)+" "+(r==null?void 0:r.lastName)}),ts(p,r)]})]}),e.jsxs("div",{className:"grid items-end text-right",children:[e.jsx("div",{className:"date !text-[12px]",children:M(p==null?void 0:p.updatedAt).calendar()}),ss(S,x)]})]})})}function hs({setIsChatBoxOpen:s}){const{chatList:t,chatLoading:c}=E();return e.jsx(e.Fragment,{children:e.jsx("div",{className:"max-h-[calc(100vh-29vh)] overflow-y-auto w-full pt-2",children:t.map((a,i)=>e.jsx(us,{chat:a,setIsChatBoxOpen:s},a==null?void 0:a._id))})})}const ps=()=>{const[s,t]=n.useState(0),[c,a]=n.useState(!1),i=n.useCallback(()=>{t(0)},[]);return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-8",children:[e.jsxs("div",{className:`${c?"hidden md:block col-span-3":"md:col-span-3 col-span-8 relative"} "px-3 mb-2  w-full"`,children:[e.jsx(ms,{setIsSearching:t,isSearching:s}),e.jsx("div",{hidden:!s,onClick:i,className:"absolute rounded-md z-10 w-full min-h-[calc(100vh-15vh)] bg-black bg-opacity-85"}),e.jsx(me,{}),e.jsx(hs,{setIsChatBoxOpen:a})]}),e.jsx("div",{className:`${c?"md:col-span-5 col-span-8":"hidden md:block"} col-span-5 md:pl-2 content-center`,children:e.jsx(ls,{setIsChatBoxOpen:a})})]})})},xs=()=>{const{logIn:s,user:t,updateLoginInfo:c,loginInfo:a,loginLoading:i}=R(),[o,l]=n.useState(!1);return e.jsxs(e.Fragment,{children:[t?e.jsx(V,{to:"/"}):null,e.jsx("div",{className:"flex justify-center min-h-[calc(100vh-10vh)]",children:e.jsxs("div",{className:"grid grid-cols-4 my-auto ",children:[e.jsxs("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-2",children:[e.jsx("label",{htmlFor:"",children:"Phone Number"}),e.jsx("input",{type:"number",className:"px-2 py-1 rounded-md bg-neutral-600",onChange:r=>c({...a,phoneNumber:r.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-7",children:[e.jsx("label",{htmlFor:"",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:`${o?"text":"password"}`,className:"px-2 py-1 rounded-md bg-neutral-600",onChange:r=>c({...a,password:r.target.value})}),e.jsx("span",{className:"absolute cursor-pointer right-2 top-1",onClick:()=>l(!o),children:"👁"})]})]}),e.jsx("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-2",children:e.jsx(z,{onClick:s,loading:i,type:"primary",children:"Log In"})})]})})]})},gs=()=>{const{registerInfo:s,user:t,updateRegisterInfo:c,registerUser:a,registerLoading:i}=R(),[o,l]=n.useState(!1);return e.jsxs(e.Fragment,{children:[t?e.jsx(V,{to:"/"}):null,e.jsx("form",{action:"",children:e.jsx("div",{className:"flex justify-center min-h-[calc(100vh-10vh)]",children:e.jsxs("div",{className:"grid grid-cols-4 my-auto ",children:[e.jsxs("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-2",children:[e.jsx("label",{htmlFor:"",children:"First Name"}),e.jsx("input",{type:"text",className:"px-2 py-1 rounded-md bg-neutral-600",onChange:r=>c({...s,firstName:r.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-2",children:[e.jsx("label",{htmlFor:"",children:"Last Name"}),e.jsx("input",{type:"text",className:"px-2 py-1 rounded-md bg-neutral-600",onChange:r=>c({...s,lastName:r.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-2",children:[e.jsx("label",{htmlFor:"",children:"Phone Number"}),e.jsx("input",{type:"number",className:"px-2 py-1 rounded-md bg-neutral-600",onChange:r=>c({...s,phoneNumber:r.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-7",children:[e.jsx("label",{htmlFor:"",children:"Create Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:`${o?"text":"password"}`,className:"px-2 py-1 rounded-md bg-neutral-600",onChange:r=>c({...s,password:r.target.value})}),e.jsx("span",{className:"absolute cursor-pointer right-2 top-1",onClick:()=>l(!o),children:"👁"})]})]}),e.jsx("div",{className:"grid grid-cols-1 col-span-4 gap-1 pb-2",children:e.jsx(z,{onClick:a,type:"primary",loading:i,children:"Sign Up"})})]})})})]})},fs=()=>{const{user:s}=R(),{notifications:t,allUsers:c,openNewChat:a,markAllAsRead:i}=E(),[o,l]=n.useState(!1),r=ce(t),m=t.map(d=>{let h=c.find(x=>x._id===d.senderId);return{...d,senderName:h==null?void 0:h.firstName}}),u=(d,h)=>{a(d,h),l(!1)};let p=()=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid max-h-[26vh] overflow-y-auto",children:[m!=null&&m.length?m.map((d,h)=>e.jsxs("div",{className:`${d.isRead?" text-black/30":"text-black"} border-slate-300 cursor-pointer border-b-[1px] p-1`,onClick:()=>u(d==null?void 0:d.senderId,s==null?void 0:s._id),children:[e.jsx("span",{className:"font-bold ",children:d==null?void 0:d.senderName}),e.jsx("span",{children:" sent a message"}),e.jsx("span",{className:"text-[10px] pl-4 align-bottom italic",children:M(d==null?void 0:d.date).calendar()})]},h)):e.jsx("div",{className:"text-center text-rose-600",children:"Empty"}),(m==null?void 0:m.length)>1?e.jsx("div",{className:"flex justify-end pt-3",children:e.jsx(z,{className:"text-[12px]",size:"small",type:"default",onClick:()=>i(m),children:"Mark all as read"})}):null]})});return e.jsx(e.Fragment,{children:e.jsx(se,{placement:"bottomRight",title:"Unread Notifications",content:p,trigger:"click",open:o,onOpenChange:()=>l(!o),children:e.jsx(te,{className:"content-center cursor-pointer",size:"small",count:r==null?void 0:r.length,children:e.jsx(ae,{className:"",shape:"circle",icon:e.jsx(Fe,{})})})})})},he=()=>{const[s,t]=n.useState(),[c,a]=n.useState(!1);return{chatRequest:s,loadingChatRespond:c,sendChatRequest:async(i,o)=>{try{if((await b.post("/chats/sendChatRequest",{senderId:i,recipientId:o})).data)return!0}catch(l){console.log(l),w(l)}},getChatRequestById:async i=>{try{const o=await b.get(`/chats/getChatRequest/${i}`);if(o.data)return t(o.data[0]),!0}catch(o){console.log(o)}},respondChatRequest:async(i,o,l)=>{try{a(!0),(await b.post("/chats/chatRequestResponse",{chatReqId:i,recipientId:o,respond:l})).data&&a(!1)}catch(r){a(!1),console.log(r)}}}},js=({chatReqId:s,handleRespondChatRequest:t,loadingChatRespond:c})=>{const{chatRequest:a,getChatRequestById:i}=he(),{user:o}=R();return n.useEffect(()=>{i(s)},[s]),e.jsx(e.Fragment,{children:a?e.jsx("div",{children:e.jsxs("div",{className:"border-slate-300 cursor-pointer border-b-[1px] p-1 flex justify-between",children:[es(a,o==null?void 0:o._id),e.jsxs("div",{className:"flex flex-col text-lg text-right",children:[a.status!=="accepted"&&a.sender!==(o==null?void 0:o._id)?e.jsx(e.Fragment,{children:c?e.jsx(D,{}):e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("div",{className:"px-4 py-0 text-gray-500 bg-green-500 rounded-md",onClick:()=>t(s,a==null?void 0:a.receiver,"accept"),children:e.jsx(Q,{})}),e.jsx("div",{className:"px-4 py-0 text-gray-200 rounded-md bg-rose-600",onClick:()=>t(s,a==null?void 0:a.receiver,"reject"),children:e.jsx(Ee,{})})]})}):e.jsx("span",{className:"text-right",children:e.jsx(Oe,{})}),e.jsx("span",{className:"text-[10px] pl-4 align-bottom italic",children:M(a.status!=="accepted"?a==null?void 0:a.sentAt:a==null?void 0:a.respondedAt).calendar()})]})]})}):e.jsx(e.Fragment,{})})},Ns=()=>{const{user:s}=R(),{setIsNewFriendAdded:t}=E(),{getRecipient:c,recipient:a,recipientLoading:i}=H(),{respondChatRequest:o,loadingChatRespond:l}=he(),[r,m]=n.useState(!1);n.useEffect(()=>{s&&c(s._id)},[s]);const u=async(d,h,x)=>{await o(d,h,x),await c(s._id),t(!0),m(!1)};let p=()=>{var d,h;return e.jsx(e.Fragment,{children:e.jsx("div",{className:"grid max-h-[26vh] overflow-y-auto",children:i?e.jsx(D,{}):e.jsx(e.Fragment,{children:(d=a==null?void 0:a.friendRequests)!=null&&d.length?(h=a==null?void 0:a.friendRequests)==null?void 0:h.map((x,S)=>e.jsx(js,{chatReqId:x,handleRespondChatRequest:u,loadingChatRespond:l},S)).reverse():e.jsx("div",{className:"text-center text-rose-600",children:"No Chat Requests"})})})})};return e.jsx(se,{placement:"bottomRight",title:"Chat Requests",content:p,trigger:"click",open:r,onOpenChange:()=>m(!r),children:e.jsx(te,{className:"content-center cursor-pointer",size:"small",children:e.jsx(ae,{className:"",shape:"circle",icon:e.jsx(Pe,{})})})})},vs=()=>{const{user:s,logOut:t}=R(),c=qe(),a=s?[{label:"Logout",key:"1",icon:e.jsx(Be,{}),onClick:()=>{t()}}]:[{label:"Login",key:"1",icon:e.jsx(Y,{}),onClick:()=>{c("/login")}},{label:"Register",key:"2",icon:e.jsx(Y,{}),onClick:()=>{c("/register")}}];return e.jsx(e.Fragment,{children:e.jsx("div",{className:" bg-slate-700",children:e.jsxs("div",{className:"flex justify-between min-h-[8vh] lg:px-[56px] px-3 ",children:[e.jsx("div",{className:"content-center hidden cursor-pointer lg:block",children:e.jsx(ze,{to:"/",children:"ChatApp"})}),e.jsxs("div",{className:"flex gap-1 ",children:[s&&e.jsxs("div",{className:"content-center",children:[e.jsx("span",{children:"Hi "}),e.jsx("span",{className:"italic text-amber-500",children:s==null?void 0:s.firstName}),e.jsx("span",{children:"..."})]}),e.jsx("div",{className:"content-center italic scale-125",children:"🍁"})]}),e.jsxs("div",{className:"flex gap-2 my-auto lg:gap-6",children:[s&&e.jsxs("div",{className:"flex gap-2 lg:gap-2",children:[e.jsx(fs,{}),e.jsx(Ns,{})]}),e.jsx(Le,{menu:{items:a},trigger:["click"],children:e.jsx("a",{className:"flex content-center pl-3",onClick:i=>i.preventDefault(),children:e.jsx($e,{className:"text-xl"})})})]})]})})})},bs=({children:s})=>{const{user:t,loading:c}=R(),a=Te();return c?e.jsx("div",{className:"h-[100vh] content-center",children:e.jsx("div",{className:"flex justify-center ",children:e.jsx(D,{size:"large"})})}):t?s:e.jsx(V,{to:"/login",state:{from:a}})};function ys(){const{user:s}=R();return e.jsx(e.Fragment,{children:e.jsxs(Qe,{user:s,children:[e.jsx(vs,{}),e.jsx("div",{className:"",children:e.jsxs(De,{children:[e.jsx(T,{path:"/",element:e.jsx(bs,{children:e.jsx(ps,{})})}),e.jsx(T,{path:"/login",element:e.jsx(xs,{})}),e.jsx(T,{path:"/register",element:e.jsx(gs,{})}),e.jsx(T,{path:"*",element:e.jsx(V,{to:"/"})})]})})]})})}Ie.createRoot(document.getElementById("root")).render(e.jsx(ee.StrictMode,{children:e.jsx(Ze,{children:e.jsx(Me,{basename:"/chatApp",children:e.jsx(ys,{})})})}));
